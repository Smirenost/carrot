(function () {var da={};Object.defineProperty(da,"__esModule",{value:!0});var _a=function(){return function(e,r){this.inputSize=e,this.outputSize=r,this.nodes=[],this.connections=[]}}(),i=_a;da.Layer=i;var C={},ab=C&&C.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(C,"__esModule",{value:!0});var bb=function(t){function e(e,r){return t.call(this,e,r)||this}return ab(e,t),e}(i),ea=bb;C.ConvolutionLayer=ea;var fa,e={};Object.defineProperty(e,"__esModule",{value:!0});var cb=function(){function t(){this.type=a.NO_ACTIVATION}return t.getActivation=function(t){switch(t){case a.LogisticActivation:return new O;case a.TanhActivation:return new ga;case a.IdentityActivation:return new ha;case a.StepActivation:return new ia;case a.RELUActivation:return new ja;case a.SoftsignActivation:return new ka;case a.SinusoidActivation:return new O;case a.GaussianActivation:return new la;case a.BentIdentityActivation:return new ma;case a.BipolarActivation:return new na;case a.BipolarSigmoidActivation:return new oa;case a.HardTanhActivation:return new pa;case a.AbsoluteActivation:return new qa;case a.InverseActivation:return new ra;case a.SELUActivation:return new sa;}throw new ReferenceError(t+" is not the name of any available activations! These are all available activations: "+D)},t}(),u=cb;e.Activation=u;var O=function(){function t(){this.type=a.LogisticActivation}return t.prototype.calc=function(t,i){return void 0===i&&(i=!1),i?this.calc(t,!1)*(1-this.calc(t,!1)):1/(1+Math.exp(-t))},t}(),P=O;e.LogisticActivation=P;var ga=function(){function t(){this.type=a.TanhActivation}return t.prototype.calc=function(t,i){return void 0===i&&(i=!1),i?1-this.calc(t,!1)*this.calc(t,!1):Math.tanh(t)},t}(),db=ga;e.TanhActivation=db;var ha=function(){function t(){this.type=a.IdentityActivation}return t.prototype.calc=function(t,i){return void 0===i&&(i=!1),i?1:t},t}(),eb=ha;e.IdentityActivation=eb;var ia=function(){function t(){this.type=a.StepActivation}return t.prototype.calc=function(t,i){return void 0===i&&(i=!1),i?0:t<0?0:1},t}(),fb=ia;e.StepActivation=fb;var ja=function(){function t(){this.type=a.RELUActivation}return t.prototype.calc=function(t,i){return void 0===i&&(i=!1),i?t<=0?0:1:t<=0?0:t},t}(),gb=ja;e.RELUActivation=gb;var ka=function(){function t(){this.type=a.SoftsignActivation}return t.prototype.calc=function(t,i){return void 0===i&&(i=!1),i?t/((1+Math.abs(t))*(1+Math.abs(t))):t/(1+Math.abs(t))},t}(),hb=ka;e.SoftsignActivation=hb;var ib=function(){function t(){this.type=a.SinusoidActivation}return t.prototype.calc=function(t,i){return void 0===i&&(i=!1),i?Math.cos(t):Math.sin(t)},t}(),jb=ib;e.SinusoidActivation=jb;var la=function(){function t(){this.type=a.GaussianActivation}return t.prototype.calc=function(t,i){return void 0===i&&(i=!1),i?-2*t*this.calc(t,!1):Math.exp(-t*t)},t}(),kb=la;e.GaussianActivation=kb;var ma=function(){function t(){this.type=a.BentIdentityActivation}return t.prototype.calc=function(t,i){return void 0===i&&(i=!1),i?t/(2*Math.sqrt(t*t+1))+1:(Math.sqrt(t*t+1)-1)/2+t},t}(),lb=ma;e.BentIdentityActivation=lb;var na=function(){function t(){this.type=a.BipolarActivation}return t.prototype.calc=function(t,i){return void 0===i&&(i=!1),i?0:t>0?1:-1},t}(),mb=na;e.BipolarActivation=mb;var oa=function(){function t(){this.type=a.BipolarSigmoidActivation}return t.prototype.calc=function(t,i){return void 0===i&&(i=!1),i?2*Math.exp(-t)/((1+Math.exp(-t))*(1+Math.exp(-t))):2/(1+Math.exp(-t))-1},t}(),nb=oa;e.BipolarSigmoidActivation=nb;var pa=function(){function t(){this.type=a.HardTanhActivation}return t.prototype.calc=function(t,i){return void 0===i&&(i=!1),i?Math.abs(t)<1?1:0:Math.max(-1,Math.min(1,t))},t}(),ob=pa;e.HardTanhActivation=ob;var qa=function(){function t(){this.type=a.AbsoluteActivation}return t.prototype.calc=function(t,i){return void 0===i&&(i=!1),i?t<0?-1:1:Math.abs(t)},t}(),pb=qa;e.AbsoluteActivation=pb;var ra=function(){function t(){this.type=a.InverseActivation}return t.prototype.calc=function(t,i){return void 0===i&&(i=!1),i?-1:1-t},t}(),qb=ra;e.InverseActivation=qb;var a,sa=function(){function t(){this.type=a.SELUActivation}return t.prototype.calc=function(t,i){void 0===i&&(i=!1);var a=1.6732632423543772,n=1.0507009873554805;return i?t>0?n:a*Math.exp(t)*n:t>0?t*n:a*Math.exp(t)-a*n},t}(),rb=sa;e.SELUActivation=rb,function(t){t[t.NO_ACTIVATION=0]="NO_ACTIVATION",t[t.LogisticActivation=1]="LogisticActivation",t[t.TanhActivation=2]="TanhActivation",t[t.IdentityActivation=3]="IdentityActivation",t[t.StepActivation=4]="StepActivation",t[t.RELUActivation=5]="RELUActivation",t[t.SoftsignActivation=6]="SoftsignActivation",t[t.SinusoidActivation=7]="SinusoidActivation",t[t.GaussianActivation=8]="GaussianActivation",t[t.BentIdentityActivation=9]="BentIdentityActivation",t[t.BipolarActivation=10]="BipolarActivation",t[t.BipolarSigmoidActivation=11]="BipolarSigmoidActivation",t[t.HardTanhActivation=12]="HardTanhActivation",t[t.AbsoluteActivation=13]="AbsoluteActivation",t[t.InverseActivation=14]="InverseActivation",t[t.SELUActivation=15]="SELUActivation"}(a=fa||(fa={},e.ActivationType=fa));var D=[a.LogisticActivation,a.TanhActivation,a.IdentityActivation,a.StepActivation,a.RELUActivation,a.SoftsignActivation,a.SinusoidActivation,a.GaussianActivation,a.BentIdentityActivation,a.BipolarActivation,a.BipolarSigmoidActivation,a.HardTanhActivation,a.AbsoluteActivation,a.InverseActivation,a.SELUActivation];e.ALL_ACTIVATIONS=D;var ta={};Object.defineProperty(ta,"__esModule",{value:!0});var sb=function(){function t(t,e,o,i){this.from=t,this.to=e,this.weight=o||0,this.gain=1,this.eligibility=0,this.deltaWeightsPrevious=0,this.deltaWeightsTotal=0,this.xTraceNodes=[],this.xTraceValues=[],i?(this.gateNode=i,i.addGate(this)):this.gateNode=null}return t.innovationID=function(t,e){return .5*(t+e)*(t+e+1)+e},t.prototype.toJSON=function(){return{fromIndex:this.from.index,toIndex:this.to.index,gateNodeIndex:null===this.gateNode?null:this.gateNode.index,weight:this.weight}},t}(),q=sb;ta.Connection=q;var l={};function tb($){return $[Q(0,$.length)]}Object.defineProperty(l,"__esModule",{value:!0});var k=tb;function Q($,t){return Math.floor(Math.random()*(t-$)+$)}l.pickRandom=k;var ua=Q;function ub($,t){return Math.random()*(t-$)+$}l.randInt=ua;var s=ub;function vb(){return Math.random()>=.5}l.randDouble=s;var z=vb;function wb($,t){for(var r=0,e=$;r<e.length;r++){if(e[r]===t)return!0}return!1}l.randBoolean=z;var v=wb;function xb($,t){var r=$.indexOf(t);return-1!==r&&($.splice(r,1),!0)}l.anyMatch=v;var m=xb;function yb($,t){return null!=$?$:t}l.remove=m;var b=yb;function zb($){for(var t=$.length;t>0;){var r=Q(0,t),e=$[--t];$[t]=$[r],$[r]=e}return $}l.getOrDefault=b;var va=zb;l.shuffle=va;var j,R={};Object.defineProperty(R,"__esModule",{value:!0});var wa;!function(t){t[t.INPUT=0]="INPUT",t[t.HIDDEN=1]="HIDDEN",t[t.OUTPUT=2]="OUTPUT"}(wa=j||(j={},R.NodeType=j));var Ab=function(){function t(t){void 0===t&&(t=wa.HIDDEN),this.type=t,this.bias=s(-1,1),this.squash=new P,this.activation=0,this.state=0,this.old=0,this.mask=1,this.deltaBiasPrevious=0,this.deltaBiasTotal=0,this.incoming=[],this.outgoing=[],this.gated=[],this.selfConnection=new q(this,this,0),this.errorResponsibility=0,this.errorProjected=0,this.errorGated=0,this.index=NaN}return t.fromJSON=function(i){var e=new t;return e.bias=i.bias,e.type=i.type,e.squash=u.getActivation(i.squash),e.mask=i.mask,e.index=i.index,e},t.prototype.clear=function(){for(var t=0,i=this.incoming;t<i.length;t++){(s=i[t]).eligibility=0,s.xTraceNodes=[],s.xTraceValues=[]}for(var e=0,o=this.gated;e<o.length;e++){var s;(s=o[e]).gain=0}this.errorResponsibility=this.errorProjected=this.errorGated=0,this.old=this.state=this.activation=0},t.prototype.mutateBias=function(t){this.bias+=s(t.min,t.max)},t.prototype.mutateActivation=function(){var t;do{t=k(D)}while(t===this.squash.type);this.squash=u.getActivation(t)},t.prototype.isProjectedBy=function(t){return t===this?0!==this.selfConnection.weight:v(this.incoming.map(function(t){return t.from}),t)},t.prototype.isProjectingTo=function(t){return t===this?0!==this.selfConnection.weight:v(this.outgoing.map(function(t){return t.to}),t)},t.prototype.addGate=function(t){this.gated.push(t),t.gateNode=this},t.prototype.removeGate=function(t){m(this.gated,t),t.gateNode=null,t.gain=1},t.prototype.connect=function(t,i,e){if(void 0===i&&(i=0),void 0===e&&(e=!1),t===this)return this.selfConnection.weight=i||1,this.selfConnection;if(this.isProjectingTo(t))throw new ReferenceError;var o=new q(this,t,i);return this.outgoing.push(o),t.incoming.push(o),e&&t.connect(this),o},t.prototype.disconnect=function(t,i){if(void 0===i&&(i=!1),t===this)return this.selfConnection.weight=0,this.selfConnection;for(var e=0,o=this.outgoing;e<o.length;e++){var s=o[e];if(s.to===t)return m(this.outgoing,s),m(s.to.incoming,s),void 0!==s.gateNode&&null!=s.gateNode&&s.gateNode.removeGate(s),i&&t.disconnect(this),s}throw new Error("No connection found!")},t.prototype.propagate=function(t,i,e,o){if(void 0!==t&&Number.isFinite(t))this.errorResponsibility=this.errorProjected=t-this.activation;else{this.errorProjected=0;for(var s=0,r=this.outgoing;s<r.length;s++){var a=r[s];this.errorProjected+=a.to.errorResponsibility*a.weight*a.gain}this.errorProjected*=this.derivative||1,this.errorGated=0;for(var n=0,h=this.gated;n<h.length;n++){var c=void 0;c=(g=(a=h[n]).to).selfConnection.gateNode===this?g.old+a.weight*a.from.activation:a.weight*a.from.activation,this.errorGated+=g.errorResponsibility*c}this.errorGated*=this.derivative||1,this.errorResponsibility=this.errorProjected+this.errorGated}for(var l=0,v=this.incoming;l<v.length;l++){a=v[l];for(var d=this.errorProjected*a.eligibility,$=0;$<a.xTraceNodes.length;$++){var g;d+=(g=a.xTraceNodes[$]).errorResponsibility*a.xTraceValues[$]}a.deltaWeightsTotal+=e*d*this.mask,o&&(a.deltaWeightsTotal+=i*a.deltaWeightsPrevious,a.weight+=a.deltaWeightsTotal,a.deltaWeightsPrevious=a.deltaWeightsTotal,a.deltaWeightsTotal=0)}return this.deltaBiasTotal+=e*this.errorResponsibility,o&&(this.deltaBiasTotal+=i*this.deltaBiasPrevious,this.bias+=this.deltaBiasTotal,this.deltaBiasPrevious=this.deltaBiasTotal,this.deltaBiasTotal=0),{responsibility:this.errorResponsibility,projected:this.errorProjected,gated:this.errorGated}},t.prototype.activate=function(t,i){var e=this;if(void 0===t&&(t=null),void 0===i&&(i=!0),null!==t&&Number.isFinite(t))return this.activation=t;if(i){this.old=this.state,this.state=this.selfConnection.gain*this.selfConnection.weight*this.state+this.bias,this.incoming.forEach(function(t){e.state+=t.from.activation*t.weight*t.gain}),this.activation=this.squash.calc(this.state,!1)*this.mask,this.derivative=this.squash.calc(this.state,!0);var o=[],s=[];this.gated.forEach(function(t){t.gain=e.activation;var i=o.indexOf(t.to);i>-1?s[i]+=t.weight*t.from.activation:(o.push(t.to),t.to.selfConnection.gateNode===e?s.push(t.weight*t.from.activation+t.to.old):s.push(t.weight*t.from.activation))});for(var r=0,a=this.incoming;r<a.length;r++){($=a[r]).eligibility=this.selfConnection.gain*this.selfConnection.weight*$.eligibility+$.from.activation*$.gain;for(var n=0;n<o.length;n++){var h=o[n],c=s[n],l=$.xTraceNodes.indexOf(h);l>-1?$.xTraceValues[l]=h.selfConnection.gain*h.selfConnection.weight*$.xTraceValues[l]+this.derivative*$.eligibility*c:($.xTraceNodes.push(h),$.xTraceValues.push(this.derivative*$.eligibility*c))}}return this.activation}if(this.type===wa.INPUT)return this.activation=0;this.state=this.selfConnection.gain*this.selfConnection.weight*this.state+this.bias;for(var v=0,d=this.incoming;v<d.length;v++){var $=d[v];this.state+=$.from.activation*$.weight*$.gain}this.activation=this.squash.calc(this.state,!1);for(var g=0,u=this.gated;g<u.length;g++){($=u[g]).gain=this.activation}return this.activation},t.prototype.toJSON=function(){return{bias:this.bias,type:this.type,squash:this.squash.type,mask:this.mask,index:this.index}},t}(),x=Ab;R.Node=x;var E={},Bb=E&&E.__extends||function(){var e=function(r,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])})(r,o)};return function(r,o){function $(){this.constructor=r}e(r,o),r.prototype=null===o?Object.create(o):($.prototype=o.prototype,new $)}}();Object.defineProperty(E,"__esModule",{value:!0});var Cb=function(e){function r(r,o){for(var $=e.call(this,r,o)||this,n=0;n<r;n++)$.nodes.push(new x(j.INPUT));for(n=0;n<o;n++)$.nodes.push(new x(j.INPUT));return $.nodes.filter(function(e){return e.type===j.INPUT}).forEach(function(e){$.nodes.filter(function(e){return e.type===j.OUTPUT}).forEach(function(r){$.connections.push(e.connect(r,1))})}),$}return Bb(r,e),r}(i),xa=Cb;E.DenseLayer=xa;var F={},Db=F&&F.__extends||function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function o(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}();Object.defineProperty(F,"__esModule",{value:!0});var Eb=function(e){function r(r,t){return e.call(this,r,t)||this}return Db(r,e),r}(i),ya=Eb;F.GaussianNoiseLayer=ya;var G={},Fb=G&&G.__extends||function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(r,e)};return function(r,e){function p(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(p.prototype=e.prototype,new p)}}();Object.defineProperty(G,"__esModule",{value:!0});var Gb=function(t){function r(r,e){return t.call(this,r,e)||this}return Fb(r,t),r}(i),za=Gb;G.InputLayer=za;var H={},Hb=H&&H.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])})(e,t)};return function(e,t){function $(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):($.prototype=t.prototype,new $)}}();Object.defineProperty(H,"__esModule",{value:!0});var Ib=function(r){function e(e,t){return r.call(this,e,t)||this}return Hb(e,r),e}(i),Aa=Ib;H.LSTMLayer=Aa;var Ba,y={},Jb=y&&y.__extends||function(){var r=function(o,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var e in o)o.hasOwnProperty(e)&&(r[e]=o[e])})(o,e)};return function(o,e){function $(){this.constructor=o}r(o,e),o.prototype=null===e?Object.create(e):($.prototype=e.prototype,new $)}}();Object.defineProperty(y,"__esModule",{value:!0});var Tc,Kb=function(r){function o(o,e,$){return r.call(this,o,e)||this}return Jb(o,r),o}(i),Ca=Kb;y.PoolLayer=Ca,function(r){r[r.MaxPooling=0]="MaxPooling",r[r.AveragePooling=1]="AveragePooling",r[r.GlobalPooling=2]="GlobalPooling"}(Tc=Ba||(Ba={},y.PoolingType=Ba));var I={},Lb=I&&I.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])})(e,t)};return function(e,t){function $(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):($.prototype=t.prototype,new $)}}();Object.defineProperty(I,"__esModule",{value:!0});var Mb=function(r){function e(e,t){return r.call(this,e,t)||this}return Lb(e,r),e}(i),Da=Mb;I.RNNLayer=Da;var Ea={};Object.defineProperty(Ea,"__esModule",{value:!0});var Nb=function(){function t(){this.layers=[]}return t.prototype.addLayer=function(t){if(this.layers[this.layers.length-1].outputSize!==t.inputSize)throw new RangeError("Output size of last layer is unequal input size of this layer! "+this.layers[this.layers.length-1].outputSize+" -> "+t.inputSize);return this.layers.push(t),this},t}(),Fa=Nb;Ea.Architect=Fa;var d={},g=d&&d.__extends||function(){var t=function(n,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])})(n,o)};return function(n,o){function $(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):($.prototype=o.prototype,new $)}}();Object.defineProperty(d,"__esModule",{value:!0});var f=function(){return function(){}}(),Ga=f;d.Mutation=Ga;var S=function(t){function n(n){void 0===n&&(n=!0);var o=t.call(this)||this;return o.randomActivation=n,o}return g(n,t),n.prototype.mutate=function(t,n){if(!(void 0!==n&&t.nodes.length>=n)){var o=new x(j.HIDDEN);this.randomActivation&&o.mutateActivation();var $=k(t.connections),e=$.from,a=$.to;t.disconnect(e,a);var i=Math.max(t.inputSize,1+t.nodes.indexOf(e));t.nodes.splice(i,0,o);var r=t.connect(e,o,1),u=t.connect(o,a,$.weight);null!=$.gateNode&&(z()?t.addGate($.gateNode,r):t.addGate($.gateNode,u))}},n}(f),Ha=S;d.AddNodeMutation=Ha;var T=function(t){function n(n){void 0===n&&(n=!0);var o=t.call(this)||this;return o.keepGates=n,o}return g(n,t),n.prototype.mutate=function(t){var n=t.nodes.filter(function(t){return void 0!==t&&t.type===j.HIDDEN});if(n.length>0){var o=k(n);t.removeNode(o)}},n}(f),Ia=T;d.SubNodeMutation=Ia;var U=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return g(n,t),n.prototype.mutate=function(t,n){if(!(void 0!==n&&n<=t.connections.length)){for(var o=[],$=0;$<t.nodes.length-t.outputSize;$++)for(var e=t.nodes[$],a=Math.max($+1,t.inputSize);a<t.nodes.length;a++){var i=t.nodes[a];e.isProjectingTo(i)||o.push([e,i])}if(o.length>0){var r=k(o);t.connect(r[0],r[1])}}},n}(f),Ja=U;d.AddConnectionMutation=Ja;var V=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return g(n,t),n.prototype.mutate=function(t){var n=t.connections.filter(function(n){return n.from.outgoing.length>1&&n.to.incoming.length>1&&t.nodes.indexOf(n.to)>t.nodes.indexOf(n.from)});if(n.length>0){var o=k(n);t.disconnect(o.from,o.to)}},n}(f),Ob=V;d.SubConnectionMutation=Ob;var W=function(t){function n(n,o){void 0===n&&(n=-1),void 0===o&&(o=1);var $=t.call(this)||this;return $.min=n,$.max=o,$}return g(n,t),n.prototype.mutate=function(t){k(t.connections).weight+=s(this.min,this.max)},n}(f),Pb=W;d.ModWeightMutation=Pb;var X=function(t){function n(n,o){void 0===n&&(n=-1),void 0===o&&(o=1);var $=t.call(this)||this;return $.min=n,$.max=o,$}return g(n,t),n.prototype.mutate=function(t){k(t.nodes.filter(function(t){return t.type!==j.INPUT})).mutateBias(this)},n}(f),Qb=X;d.ModBiasMutation=Qb;var Y=function(t){function n(n){void 0===n&&(n=!1);var o=t.call(this)||this;return o.mutateOutput=n,o}return g(n,t),n.prototype.mutate=function(t,n){var o=this.mutateOutput?t.nodes.filter(function(t){return t.type!==j.INPUT}):t.nodes.filter(function(t){return t.type===j.HIDDEN});o.length>0&&k(o).mutateActivation()},n}(f),Rb=Y;d.ModActivationMutation=Rb;var Ka=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return g(n,t),n.prototype.mutate=function(t){var n=t.nodes.filter(function(t){return t.type!==j.INPUT}).filter(function(t){return 0===t.selfConnection.weight});if(n){var o=k(n);t.connect(o,o)}},n}(f),Sb=Ka;d.AddSelfConnectionMutation=Sb;var La=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return g(n,t),n.prototype.mutate=function(t){var n=t.connections.filter(function(t){return t.from===t.to});if(n.length>0){var o=k(n);t.disconnect(o.from,o.to)}},n}(f),Tb=La;d.SubSelfConnectionMutation=Tb;var Ma=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return g(n,t),n.prototype.mutate=function(t,n){if(!(void 0!==n&&n<=t.gates.length)){var o=t.connections.filter(function(t){return null===t.gateNode});if(o.length>0){var $=k(t.nodes.filter(function(t){return t.type!==j.INPUT})),e=k(o);t.addGate($,e)}}},n}(f),Na=Ma;d.AddGateMutation=Na;var Oa=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return g(n,t),n.prototype.mutate=function(t){t.gates.length>0&&t.removeGate(k(t.gates))},n}(f),Ub=Oa;d.SubGateMutation=Ub;var Pa=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return g(n,t),n.prototype.mutate=function(t){for(var n=[],o=t.inputSize;o<t.nodes.length;o++)for(var $=t.nodes[o],e=t.inputSize;e<o;e++){var a=t.nodes[e];$.isProjectingTo(a)||n.push([$,a])}if(n.length>0){var i=k(n);t.connect(i[0],i[1])}},n}(f),Vb=Pa;d.AddBackConnectionMutation=Vb;var Qa=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return g(n,t),n.prototype.mutate=function(t){var n=t.connections.filter(function(t){return t.from.outgoing.length>1}).filter(function(t){return t.to.incoming.length>1}).filter(function(n){return t.nodes.indexOf(n.from)>t.nodes.indexOf(n.to)});if(n.length>0){var o=k(n);t.disconnect(o.from,o.to)}},n}(f),Wb=Qa;d.SubBackConnectionMutation=Wb;var Z=function(t){function n(n){void 0===n&&(n=!1);var o=t.call(this)||this;return o.mutateOutput=n,o}return g(n,t),n.prototype.mutate=function(t){var n=this.mutateOutput?t.nodes.filter(function(t){return void 0!==t&&t.type!==j.INPUT}):t.nodes.filter(function(t){return void 0!==t&&t.type===j.HIDDEN});if(n.length>=2){var o=k(n),$=k(n.filter(function(t){return t!==o})),e=o.bias,a=o.squash;o.bias=$.bias,o.squash=$.squash,$.bias=e,$.squash=a}},n}(f),Xb=Z;d.SwapNodesMutation=Xb;var Ra=[new S,new T,new U,new V,new W,new X,new Y,new Ma,new Oa,new Ka,new La,new Pa,new Qa,new Z];d.ALL_MUTATIONS=Ra;var Sa=[new S,new T,new U,new V,new W,new X,new Y,new Z];d.FEEDFORWARD_MUTATIONS=Sa;var h={},o=h&&h.__extends||function(){var r=function(t,$){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var $ in t)t.hasOwnProperty($)&&(r[$]=t[$])})(t,$)};return function(t,$){function o(){this.constructor=t}r(t,$),t.prototype=null===$?Object.create($):(o.prototype=$.prototype,new o)}}();Object.defineProperty(h,"__esModule",{value:!0});var n=function(){return function(){}}(),Ta=n;h.Loss=Ta;var Yb=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return o(t,r),t.prototype.calc=function(r,t){var $=0;return t.forEach(function(t,o){$-=r[o]*Math.log(Math.max(t,1e-15))+(1-r[o])*Math.log(1-Math.max(t,1e-15))}),$/t.length},t}(n),Zb=Yb;h.CrossEntropyLoss=Zb;var $b=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return o(t,r),t.prototype.calc=function(r,t){var $=0;return t.forEach(function(t,o){$+=Math.pow(r[o]-t,2)}),$/t.length},t}(n),A=$b;h.MSELoss=A;var _b=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return o(t,r),t.prototype.calc=function(r,t){var $=0;return t.forEach(function(t,o){$+=Math.round(2*r[o])!==Math.round(2*t)?1:0}),$/t.length},t}(n),ac=_b;h.BinaryLoss=ac;var bc=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return o(t,r),t.prototype.calc=function(r,t){var $=0;return t.forEach(function(t,o){$+=Math.abs(r[o]-t)}),$/t.length},t}(n),cc=bc;h.MAELoss=cc;var dc=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return o(t,r),t.prototype.calc=function(r,t){var $=0;return t.forEach(function(t,o){$+=Math.abs((t-r[o])/Math.max(r[o],1e-15))}),$/t.length},t}(n),ec=dc;h.MAPELoss=ec;var fc=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return o(t,r),t.prototype.calc=function(r,t){for(var $=0,o=0,s=0;s<t.length;s++)$+=Math.abs(r[s]-t[s]),o+=r[s];return $/o},t}(n),gc=fc;h.WAPELoss=gc;var hc=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return o(t,r),t.prototype.calc=function(r,t){var $=0;return t.forEach(function(t,o){$+=Math.log(Math.max(r[o],1e-15))-Math.log(Math.max(t,1e-15))}),$/t.length},t}(n),ic=hc;h.MSLELoss=ic;var jc=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return o(t,r),t.prototype.calc=function(r,t){var $=0;return t.forEach(function(t,o){$+=Math.max(0,1-t*r[o])}),$/t.length},t}(n),kc=jc;h.HINGELoss=kc;var p={},J=p&&p.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function $(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):($.prototype=r.prototype,new $)}}();Object.defineProperty(p,"__esModule",{value:!0});var B=function(){return function(t){this.baseRate=t}}(),Ua=B;p.Rate=Ua;var lc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return J(e,t),e.prototype.calc=function(t){return this.baseRate},e}(B),Va=lc;p.FixedRate=Va;var mc=function(t){function e(e,r,$){void 0===r&&(r=.9),void 0===$&&($=100);var a=t.call(this,e)||this;return a.gamma=r,a.stepSize=$,a}return J(e,t),e.prototype.calc=function(t){return this.baseRate*Math.pow(this.gamma,Math.floor(t/this.stepSize))},e}(B),nc=mc;p.StepRate=nc;var oc=function(t){function e(e,r){void 0===r&&(r=.999);var $=t.call(this,e)||this;return $.gamma=r,$}return J(e,t),e.prototype.calc=function(t){return this.baseRate*Math.pow(this.gamma,t)},e}(B),pc=oc;p.ExponentialRate=pc;var qc=function(t){function e(e,r,$){void 0===r&&(r=.001),void 0===$&&($=2);var a=t.call(this,e)||this;return a.gamma=r,a.power=$,a}return J(e,t),e.prototype.calc=function(t){return this.baseRate*Math.pow(1+this.gamma*t,-this.power)},e}(B),rc=qc;p.InverseRate=rc;var t={},$=t&&t.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var K=function(){return function(){}}(),Wa=K;t.Selection=Wa;var sc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype.select=function(e){var t,o=0,r=0;e.map(function(e){return e.score}).forEach(function(e){r=void 0!==e&&e<r?e:r,o+=null!=e?e:0}),r=Math.abs(r),o+=r*e.length;for(var i=s(0,o),n=0,$=0,l=e;$<l.length;$++){var a=l[$];if(i<(n+=(null!==(t=a.score)&&void 0!==t?t:0)+r))return a}return k(e)},t}(K),tc=sc;t.FitnessProportionateSelection=tc;var uc=function(e){function t(t){void 0===t&&(t=4);var o=e.call(this)||this;return o.power=t,o}return $(t,e),t.prototype.select=function(e){return e[Math.floor(Math.pow(Math.random(),this.power)*e.length)]},t}(K),Xa=uc;t.PowerSelection=Xa;var vc=function(e){function t(t,o){void 0===t&&(t=5),void 0===o&&(o=.5);var r=e.call(this)||this;return r.size=t,r.probability=o,r}return $(t,e),t.prototype.select=function(e){if(this.size>e.length)throw new Error("Your tournament size should be lower than the population size, please change methods.selection.TOURNAMENT.size");for(var t=[],o=0;o<this.size;o++)t.push(k(e));t.sort(function(e,t){return void 0===t.score||void 0===e.score?0:t.score-e.score});for(o=0;o<this.size;o++)if(Math.random()<this.probability||o===this.size-1)return t[o];return k(e)},t}(K),wc=vc;t.TournamentSelection=wc;var r={},L=r&&r.__awaiter||function(t,e,r,o){return new(r||(r=Promise))(function(i,n){function a(t){try{u(o.next(t))}catch(e){n(e)}}function s(t){try{u(o.throw(t))}catch(e){n(e)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(a,s)}u((o=o.apply(t,e||[])).next())})},M=r&&r.__generator||function(t,e){var r,o,i,n,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,o=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){a.label=n[1];break}if(6===n[0]&&a.label<i[1]){a.label=i[1],i=n;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(n);break}i[2]&&a.ops.pop(),a.trys.pop();continue;}n=e.call(t,a)}catch(s){n=[6,s],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}},xc=r&&r.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var o=Array(t),i=0;for(e=0;e<r;e++)for(var n=arguments[e],a=0,s=n.length;a<s;a++,i++)o[i]=n[a];return o};Object.defineProperty(r,"__esModule",{value:!0});var yc=function(){function t(t,e){this.dataset=t,this.generation=b(e.generation,0),this.input=b(e.input,1),this.output=b(e.output,1),this.equal=b(e.equal,!0),this.clear=b(e.clear,!1),this.populationSize=b(e.populationSize,50),this.growth=b(e.growth,1e-4),this.loss=b(e.loss,new A),this.amount=b(e.amount,1),this.elitism=b(e.elitism,1),this.provenance=b(e.provenance,0),this.mutationRate=b(e.mutationRate,.4),this.mutationAmount=b(e.mutationAmount,1),this.fitnessPopulation=b(e.fitnessPopulation,!1),this.fitnessFunction=e.fitnessFunction,this.selection=b(e.selection,new Xa),this.mutations=b(e.mutations,Sa),this.template=b(e.template,new N(this.input,this.output)),this.maxNodes=b(e.maxNodes,1/0),this.maxConnections=b(e.maxConnections,1/0),this.maxGates=b(e.maxGates,1/0),this.population=[],this.createInitialPopulation()}return t.prototype.filterGenome=function(t,e,r,o){var i=xc(t);return o?i.filter(function(t){return r(t)}).forEach(function(t,e){return i[e]=o(i[e])}):i.filter(function(t){return r(t)}).forEach(function(t,r){return i[r]=e.copy()}),i},t.prototype.mutateRandom=function(t,e){void 0===e&&(e=this.mutations);var r=this.maxNodes,o=this.maxConnections,i=this.maxGates;e=e.filter(function(e){return e.constructor.name!==Ha.constructor.name||t.nodes.length<r||e.constructor.name!==Ja.constructor.name||t.connections.length<o||e.constructor.name!==Na.constructor.name||t.gates.length<i}),t.mutate(k(e))},t.prototype.evolve=function(t,e){return L(this,void 0,void 0,function(){var r,o,i,n,a;return M(this,function(s){switch(s.label){case 0:if(this.elitism+this.provenance>this.populationSize)throw new Error("Can`t evolve! Elitism + provenance exceeds population size!");return void 0!==this.population[this.population.length-1].score?[3,2]:[4,this.evaluate(this.dataset)];case 1:s.sent(),s.label=2;case 2:for(t&&(this.population=this.filterGenome(this.population,this.template,t,e)),this.sort(),r=[],i=0;i<this.elitism;i++)r.push(this.population[i]);for(o=Array(this.provenance).fill(this.template.copy()),i=0;i<this.populationSize-this.elitism-this.provenance;i++)o.push(this.getOffspring());return this.population=o,this.mutate(void 0),(a=this.population).push.apply(a,r),[4,this.evaluate(this.dataset)];case 3:return s.sent(),t&&(this.population=this.filterGenome(this.population,this.template,t,e)),this.sort(),(n=this.population[0].copy()).score=this.population[0].score,this.population.forEach(function(t){return t.score=void 0}),this.generation++,[2,n];}})})},t.prototype.getOffspring=function(){this.sort();var t=this.selection.select(this.population),e=this.selection.select(this.population);if(null===t||null===e)throw new ReferenceError("Should not be null!");return N.crossOver(t,e,this.equal)},t.prototype.mutate=function(t){var e=this;t?this.population.filter(function(){return Math.random()<=e.mutationRate}).forEach(function(r){for(var o=0;o<e.mutationAmount;o++)r.mutate(t)}):this.population.filter(function(){return Math.random()<=e.mutationRate}).forEach(function(t){for(var r=0;r<e.mutationAmount;r++)e.mutateRandom(t,e.mutations)})},t.prototype.evaluate=function(t){return L(this,void 0,void 0,function(){var e,r,o;return M(this,function(i){switch(i.label){case 0:return this.fitnessPopulation?(this.clear&&this.population.forEach(function(t){return t.clear()}),this.fitnessFunction?[4,this.fitnessFunction(t,this.population)]:[3,2]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,7];case 3:e=0,r=this.population,i.label=4;case 4:return e<r.length?(o=r[e],this.clear&&o.clear(),this.fitnessFunction?[4,this.fitnessFunction(t,o)]:[3,6]):[3,7];case 5:i.sent(),i.label=6;case 6:return e++,[3,4];case 7:return this.sort(),[2,this.population[0]];}})})},t.prototype.sort=function(){this.population.sort(function(t,e){return void 0===t.score||void 0===e.score?0:e.score-t.score})},t.prototype.getFittest=function(){return L(this,void 0,void 0,function(){return M(this,function(t){switch(t.label){case 0:return void 0!==this.population[this.population.length-1].score?[3,2]:[4,this.evaluate(this.dataset)];case 1:t.sent(),t.label=2;case 2:return this.sort(),[2,this.population[0]];}})})},t.prototype.getAverage=function(){return L(this,void 0,void 0,function(){var t;return M(this,function(e){switch(e.label){case 0:return void 0!==this.population[this.population.length-1].score?[3,2]:[4,this.evaluate(this.dataset)];case 1:e.sent(),e.label=2;case 2:return t=0,this.population.map(function(t){return t.score}).forEach(function(e){return t+=null!=e?e:0}),[2,t/this.population.length];}})})},t.prototype.createInitialPopulation=function(){for(var t=0;t<this.populationSize;t++)this.population.push(this.template.copy())},t}(),_=yc;r.NEAT=_;var w={},aa=w&&w.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(r,i){function a(t){try{l(n.next(t))}catch(e){i(e)}}function s(t){try{l(n.throw(t))}catch(e){i(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(a,s)}l((n=n.apply(t,e||[])).next())})},ba=w&&w.__generator||function(t,e){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue;}i=e.call(t,a)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(w,"__esModule",{value:!0});var zc=function(){function t(t,e){this.inputSize=t,this.outputSize=e,this.nodes=[],this.connections=[],this.gates=[],this.score=void 0;for(var o=0;o<t;o++)this.nodes.push(new x(j.INPUT));for(o=0;o<e;o++)this.nodes.push(new x(j.OUTPUT));for(o=0;o<this.inputSize;o++)for(var n=this.inputSize;n<this.outputSize+this.inputSize;n++){var r=(Math.random()-.5)*this.inputSize*Math.sqrt(2/this.inputSize);this.connect(this.nodes[o],this.nodes[n],r)}}return t.fromJSON=function(e){var o=new t(e.inputSize,e.outputSize);return o.nodes=[],o.connections=[],e.nodes.forEach(function(t){var e=x.fromJSON(t);o.nodes[e.index]=e}),e.connections.forEach(function(t){var e=o.connect(o.nodes[t.fromIndex],o.nodes[t.toIndex],t.weight);null!=t.gateNodeIndex&&o.addGate(o.nodes[t.gateNodeIndex],e)}),o},t.crossOver=function(e,o,n){if(e.inputSize!==o.inputSize||e.outputSize!==o.outputSize)throw new Error("Networks don`t have the same input/output size!");var r=new t(e.inputSize,e.outputSize);r.connections=[],r.nodes=[];var i,a=e.score||0,s=o.score||0;if(n||a===s){var l=Math.max(e.nodes.length,o.nodes.length),u=Math.min(e.nodes.length,o.nodes.length);i=ua(u,l+1)}else i=a>s?e.nodes.length:o.nodes.length;for(var $=e.inputSize,c=e.outputSize,h=0;h<e.nodes.length;h++)e.nodes[h].index=h;for(h=0;h<o.nodes.length;h++)o.nodes[h].index=h;for(h=0;h<i;h++){var d=void 0;if(h<$){j.INPUT;for(var p=z()?e:o,v=-1,f=-1;v<h;){if(++f>=p.nodes.length)throw RangeError("something is wrong with the size of the input");p.nodes[f].type===j.INPUT&&v++}d=p.nodes[f]}else if(h<$+c){j.OUTPUT;p=z()?e:o;var m=-1;for(f=-1;m<h-$;){if(++f>=p.nodes.length)throw RangeError("something is wrong with the size of the output");p.nodes[f].type===j.OUTPUT&&m++}d=p.nodes[f]}else{j.HIDDEN;p=void 0;p=h>=e.nodes.length?o:h>=o.nodes.length?e:z()?e:o,d=k(p.nodes)}var g=new x(d.type);g.bias=d.bias,g.squash=d.squash,r.nodes.push(g)}var O=[],_=[];e.connections.forEach(function(t){O[q.innovationID(t.from.index,t.to.index)]=t.toJSON()}),o.connections.forEach(function(t){_[q.innovationID(t.from.index,t.to.index)]=t.toJSON()});var N=[],w=Object.keys(O),y=Object.keys(_);for(h=w.length-1;h>=0;h--)void 0!==_[parseInt(w[h])]?(N.push(z()?O[parseInt(w[h])]:_[parseInt(w[h])]),_[parseInt(w[h])]=void 0):(a>=s||n)&&N.push(O[parseInt(w[h])]);return(s>=a||n)&&y.map(function(t){return parseInt(t)}).map(function(t){return _[t]}).filter(function(t){return void 0!==t}).forEach(function(t){return N.push(t)}),N.forEach(function(t){if(void 0!==t&&t.toIndex<i&&t.fromIndex<i){var e=r.nodes[t.fromIndex],o=r.nodes[t.toIndex],n=r.connect(e,o,t.weight);null!==t.gateNodeIndex&&t.gateNodeIndex<i&&r.addGate(r.nodes[t.gateNodeIndex],n)}}),r},t.prototype.copy=function(){return t.fromJSON(this.toJSON())},t.prototype.connect=function(t,e,o){void 0===o&&(o=0);var n=t.connect(e,o);return this.connections.push(n),n},t.prototype.activate=function(t,e,o){void 0===e&&(e=0),void 0===o&&(o=!0);for(var n=0,r=0,i=this.nodes;r<i.length;r++){var a=i[r];if(n===this.inputSize)break;a.type===j.INPUT&&a.activate(t[n++],o)}if(n!==t.length)throw Error("There are "+n+" input nodes, but "+t.length+" inputs were passed");this.nodes.filter(function(t){return t.type===j.HIDDEN}).forEach(function(t){e&&(t.mask=Math.random()>=e?1:0),t.activate(void 0,o)});for(var s=[],l=0,u=this.nodes;l<u.length;l++){a=u[l];if(s.length===this.outputSize)break;a.type===j.OUTPUT&&s.push(a.activate(void 0,o))}if(s.length!==this.outputSize)throw Error("There are "+this.outputSize+" output nodes, but "+s.length+" outputs were passed");return s},t.prototype.propagate=function(t,e,o,n){if(n.length!==this.outputSize)throw new Error("Output target length should match network output length");for(var r=0,i=0;r<this.outputSize;i++)this.nodes[i].type===j.OUTPUT&&this.nodes[i].propagate(n[r++],e,t,o);for(i=this.nodes.length-1;i>=0;i--)this.nodes[i].type===j.HIDDEN&&this.nodes[i].propagate(void 0,t,e,o);this.nodes.filter(function(t){return t.type===j.INPUT}).forEach(function(n){n.propagate(void 0,t,e,o)})},t.prototype.clear=function(){this.nodes.forEach(function(t){return t.clear()})},t.prototype.disconnect=function(t,e){var o=this;return this.connections.filter(function(e){return e.from===t}).filter(function(t){return t.to===e}).forEach(function(t){null!==t.gateNode&&o.removeGate(t),m(o.connections,t)}),t.disconnect(e)},t.prototype.addGate=function(t,e){if(-1===this.nodes.indexOf(t))throw new ReferenceError("This node is not part of the network!");null==e.gateNode&&(t.addGate(e),this.gates.push(e))},t.prototype.removeGate=function(t){if(!v(this.gates,t))throw new Error("This connection is not gated!");m(this.gates,t),null!=t.gateNode&&t.gateNode.removeGate(t)},t.prototype.removeNode=function(t,e){var o=this;if(void 0===e&&(e=new Ia().keepGates),!v(this.nodes,t))throw new ReferenceError("This node does not exist in the network!");this.disconnect(t,t);for(var n=[],r=[],i=[],a=t.incoming.length-1;a>=0;a--){var s=t.incoming[a];e&&null!==s.gateNode&&s.gateNode!==t&&r.push(s.gateNode),n.push(s.from),this.disconnect(s.from,t)}for(a=t.outgoing.length-1;a>=0;a--){s=t.outgoing[a];e&&null!==s.gateNode&&s.gateNode!==t&&r.push(s.gateNode),i.push(s.to),this.disconnect(t,s.to)}var l=[];for(n.forEach(function(t){i.forEach(function(e){t.isProjectingTo(e)||l.push(o.connect(t,e))})});r.length>0&&l.length>0;){var u=r.shift();if(void 0!==u){s=k(l);this.addGate(u,s),m(l,s)}}for(a=t.gated.length-1;a>=0;a--)this.removeGate(t.gated[a]);m(this.nodes,t)},t.prototype.mutate=function(t,e,o,n){var r;void 0===e&&(e=1/0),void 0===o&&(o=1/0),void 0===n&&(n=1/0),t.mutate(this,null!==(r=null!=e?e:o)&&void 0!==r?r:n)},t.prototype.mutateRandom=function(t,e,o,n){void 0===t&&(t=Ra),void 0===e&&(e=1/0),void 0===o&&(o=1/0),void 0===n&&(n=1/0),0!==t.length&&this.mutate(k(t),e||1/0,o||1/0,n||1/0)},t.prototype.train=function(t,e){var o;if(void 0===e&&(e={}),t[0].input.length!==this.inputSize||t[0].output.length!==this.outputSize)throw new Error("Dataset input/output size should be same as network input/output size!");e.iterations=b(e.iterations,100),e.error=b(e.error,.05),e.loss=b(e.loss,new A);var n=b(e.rate,.3);e.dropout=b(e.dropout,0),e.momentum=b(e.momentum,0),e.batchSize=Math.min(t.length,b(e.batchSize,1)),e.ratePolicy=b(e.ratePolicy,new Va(n)),e.log=b(e.log,NaN);var r,i,a,s,l=e.error<=0?-1:e.error,u=Date.now();if(e.iterations<=0&&e.error<=0)throw new Error("At least one of the following options must be specified: error, iterations");e.crossValidateTestSize&&e.crossValidateTestSize>0?(r=Math.ceil((1-e.crossValidateTestSize)*t.length),i=t.slice(0,r),a=t.slice(r)):(i=t,a=[]);for(var $=0,c=1;c>l&&(e.iterations<=0||$<e.iterations);){$++,s=e.ratePolicy.calc($);var h=this.trainEpoch(i,e.batchSize,s,e.momentum,e.loss,e.dropout);e.clear&&this.clear(),e.crossValidateTestSize?(c=this.test(a,e.loss),e.clear&&this.clear()):c=h,null!==(o=e.shuffle)&&void 0!==o&&o&&va(t),e.log>0&&$%e.log==0&&console.log("iteration number",$,"error",c,"training rate",s),e.schedule&&$%e.schedule.iterations==0&&e.schedule.function(c,$)}return e.clear&&this.clear(),{error:c,iterations:$,time:Date.now()-u}},t.prototype.trainEpoch=function(t,e,o,n,r,i){void 0===i&&(i=.5);for(var a=0,s=0;s<t.length;s++){var l=t[s].input,u=t[s].output,$=(s+1)%e==0||s+1===t.length,c=this.activate(l,i);this.propagate(o,n,$,u),a+=r.calc(u,c)}return a/t.length},t.prototype.test=function(t,e){void 0===e&&(e=new A);for(var o=0,n=0,r=t;n<r.length;n++){var i=r[n],a=i.input,s=i.output,l=this.activate(a,void 0,!1);o+=e.calc(s,l)}return o/t.length},t.prototype.toJSON=function(){for(var t={nodes:[],connections:[],inputSize:this.inputSize,outputSize:this.outputSize},e=0;e<this.nodes.length;e++)this.nodes[e].index=e;return this.nodes.forEach(function(e){t.nodes.push(e.toJSON()),0!==e.selfConnection.weight&&t.connections.push(e.selfConnection.toJSON())}),this.connections.forEach(function(e){return t.connections.push(e.toJSON())}),t},t.prototype.evolve=function(t,e){var o,n,r;return aa(this,void 0,void 0,function(){var i,a,s,l,u,$,c,h;return ba(this,function(d){switch(d.label){case 0:if(t[0].input.length!==this.inputSize||t[0].output.length!==this.outputSize)throw new Error("Dataset input/output size should be same as network input/output size!");i=0,void 0===e.iterations&&void 0===e.error?(e.iterations=1e3,i=.05):e.iterations?i=-1:e.error&&(i=e.error,e.iterations=0),e.growth=b(e.growth,1e-4),e.loss=b(e.loss,new A),e.amount=b(e.amount,1),e.fitnessPopulation=b(e.fitnessPopulation,!1),e.maxNodes=b(e.maxNodes,1/0),e.maxConnections=b(e.maxConnections,1/0),e.maxGates=b(e.maxGates,1/0),a=Date.now(),e.fitnessFunction=function(t,o){return aa(this,void 0,void 0,function(){var n=this;return ba(this,function(r){switch(r.label){case 0:return Array.isArray(o)||(o=[o]),[4,Promise.all(o.map(function(o){return aa(n,void 0,void 0,function(){var n,r,i,a,s;return ba(this,function(l){for(n=0,r=0;r<(null!==(i=e.amount)&&void 0!==i?i:1);r++)n-=o.test(t,e.loss);return n-=null!==(a=e.growth)&&void 0!==a?a:1e-4*(o.nodes.length-o.inputSize-o.outputSize+o.connections.length+o.gates.length),o.score=n/(null!==(s=e.amount)&&void 0!==s?s:1),[2]})})}))];case 1:return r.sent(),[2];}})})},e.fitnessPopulation=!0,e.template=this,e.input=this.inputSize,e.output=this.outputSize,s=new _(t,e),l=-1/0,u=-1/0,d.label=1;case 1:return l<-i&&(0===e.iterations||s.generation<(null!==(o=e.iterations)&&void 0!==o?o:0))?[4,s.evolve(void 0,void 0)]:[3,3];case 2:return c=d.sent(),h=void 0===c.score?-1/0:c.score,l=h+e.growth*(c.nodes.length-c.inputSize-c.outputSize+c.connections.length+c.gates.length),h>u&&(u=h,$=c),(null!==(n=e.log)&&void 0!==n?n:0)>0&&s.generation%(null!==(r=e.log)&&void 0!==r?r:0)==0&&console.log("iteration",s.generation,"fitness",h,"error",-l),e.schedule&&s.generation%e.schedule.iterations==0&&e.schedule.function(h,-l,s.generation),[3,1];case 3:return void 0!==$&&(this.nodes=$.nodes,this.connections=$.connections,this.gates=$.gates,e.clear&&this.clear()),[2,{error:-l,iterations:s.generation,time:Date.now()-a}];}})})},t}(),N=zc;w.Network=N;var Ya,ca={};Object.defineProperty(ca,"__esModule",{value:!0});var Za;!function(t){t[t.INPUT=0]="INPUT",t[t.HIDDEN=1]="HIDDEN",t[t.OUTPUT=2]="OUTPUT"}(Za=Ya||(Ya={},ca.NodeType=Ya));var Ac=function(){function t(t){void 0===t&&(t=Za.HIDDEN),this.type=t,this.bias=s(-1,1),this.squash=new P,this.activation=0,this.state=0,this.old=0,this.mask=1,this.deltaBiasPrevious=0,this.deltaBiasTotal=0,this.incoming=[],this.outgoing=[],this.gated=[],this.selfConnection=new q(this,this,0),this.errorResponsibility=0,this.errorProjected=0,this.errorGated=0,this.index=NaN}return t.fromJSON=function(i){var e=new t;return e.bias=i.bias,e.type=i.type,e.squash=u.getActivation(i.squash),e.mask=i.mask,e.index=i.index,e},t.prototype.clear=function(){for(var t=0,i=this.incoming;t<i.length;t++){(s=i[t]).eligibility=0,s.xTraceNodes=[],s.xTraceValues=[]}for(var e=0,o=this.gated;e<o.length;e++){var s;(s=o[e]).gain=0}this.errorResponsibility=this.errorProjected=this.errorGated=0,this.old=this.state=this.activation=0},t.prototype.mutateBias=function(t){this.bias+=s(t.min,t.max)},t.prototype.mutateActivation=function(){var t;do{t=k(D)}while(t===this.squash.type);this.squash=u.getActivation(t)},t.prototype.isProjectedBy=function(t){return t===this?0!==this.selfConnection.weight:v(this.incoming.map(function(t){return t.from}),t)},t.prototype.isProjectingTo=function(t){return t===this?0!==this.selfConnection.weight:v(this.outgoing.map(function(t){return t.to}),t)},t.prototype.addGate=function(t){this.gated.push(t),t.gateNode=this},t.prototype.removeGate=function(t){m(this.gated,t),t.gateNode=null,t.gain=1},t.prototype.connect=function(t,i,e){if(void 0===i&&(i=0),void 0===e&&(e=!1),t===this)return this.selfConnection.weight=i||1,this.selfConnection;if(this.isProjectingTo(t))throw new ReferenceError;var o=new q(this,t,i);return this.outgoing.push(o),t.incoming.push(o),e&&t.connect(this),o},t.prototype.disconnect=function(t,i){if(void 0===i&&(i=!1),t===this)return this.selfConnection.weight=0,this.selfConnection;for(var e=0,o=this.outgoing;e<o.length;e++){var s=o[e];if(s.to===t)return m(this.outgoing,s),m(s.to.incoming,s),void 0!==s.gateNode&&null!=s.gateNode&&s.gateNode.removeGate(s),i&&t.disconnect(this),s}throw new Error("No connection found!")},t.prototype.propagate=function(t,i,e,o){if(void 0!==t&&Number.isFinite(t))this.errorResponsibility=this.errorProjected=t-this.activation;else{this.errorProjected=0;for(var s=0,r=this.outgoing;s<r.length;s++){var a=r[s];this.errorProjected+=a.to.errorResponsibility*a.weight*a.gain}this.errorProjected*=this.derivative||1,this.errorGated=0;for(var n=0,h=this.gated;n<h.length;n++){var c=void 0;c=($=(a=h[n]).to).selfConnection.gateNode===this?$.old+a.weight*a.from.activation:a.weight*a.from.activation,this.errorGated+=$.errorResponsibility*c}this.errorGated*=this.derivative||1,this.errorResponsibility=this.errorProjected+this.errorGated}for(var l=0,v=this.incoming;l<v.length;l++){a=v[l];for(var f=this.errorProjected*a.eligibility,d=0;d<a.xTraceNodes.length;d++){var $;f+=($=a.xTraceNodes[d]).errorResponsibility*a.xTraceValues[d]}a.deltaWeightsTotal+=e*f*this.mask,o&&(a.deltaWeightsTotal+=i*a.deltaWeightsPrevious,a.weight+=a.deltaWeightsTotal,a.deltaWeightsPrevious=a.deltaWeightsTotal,a.deltaWeightsTotal=0)}return this.deltaBiasTotal+=e*this.errorResponsibility,o&&(this.deltaBiasTotal+=i*this.deltaBiasPrevious,this.bias+=this.deltaBiasTotal,this.deltaBiasPrevious=this.deltaBiasTotal,this.deltaBiasTotal=0),{responsibility:this.errorResponsibility,projected:this.errorProjected,gated:this.errorGated}},t.prototype.activate=function(t,i){var e=this;if(void 0===t&&(t=null),void 0===i&&(i=!0),null!==t&&Number.isFinite(t))return this.activation=t;if(i){this.old=this.state,this.state=this.selfConnection.gain*this.selfConnection.weight*this.state+this.bias,this.incoming.forEach(function(t){e.state+=t.from.activation*t.weight*t.gain}),this.activation=this.squash.calc(this.state,!1)*this.mask,this.derivative=this.squash.calc(this.state,!0);var o=[],s=[];this.gated.forEach(function(t){t.gain=e.activation;var i=o.indexOf(t.to);i>-1?s[i]+=t.weight*t.from.activation:(o.push(t.to),t.to.selfConnection.gateNode===e?s.push(t.weight*t.from.activation+t.to.old):s.push(t.weight*t.from.activation))});for(var r=0,a=this.incoming;r<a.length;r++){(d=a[r]).eligibility=this.selfConnection.gain*this.selfConnection.weight*d.eligibility+d.from.activation*d.gain;for(var n=0;n<o.length;n++){var h=o[n],c=s[n],l=d.xTraceNodes.indexOf(h);l>-1?d.xTraceValues[l]=h.selfConnection.gain*h.selfConnection.weight*d.xTraceValues[l]+this.derivative*d.eligibility*c:(d.xTraceNodes.push(h),d.xTraceValues.push(this.derivative*d.eligibility*c))}}return this.activation}if(this.type===Za.INPUT)return this.activation=0;this.state=this.selfConnection.gain*this.selfConnection.weight*this.state+this.bias;for(var v=0,f=this.incoming;v<f.length;v++){var d=f[v];this.state+=d.from.activation*d.weight*d.gain}this.activation=this.squash.calc(this.state,!1);for(var $=0,g=this.gated;$<g.length;$++){(d=g[$]).gain=this.activation}return this.activation},t.prototype.toJSON=function(){return{bias:this.bias,type:this.type,squash:this.squash.type,mask:this.mask,index:this.index}},t}(),$a=Ac;ca.Node=$a;var c={};Object.defineProperty(c,"__esModule",{value:!0});var Bc=i;c.Layer=Bc;var Cc=ea;c.ConvolutionLayer=Cc;var Dc=xa;c.DenseLayer=Dc;var Ec=ya;c.GaussianNoiseLayer=Ec;var Fc=za;c.InputLayer=Fc;var Gc=Aa;c.LSTMLayer=Gc;var Hc=Ca;c.PoolLayer=Hc;var Ic=Da;c.RNNLayer=Ic;var Jc=Fa;c.Architect=Jc;var Kc=q;c.Connection=Kc;var Lc=N;c.Network=Lc;var Mc=$a;c.Node=Mc;var Nc=u;c.Activation=Nc;var Oc=Ta;c.Loss=Oc;var Pc=Ga;c.Mutation=Pc;var Qc=Ua;c.Rate=Qc;var Rc=Wa;c.Selection=Rc;var Sc=_;c.NEAT=Sc;if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=c}else if(typeof define==="function"&&define.amd){define(function(){return c})}else{this["carrot"]=c}})();