{"version":3,"sources":["../src/enums/ConnectionType.js","../src/enums/GatingType.js","../src/architecture/Layers/Layer.js","../src/methods/Utils.js","../src/enums/NodeType.js","../src/methods/Mutation.js","../src/enums/ActivationType.js","../src/methods/Activation.js","../src/architecture/Connection.js","../src/architecture/Node.js","../src/architecture/Layers/CoreLayers/DenseLayer.js","../src/architecture/Nodes/ConstantNode.js","../src/architecture/Nodes/DropoutNode.js","../src/architecture/Layers/CoreLayers/DropoutLayer.js","../src/architecture/Nodes/NoiseNode.js","../src/architecture/Layers/NoiseLayers/NoiseLayer.js","../src/architecture/Layers/CoreLayers/OutputLayer.js","../src/architecture/Layers/CoreLayers/InputLayer.js","../src/architecture/Nodes/PoolNode.js","../src/architecture/Layers/PoolingLayers/PoolingLayer.js","../src/architecture/Layers/PoolingLayers/AvgPooling1DLayer.js","../src/architecture/Layers/PoolingLayers/MinPooling1DLayer.js","../src/architecture/Layers/PoolingLayers/MaxPooling1DLayer.js","../src/architecture/Layers/PoolingLayers/GlobalAvgPooling1DLayer.js","../src/architecture/Layers/PoolingLayers/GlobalMaxPooling1DLayer.js","../src/architecture/Layers/PoolingLayers/GlobalMinPooling1DLayer.js","../src/architecture/Layers/RecurrentLayers/GRULayer.js","../src/architecture/Layers/RecurrentLayers/LSTMLayer.js","../src/architecture/Layers/RecurrentLayers/MemoryLayer.js","../src/methods/Loss.js","../src/methods/Rate.js","../src/methods/Selection.js","../src/NEAT.js","../src/architecture/Network.js","../src/architecture/Architect.js","index.js"],"names":["Object","defineProperty","exports","value","ConnectionType","GatingType","ConnectionType_1","require","GatingType_1","Layer","outputSize","nodes","inputNodes","Set","outputNodes","connections","gates","connect","from","to","connectionType","weight","ALL_TO_ALL","NO_CONNECTION","ReferenceError","fromNodes","Array","toNodes","length","forEach","fromNode","toNode","push","ONE_TO_ONE","RangeError","i","POOLING","ratio_1","apply","map","node","index","Math","floor","gate","gateType","gatedConnections","INPUT","conn","_loop_1","gateNode","incoming","filter","includes","addGate","SELF","selfConnection","OUTPUT","_loop_2","outgoing","prototype","getDefaultIncomingConnectionType","connectionTypeisAllowed","type","pickRandom","arr","randInt","min","max","random","randDouble","randBoolean","removeFromArray","elem","indexOf","splice","getOrDefault","defaultValue","shuffle","array","counter","temp","maxValue","Infinity","_i","array_1","maxValueIndex","minValueIndex","minValue","array_2","avg","sum","array_3","generateGaussian","mean","deviation","numSamples","NodeType","PoolNodeType","NoiseNodeType","__extends","extendStatics","d","b","setPrototypeOf","__proto__","p","hasOwnProperty","__","constructor","create","Node_1","Utils_1","NodeType_1","Mutation","AddNodeMutation","_super","randomActivation","_this","call","mutate","network","options","undefined","maxNodes","Node","HIDDEN","mutateActivation","connection","disconnect","minBound","inputSize","newConnection1","newConnection2","SubNodeMutation","keepGates","possible","isHiddenNode","removeNode","AddConnectionMutation","arguments","maxConnections","j","isProjectingTo","pair","SubConnectionMutation","randomConnection","ModWeightMutation","ModBiasMutation","isInputNode","mutateBias","ModActivationMutation","mutateOutput","allowedActivations","AddSelfConnectionMutation","SubSelfConnectionMutation","AddGateMutation","maxGates","SubGateMutation","removeGate","AddBackConnectionMutation","SubBackConnectionMutation","SwapNodesMutation","node1_1","node2","biasTemp","bias","squashTemp","squash","ALL_MUTATIONS","FEEDFORWARD_MUTATIONS","NO_STRUCTURE_MUTATIONS","ONLY_STRUCTURE","ActivationType","ActivationType_1","Activation","NO_ACTIVATION","getActivation","activationType","LogisticActivation","TanhActivation","IdentityActivation","StepActivation","RELUActivation","SoftSignActivation","SinusoidActivation","GaussianActivation","BentIdentityActivation","BipolarActivation","BipolarSigmoidActivation","HardTanhActivation","AbsoluteActivation","InverseActivation","SELUActivation","ALL_ACTIVATIONS","calc","x","derivative","exp","tanh","abs","sin","cos","sqrt","alpha","scale","Connection","gain","eligibility","deltaWeightsPrevious","deltaWeightsTotal","xTraceNodes","xTraceValues","innovationID","a","toJSON","fromIndex","toIndex","gateNodeIndex","Mutation_1","Activation_1","Connection_1","activation","state","old","mask","deltaBiasPrevious","deltaBiasTotal","gated","errorResponsibility","errorProjected","errorGated","NaN","fromJSON","json","_a","_b","_c","_d","clear","method","newActivationType","isProjectedBy","target","twoSided","Error","propagate","momentum","rate","update","Number","isFinite","influence","_e","gradient","activate","input","trace","nodes_1","influences_1","isOutputNode","setBias","setSquash","Layer_1","DenseLayer","add","ConstantNode","ConstantNode_1","DropoutNode","probability","droppedOut","incomingConnection","connectionsStates","assign","DropoutNode_1","DropoutLayer","NoiseNode","noiseType","GAUSSIAN_NOISE","incomingStates","gaussian","NoiseNode_1","NoiseLayer","OutputLayer","NoiseLayer_1","InputLayer","noise","noiseLayer","PoolNode","poolingType","MAX_POOLING","receivingIndex","poolType","AVG_POOLING","MIN_POOLING","PoolingLayer","PoolNode_1","PoolingLayer_1","AvgPooling1DLayer","MinPooling1DLayer","MaxPooling1DLayer","AvgPooling1DLayer_1","GlobalAvgPooling1DLayer","MaxPooling1DLayer_1","GlobalMaxPooling1DLayer","MinPooling1DLayer_1","GlobalMinPooling1DLayer","GRULayer","_f","_g","_h","_j","_k","_l","_m","_o","_p","_q","_r","_s","_t","_u","_v","_w","updateGate","inverseUpdateGate","resetGate","memoryCell","previousOutput","reset","inverseUpdate","LSTMLayer","inputGate","forgetGate","outputGate","forgetGateConnections","outputGateConnections","inputGateConnections","MemoryLayer","prevNodes","memorySize","block","reverse","Loss","CrossEntropyLoss","targets","outputs","error","log","MSELoss","pow","BinaryLoss","round","MAELoss","MAPELoss","WAPELoss","MSLELoss","HINGELoss","ALL_LOSSES","Rate","baseRate","FixedRate","iteration","StepRate","gamma","stepSize","ExponentialRate","InverseRate","power","Selection","FitnessProportionateSelection","select","population","totalFitness","minimalFitness","population_1","genome","score","population_2","PowerSelection","TournamentSelection","size","individuals","sort","__awaiter","thisArg","_arguments","P","generator","adopt","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","pop","__spreadArrays","s","il","r","k","jl","Network_1","Selection_1","NEAT","dataset","generation","output","equal","populationSize","elitism","provenance","mutationRate","mutationAmount","fitnessFunction","selection","mutations","activations","template","Network","createInitialPopulation","filterGenome","pickGenome","adjustGenome","filtered","copy","mutateRandom","name","evolve","elitists","newPopulation","fittest","evaluate","fill","getOffspring","parent1","parent2","crossOver","getFittest","getAverage","val","Loss_1","Rate_1","NEAT_1","threads_1","nodeJSON","jsonConnection","network1","network2","offspring","score1","score2","offspringSize","chosenNode","chosenNodeType","sourceNetwork","inputNumber","outputNumber","newNode","n1connections","n2connections","keys1","keys","keys2","parseInt","key","connectionJSON","dropoutRate","inputs","shift","allowedMethods","train","iterations","loss","dropout","batchSize","ratePolicy","start","Date","now","trainingSetSize","trainingSet","testSet","crossValidateTestSize","ceil","slice","currentTrainingRate","iterationCount","trainError","trainEpoch","test","console","schedule","function","time","trainingRate","errorSum","correctOutput","dataset_1","entry","connJSON","targetError","serializedDataSet","workerPool","neat","bestFitness","bestGenome","fitness","growth","amount","threads","JSON","stringify","Pool","spawn","Worker","queue","settled","terminate","InputLayer_1","OutputLayer_1","Architect","layers","addLayer","layer","incomingConnectionType","buildModel","DenseLayer_1","DropoutLayer_1","GlobalAvgPooling1DLayer_1","GlobalMaxPooling1DLayer_1","GlobalMinPooling1DLayer_1","GRULayer_1","LSTMLayer_1","MemoryLayer_1","Architect_1"],"mappings":"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","file":"index.browser.min.js","sourceRoot":"..\\..\\build\\scripts","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ConnectionType;\r\n(function (ConnectionType) {\r\n    ConnectionType[ConnectionType[\"NO_CONNECTION\"] = 0] = \"NO_CONNECTION\";\r\n    ConnectionType[ConnectionType[\"ALL_TO_ALL\"] = 1] = \"ALL_TO_ALL\";\r\n    ConnectionType[ConnectionType[\"ONE_TO_ONE\"] = 2] = \"ONE_TO_ONE\";\r\n    ConnectionType[ConnectionType[\"POOLING\"] = 3] = \"POOLING\";\r\n})(ConnectionType = exports.ConnectionType || (exports.ConnectionType = {}));\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar GatingType;\r\n(function (GatingType) {\r\n    GatingType[GatingType[\"INPUT\"] = 0] = \"INPUT\";\r\n    GatingType[GatingType[\"SELF\"] = 1] = \"SELF\";\r\n    GatingType[GatingType[\"OUTPUT\"] = 2] = \"OUTPUT\";\r\n})(GatingType = exports.GatingType || (exports.GatingType = {}));\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ConnectionType_1 = require(\"../../enums/ConnectionType\");\r\nvar GatingType_1 = require(\"../../enums/GatingType\");\r\nvar Layer = /** @class */ (function () {\r\n    function Layer(outputSize) {\r\n        this.outputSize = outputSize;\r\n        this.nodes = [];\r\n        this.inputNodes = new Set();\r\n        this.outputNodes = new Set();\r\n        this.connections = [];\r\n        this.gates = [];\r\n    }\r\n    Layer.connect = function (from, to, connectionType, weight) {\r\n        if (connectionType === void 0) { connectionType = ConnectionType_1.ConnectionType.ALL_TO_ALL; }\r\n        if (weight === void 0) { weight = 1; }\r\n        if (connectionType === ConnectionType_1.ConnectionType.NO_CONNECTION) {\r\n            throw new ReferenceError(\"Cannot connect with 'NO_CONNECTION' connection type\");\r\n        }\r\n        var fromNodes = Array.from(from instanceof Layer ? from.outputNodes : from);\r\n        var toNodes = Array.from(to instanceof Layer ? to.inputNodes : to);\r\n        if (toNodes.length === 0) {\r\n            throw new ReferenceError(\"Target from has no input nodes!\");\r\n        }\r\n        if (fromNodes.length === 0) {\r\n            throw new ReferenceError(\"This from has no output nodes!\");\r\n        }\r\n        var connections = [];\r\n        if (connectionType === ConnectionType_1.ConnectionType.ALL_TO_ALL) {\r\n            fromNodes.forEach(function (fromNode) {\r\n                toNodes.forEach(function (toNode) {\r\n                    connections.push(fromNode.connect(toNode, weight)); // connect every \"from node\" to every \"to node\"\r\n                });\r\n            });\r\n        }\r\n        else if (connectionType === ConnectionType_1.ConnectionType.ONE_TO_ONE) {\r\n            if (fromNodes.length !== toNodes.length) {\r\n                throw new RangeError(\"Can't connect one to one! Number of output nodes from are unequal number of incoming nodes from next layer!\");\r\n            }\r\n            for (var i = 0; i < fromNodes.length; i++) {\r\n                connections.push(fromNodes[i].connect(toNodes[i], weight)); // connect every nodes with same indices\r\n            }\r\n        }\r\n        else if (connectionType === ConnectionType_1.ConnectionType.POOLING) {\r\n            // connect the same amount of input nodes to every output node\r\n            // every input node has only one connection available\r\n            var ratio_1 = toNodes.length / fromNodes.length;\r\n            connections.push.apply(connections, fromNodes.map(function (node, index) { return node.connect(toNodes[Math.floor(index * ratio_1)], weight); }));\r\n        }\r\n        return connections;\r\n    };\r\n    Layer.gate = function (nodes, connections, gateType) {\r\n        var gatedConnections = [];\r\n        switch (gateType) {\r\n            case GatingType_1.GatingType.INPUT: { // gate incoming connections\r\n                var toNodes = Array.from(new Set(connections.map(function (conn) { return conn.to; })));\r\n                var _loop_1 = function (i) {\r\n                    var node = toNodes[i];\r\n                    var gateNode = nodes[i % nodes.length];\r\n                    node.incoming\r\n                        .filter(function (conn) { return connections.includes(conn); })\r\n                        .forEach(function (conn) {\r\n                        gateNode.addGate(conn);\r\n                        gatedConnections.push(conn);\r\n                    });\r\n                };\r\n                for (var i = 0; i < toNodes.length; i++) {\r\n                    _loop_1(i);\r\n                }\r\n                break;\r\n            }\r\n            case GatingType_1.GatingType.SELF: { // gate self connections\r\n                var fromNodes = Array.from(new Set(connections.map(function (conn) { return conn.from; })));\r\n                for (var i = 0; i < fromNodes.length; i++) {\r\n                    if (connections.includes(fromNodes[i].selfConnection)) {\r\n                        nodes[i % nodes.length].addGate(fromNodes[i].selfConnection);\r\n                        gatedConnections.push(fromNodes[i].selfConnection);\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case GatingType_1.GatingType.OUTPUT: { // gate outgoing connections\r\n                var fromNodes = Array.from(new Set(connections.map(function (conn) { return conn.from; })));\r\n                var _loop_2 = function (i) {\r\n                    var node = fromNodes[i];\r\n                    var gateNode = nodes[i % nodes.length];\r\n                    node.outgoing\r\n                        .filter(function (conn) { return connections.includes(conn); })\r\n                        .forEach(function (conn) {\r\n                        gateNode.addGate(conn);\r\n                        gatedConnections.push(conn);\r\n                    });\r\n                };\r\n                for (var i = 0; i < fromNodes.length; i++) {\r\n                    _loop_2(i);\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        return gatedConnections;\r\n    };\r\n    Layer.prototype.getDefaultIncomingConnectionType = function () {\r\n        return ConnectionType_1.ConnectionType.ALL_TO_ALL;\r\n    };\r\n    Layer.prototype.connectionTypeisAllowed = function (type) {\r\n        return true;\r\n    };\r\n    return Layer;\r\n}());\r\nexports.Layer = Layer;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * Returns an random element from the given array.\r\n *\r\n * @param arr the array to pick from\r\n * @returns the random picked element\r\n */\r\nfunction pickRandom(arr) {\r\n    if (arr.length === 0) {\r\n        throw new RangeError(\"Cannot pick from an empty array\");\r\n    }\r\n    return arr[randInt(0, arr.length)];\r\n}\r\nexports.pickRandom = pickRandom;\r\n/**\r\n * Returns a random integer in the range [min,max)\r\n *\r\n * @param min bound\r\n * @param max bound\r\n * @returns random integer in [min,max)\r\n */\r\nfunction randInt(min, max) {\r\n    return Math.floor(Math.random() * (max - min) + min);\r\n}\r\nexports.randInt = randInt;\r\n/**\r\n * Returns a random double in the range [min,max)\r\n *\r\n * @param min bound\r\n * @param max bound\r\n * @returns random double in [min,max)\r\n */\r\nfunction randDouble(min, max) {\r\n    return Math.random() * (max - min) + min;\r\n}\r\nexports.randDouble = randDouble;\r\n/**\r\n * Returns a random boolean\r\n *\r\n * @returns random boolean\r\n */\r\nfunction randBoolean() {\r\n    return Math.random() >= 0.5;\r\n}\r\nexports.randBoolean = randBoolean;\r\n/**\r\n * Removes an element from an array.\r\n *\r\n * @param arr the array\r\n * @param elem the element which will be removed\r\n * @returns false -> element does not exists on array; true -> element removed from array\r\n */\r\nfunction removeFromArray(arr, elem) {\r\n    var index = arr.indexOf(elem);\r\n    if (index === -1) {\r\n        return false;\r\n    }\r\n    else {\r\n        arr.splice(index, 1);\r\n        return true;\r\n    }\r\n}\r\nexports.removeFromArray = removeFromArray;\r\n/**\r\n * Checks a given value. If value is undefined return the default value.\r\n *\r\n * @param value to check\r\n * @param defaultValue to return if value is undefined\r\n * @returns value if defined otherwise defaultValue\r\n */\r\nfunction getOrDefault(value, defaultValue) {\r\n    return value !== null && value !== void 0 ? value : defaultValue;\r\n}\r\nexports.getOrDefault = getOrDefault;\r\n/**\r\n * Shuffles an aray\r\n * @param array the array\r\n * @returns the shuffled array\r\n */\r\nfunction shuffle(array) {\r\n    var counter = array.length;\r\n    // While there are elements in the array\r\n    while (counter > 0) {\r\n        // Pick a random index\r\n        var index = randInt(0, counter);\r\n        // Decrease counter by 1\r\n        counter--;\r\n        // And swap the last element with it\r\n        var temp = array[counter];\r\n        array[counter] = array[index];\r\n        array[index] = temp;\r\n    }\r\n    return array;\r\n}\r\nexports.shuffle = shuffle;\r\nfunction max(array) {\r\n    var maxValue = -Infinity;\r\n    for (var _i = 0, array_1 = array; _i < array_1.length; _i++) {\r\n        var value = array_1[_i];\r\n        if (value > maxValue) {\r\n            maxValue = value;\r\n        }\r\n    }\r\n    return maxValue;\r\n}\r\nexports.max = max;\r\nfunction maxValueIndex(array) {\r\n    var maxValue = array[0];\r\n    var maxValueIndex = 0;\r\n    for (var i = 0; i < array.length; i++) {\r\n        if (array[i] > maxValue) {\r\n            maxValue = array[i];\r\n            maxValueIndex = i;\r\n        }\r\n    }\r\n    return maxValueIndex;\r\n}\r\nexports.maxValueIndex = maxValueIndex;\r\nfunction minValueIndex(array) {\r\n    var minValue = array[0];\r\n    var minValueIndex = 0;\r\n    for (var i = 0; i < array.length; i++) {\r\n        if (array[i] < minValue) {\r\n            minValue = array[i];\r\n            minValueIndex = i;\r\n        }\r\n    }\r\n    return minValueIndex;\r\n}\r\nexports.minValueIndex = minValueIndex;\r\nfunction min(array) {\r\n    var minValue = Infinity;\r\n    for (var _i = 0, array_2 = array; _i < array_2.length; _i++) {\r\n        var value = array_2[_i];\r\n        if (value < minValue) {\r\n            minValue = value;\r\n        }\r\n    }\r\n    return minValue;\r\n}\r\nexports.min = min;\r\nfunction avg(array) {\r\n    return sum(array) / array.length;\r\n}\r\nexports.avg = avg;\r\nfunction sum(array) {\r\n    var sum = 0;\r\n    for (var _i = 0, array_3 = array; _i < array_3.length; _i++) {\r\n        var value = array_3[_i];\r\n        sum += value;\r\n    }\r\n    return sum;\r\n}\r\nexports.sum = sum;\r\nfunction generateGaussian(mean, deviation) {\r\n    if (mean === void 0) { mean = 0; }\r\n    if (deviation === void 0) { deviation = 2; }\r\n    var sum = 0;\r\n    var numSamples = 10;\r\n    for (var i = 0; i < numSamples; i++) {\r\n        sum += Math.random();\r\n    }\r\n    return deviation * sum / numSamples + mean - 0.5 * deviation;\r\n}\r\nexports.generateGaussian = generateGaussian;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar NodeType;\r\n(function (NodeType) {\r\n    NodeType[NodeType[\"INPUT\"] = 0] = \"INPUT\";\r\n    NodeType[NodeType[\"HIDDEN\"] = 1] = \"HIDDEN\";\r\n    NodeType[NodeType[\"OUTPUT\"] = 2] = \"OUTPUT\";\r\n    NodeType[NodeType[\"POOL_NODE\"] = 3] = \"POOL_NODE\";\r\n})(NodeType = exports.NodeType || (exports.NodeType = {}));\r\nvar PoolNodeType;\r\n(function (PoolNodeType) {\r\n    PoolNodeType[PoolNodeType[\"MAX_POOLING\"] = 0] = \"MAX_POOLING\";\r\n    PoolNodeType[PoolNodeType[\"AVG_POOLING\"] = 1] = \"AVG_POOLING\";\r\n    PoolNodeType[PoolNodeType[\"MIN_POOLING\"] = 2] = \"MIN_POOLING\";\r\n})(PoolNodeType = exports.PoolNodeType || (exports.PoolNodeType = {}));\r\nvar NoiseNodeType;\r\n(function (NoiseNodeType) {\r\n    NoiseNodeType[NoiseNodeType[\"GAUSSIAN_NOISE\"] = 0] = \"GAUSSIAN_NOISE\";\r\n})(NoiseNodeType = exports.NoiseNodeType || (exports.NoiseNodeType = {}));\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Node_1 = require(\"../architecture/Node\");\r\nvar Utils_1 = require(\"./Utils\");\r\nvar NodeType_1 = require(\"../enums/NodeType\");\r\n/**\r\n *\r\n * Genetic algorithm mutation methods. Creates variations (mutations) in neural networks which are then selected for better performance.\r\n *\r\n * @see {@link https://en.wikipedia.org/wiki/mutation_(genetic_algorithm)|Mutation (genetic algorithms) on Wikipedia}\r\n * @see {@link https://en.wikipedia.org/wiki/Genetic_algorithm#Selection|Selection (genetic algorithms) on Wikipedia}\r\n *\r\n * @example <caption>Mutation methods with networks</caption>\r\n *\r\n * let myNetwork = new Network(5, 5);\r\n *\r\n * // Setting a mutation method for a network\r\n * myNetwork.mutate(new AddNodeMutation());\r\n *\r\n * // specifying a list of network mutation methods to use during evolution\r\n * myNetwork.evolve(trainingset, {\r\n *  mutation: [new AddNodeMutation(),new ModBiasMutation()]\r\n * }\r\n *\r\n * @example <caption>Using a mutation method with a neuron</caption>\r\n *\r\n * let myNode = new Node(NodeType.HIDDEN);\r\n *\r\n * myNode.mutateBias(new ModBiasMutation(-0.5,0.3));\r\n */\r\nvar Mutation = /** @class */ (function () {\r\n    function Mutation() {\r\n    }\r\n    return Mutation;\r\n}());\r\nexports.Mutation = Mutation;\r\n/**\r\n * Add node mutation.\r\n *\r\n * Adds a hidden node to the network.\r\n *\r\n * @prop {boolean} randomActivation=true If enabled, sets a random activation function on the newly created node\r\n *\r\n * @example\r\n *\r\n * let myNetwork = new Network(5, 5);\r\n *\r\n * myNetwork.mutate(new AddNodeMutation());\r\n */\r\nvar AddNodeMutation = /** @class */ (function (_super) {\r\n    __extends(AddNodeMutation, _super);\r\n    function AddNodeMutation(randomActivation) {\r\n        if (randomActivation === void 0) { randomActivation = true; }\r\n        var _this = _super.call(this) || this;\r\n        _this.randomActivation = randomActivation;\r\n        return _this;\r\n    }\r\n    AddNodeMutation.prototype.mutate = function (network, options) {\r\n        // check if max nodes is already reached\r\n        if (options !== undefined && options.maxNodes !== undefined && network.nodes.length >= options.maxNodes) {\r\n            return;\r\n        }\r\n        // create a new hidden node\r\n        var node = new Node_1.Node(NodeType_1.NodeType.HIDDEN);\r\n        if (this.randomActivation) {\r\n            node.mutateActivation(); // choose random activation\r\n        }\r\n        // take a random connection\r\n        var connection = Utils_1.pickRandom(network.connections);\r\n        var from = connection.from;\r\n        var to = connection.to;\r\n        network.disconnect(from, to); // disconnect it\r\n        // put the node in between the connection\r\n        var minBound = Math.max(network.inputSize, 1 + network.nodes.indexOf(from));\r\n        network.nodes.splice(minBound, 0, node);\r\n        var newConnection1 = network.connect(from, node, 1);\r\n        var newConnection2 = network.connect(node, to, connection.weight);\r\n        if (connection.gateNode != null) {\r\n            // if connection had a gate node\r\n            // choose randomly which new connection should get this gate node\r\n            if (Utils_1.randBoolean()) {\r\n                network.addGate(connection.gateNode, newConnection1);\r\n            }\r\n            else {\r\n                network.addGate(connection.gateNode, newConnection2);\r\n            }\r\n        }\r\n    };\r\n    return AddNodeMutation;\r\n}(Mutation));\r\nexports.AddNodeMutation = AddNodeMutation;\r\n/**\r\n * Sub node mutation.\r\n *\r\n * Removes a random node from the network.\r\n *\r\n * @prop keepGates=true Ensures replacement node has gated connections if the removed node did.\r\n *\r\n * @example\r\n * let myNetwork = new Network(5, 5);\r\n *\r\n * myNetwork.mutate(new AddNodeMutation()); // Network will have one hidden node\r\n * myNetwork.mutate(new SubNodeMutation()); // Network will have no hidden node\r\n */\r\nvar SubNodeMutation = /** @class */ (function (_super) {\r\n    __extends(SubNodeMutation, _super);\r\n    function SubNodeMutation(keepGates) {\r\n        if (keepGates === void 0) { keepGates = true; }\r\n        var _this = _super.call(this) || this;\r\n        _this.keepGates = keepGates;\r\n        return _this;\r\n    }\r\n    SubNodeMutation.prototype.mutate = function (network) {\r\n        var possible = network.nodes.filter(function (node) { return node !== undefined && node.isHiddenNode(); }); // hidden nodes\r\n        if (possible.length > 0) {\r\n            network.removeNode(Utils_1.pickRandom(possible)); // remove a random node from the filtered array\r\n        }\r\n    };\r\n    return SubNodeMutation;\r\n}(Mutation));\r\nexports.SubNodeMutation = SubNodeMutation;\r\n/**\r\n * Add connections mutation.\r\n *\r\n * Adds a connection to the network.\r\n *\r\n * @example\r\n *\r\n * let myNetwork = new Network(5, 5);\r\n *\r\n * myNetwork.mutate(new AddNodeMutation()); // adds a hidden node\r\n * myNetwork.mutate(new AddConnectionMutation()); // creates a random forward pointing connection\r\n */\r\nvar AddConnectionMutation = /** @class */ (function (_super) {\r\n    __extends(AddConnectionMutation, _super);\r\n    function AddConnectionMutation() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    AddConnectionMutation.prototype.mutate = function (network, options) {\r\n        // check if max connections is already reached\r\n        if (options !== undefined && options.maxConnections !== undefined && network.connections.length >= options.maxConnections) {\r\n            return;\r\n        }\r\n        var possible = [];\r\n        for (var i = 0; i < network.nodes.length - network.outputSize; i++) {\r\n            var from = network.nodes[i];\r\n            for (var j = Math.max(i + 1, network.inputSize); j < network.nodes.length; j++) {\r\n                var to = network.nodes[j];\r\n                if (!from.isProjectingTo(to)) {\r\n                    possible.push([from, to]);\r\n                }\r\n            }\r\n        }\r\n        if (possible.length > 0) {\r\n            var pair = Utils_1.pickRandom(possible);\r\n            network.connect(pair[0], pair[1]);\r\n        }\r\n    };\r\n    return AddConnectionMutation;\r\n}(Mutation));\r\nexports.AddConnectionMutation = AddConnectionMutation;\r\n/**\r\n * Sub connection mutation.\r\n *\r\n * Removes a random connection from the network.\r\n *\r\n * @example\r\n *\r\n * let myNetwork = new Network(5, 5);\r\n *\r\n * myNetwork.mutate(new SubConnectionMutation());\r\n */\r\nvar SubConnectionMutation = /** @class */ (function (_super) {\r\n    __extends(SubConnectionMutation, _super);\r\n    function SubConnectionMutation() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    SubConnectionMutation.prototype.mutate = function (network) {\r\n        var possible = network.connections\r\n            .filter(function (conn) { return conn.from.outgoing.length > 1; }) // do not deactivate a neuron\r\n            .filter(function (conn) { return conn.to.incoming.length > 1; }) // do not deactivate a neuron\r\n            .filter(function (conn) { return network.nodes.indexOf(conn.to) > network.nodes.indexOf(conn.from); }); // look for forward pointing connections\r\n        if (possible.length > 0) {\r\n            var randomConnection = Utils_1.pickRandom(possible); // pick a random connection from the filtered array\r\n            network.disconnect(randomConnection.from, randomConnection.to); // remove the connection from the network\r\n        }\r\n    };\r\n    return SubConnectionMutation;\r\n}(Mutation));\r\nexports.SubConnectionMutation = SubConnectionMutation;\r\n/**\r\n * Mod weight mutation.\r\n *\r\n * Modifies the weight of a random connection.\r\n *\r\n * @prop {number} min=-1 lower bound for weight modification\r\n * @prop {number} max=1 higher bound for weight modification\r\n *\r\n * @example\r\n *\r\n * let myNetwork = new Network(5, 5);\r\n *\r\n * myNetwork.mutate(new ModWeightMutation()); // modifies the weight of a random connection\r\n */\r\nvar ModWeightMutation = /** @class */ (function (_super) {\r\n    __extends(ModWeightMutation, _super);\r\n    function ModWeightMutation(min, max) {\r\n        if (min === void 0) { min = -1; }\r\n        if (max === void 0) { max = 1; }\r\n        var _this = _super.call(this) || this;\r\n        _this.min = min;\r\n        _this.max = max;\r\n        return _this;\r\n    }\r\n    ModWeightMutation.prototype.mutate = function (network) {\r\n        // pick random connection and mutate it's weight\r\n        Utils_1.pickRandom(network.connections).weight += Utils_1.randDouble(this.min, this.max);\r\n    };\r\n    return ModWeightMutation;\r\n}(Mutation));\r\nexports.ModWeightMutation = ModWeightMutation;\r\n/**\r\n * Mod bias mutation.\r\n *\r\n * Modifies the bias value of a random hidden or output node\r\n *\r\n * @prop {number} min=-1 lower bound for modification of a neuron's bias\r\n * @prop {number} max=1 higher bound for modification of a neuron's bias\r\n *\r\n * @example\r\n *\r\n * let myNetwork = new Network(5, 5);\r\n *\r\n * let myNode = new Node();\r\n *\r\n * myNode.mutate(new ModBiasMutation());\r\n */\r\nvar ModBiasMutation = /** @class */ (function (_super) {\r\n    __extends(ModBiasMutation, _super);\r\n    function ModBiasMutation(min, max) {\r\n        if (min === void 0) { min = -1; }\r\n        if (max === void 0) { max = 1; }\r\n        var _this = _super.call(this) || this;\r\n        _this.min = min;\r\n        _this.max = max;\r\n        return _this;\r\n    }\r\n    ModBiasMutation.prototype.mutate = function (network) {\r\n        Utils_1.pickRandom(network.nodes.filter(function (node) { return !node.isInputNode(); })) // pick random hidden or output node\r\n            .mutateBias(this); // mutate it's bias\r\n    };\r\n    return ModBiasMutation;\r\n}(Mutation));\r\nexports.ModBiasMutation = ModBiasMutation;\r\n/**\r\n * Mod activation mutation.\r\n *\r\n * Modifies the activation function of a random node\r\n *\r\n * @prop {boolean} mutateOutput=false Change activation function of network output neurons. Enable this to let the network experiment with its output.\r\n *\r\n * @example <caption>Mutating the activation function of a node</caption>\r\n * let myNode = new Node();\r\n *\r\n * myNode.mutate(new ModActivationMutation());\r\n */\r\nvar ModActivationMutation = /** @class */ (function (_super) {\r\n    __extends(ModActivationMutation, _super);\r\n    function ModActivationMutation(mutateOutput) {\r\n        if (mutateOutput === void 0) { mutateOutput = false; }\r\n        var _this = _super.call(this) || this;\r\n        _this.mutateOutput = mutateOutput;\r\n        return _this;\r\n    }\r\n    ModActivationMutation.prototype.mutate = function (network, options) {\r\n        var possible = this.mutateOutput\r\n            ? network.nodes.filter(function (node) { return !node.isInputNode(); }) // hidden and output nodes\r\n            : network.nodes.filter(function (node) { return node.isHiddenNode(); }); // hidden nodes\r\n        if (possible.length > 0) {\r\n            Utils_1.pickRandom(possible).mutateActivation(options === null || options === void 0 ? void 0 : options.allowedActivations); // mutate the activation of the node\r\n        }\r\n    };\r\n    return ModActivationMutation;\r\n}(Mutation));\r\nexports.ModActivationMutation = ModActivationMutation;\r\n/**\r\n * Add self connection.\r\n *\r\n * Adds a connection from a node to itself.\r\n *\r\n * @example\r\n * let myNetwork = new Network(5, 5);\r\n *\r\n * myNetwork.mutate(new AddSelfConnectionMutation());\r\n */\r\nvar AddSelfConnectionMutation = /** @class */ (function (_super) {\r\n    __extends(AddSelfConnectionMutation, _super);\r\n    function AddSelfConnectionMutation() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    AddSelfConnectionMutation.prototype.mutate = function (network) {\r\n        var possible = network.nodes\r\n            .filter(function (node) { return !node.isInputNode(); }) // no input nodes\r\n            .filter(function (node) { return node.selfConnection.weight === 0; }); // only nodes that doesn't have an self connection already\r\n        if (possible.length > 0) {\r\n            var node = Utils_1.pickRandom(possible); // pick a random node from the filtered array\r\n            network.connect(node, node); // connection the node to itself\r\n        }\r\n    };\r\n    return AddSelfConnectionMutation;\r\n}(Mutation));\r\nexports.AddSelfConnectionMutation = AddSelfConnectionMutation;\r\n/**\r\n * Sub self connection.\r\n *\r\n * Removes a connection from a node to itself.\r\n *\r\n * @example\r\n * let myNetwork = new Network(5, 5);\r\n *\r\n * myNetwork.mutate(new AddSelfConnectionMutation()); // add a self connection\r\n * myNetwork.mutate(new SubSelfConnectionMutation()); // remove a self connection\r\n */\r\nvar SubSelfConnectionMutation = /** @class */ (function (_super) {\r\n    __extends(SubSelfConnectionMutation, _super);\r\n    function SubSelfConnectionMutation() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    SubSelfConnectionMutation.prototype.mutate = function (network) {\r\n        var possible = network.connections.filter(function (conn) { return conn.from === conn.to; });\r\n        if (possible.length > 0) {\r\n            var randomConnection = Utils_1.pickRandom(possible);\r\n            network.disconnect(randomConnection.from, randomConnection.to);\r\n        }\r\n    };\r\n    return SubSelfConnectionMutation;\r\n}(Mutation));\r\nexports.SubSelfConnectionMutation = SubSelfConnectionMutation;\r\n/**\r\n * Add gate mutation.\r\n *\r\n * Adds a gate to the network.\r\n *\r\n * @example\r\n * let myNetwork = new Network(5, 5);\r\n *\r\n * myNetwork.mutate(new AddGateMutation());\r\n */\r\nvar AddGateMutation = /** @class */ (function (_super) {\r\n    __extends(AddGateMutation, _super);\r\n    function AddGateMutation() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    AddGateMutation.prototype.mutate = function (network, options) {\r\n        // check if max gates isn't reached already\r\n        if (options !== undefined && options.maxGates !== undefined && network.gates.length >= options.maxGates) {\r\n            return;\r\n        }\r\n        // use only connections that aren't already gated\r\n        var possible = network.connections.filter(function (conn) { return conn.gateNode === null; });\r\n        if (possible.length > 0) {\r\n            var node = Utils_1.pickRandom(network.nodes.filter(function (node) { return !node.isInputNode(); })); // hidden or output node\r\n            var connection = Utils_1.pickRandom(possible); // random connection from filtered array\r\n            network.addGate(node, connection); // use the node to gate the connection\r\n        }\r\n    };\r\n    return AddGateMutation;\r\n}(Mutation));\r\nexports.AddGateMutation = AddGateMutation;\r\n/**\r\n * Sub gate mutation.\r\n *\r\n * Removes a gate from the network.\r\n *\r\n * @example\r\n * let myNetwork = new Network(5, 5);\r\n *\r\n * myNetwork.mutate(new AddGateMutation()); // add a gate to the network\r\n * myNetwork.mutate(new SubGateMutation()); // remove the gate from the network\r\n */\r\nvar SubGateMutation = /** @class */ (function (_super) {\r\n    __extends(SubGateMutation, _super);\r\n    function SubGateMutation() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    SubGateMutation.prototype.mutate = function (network) {\r\n        if (network.gates.length > 0) {\r\n            network.removeGate(Utils_1.pickRandom(network.gates));\r\n        }\r\n    };\r\n    return SubGateMutation;\r\n}(Mutation));\r\nexports.SubGateMutation = SubGateMutation;\r\n/**\r\n * Add back connection mutation.\r\n *\r\n * Adds a backward pointing connection to the network.\r\n *\r\n * @example\r\n * let myNetwork = new Network(5, 5);\r\n *\r\n * myNetwork.mutate(new AddBackConnectionMutation);\r\n */\r\nvar AddBackConnectionMutation = /** @class */ (function (_super) {\r\n    __extends(AddBackConnectionMutation, _super);\r\n    function AddBackConnectionMutation() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    AddBackConnectionMutation.prototype.mutate = function (network) {\r\n        var possible = [];\r\n        for (var i = network.inputSize; i < network.nodes.length; i++) {\r\n            var from = network.nodes[i];\r\n            for (var j = network.inputSize; j < i; j++) {\r\n                var to = network.nodes[j];\r\n                if (!from.isProjectingTo(to)) {\r\n                    possible.push([from, to]);\r\n                }\r\n            }\r\n        }\r\n        if (possible.length > 0) {\r\n            var pair = Utils_1.pickRandom(possible);\r\n            network.connect(pair[0], pair[1]);\r\n        }\r\n    };\r\n    return AddBackConnectionMutation;\r\n}(Mutation));\r\nexports.AddBackConnectionMutation = AddBackConnectionMutation;\r\n/**\r\n * Sub back connection mutation.\r\n *\r\n * Removes a backward pointing connection to the network.\r\n *\r\n * @example\r\n * let myNetwork = new Network(5, 5);\r\n *\r\n * myNetwork.mutate(new AddBackConnectionMutation); // add a back connection\r\n * myNetwork.mutate(new SubBackConnectionMutation); // remove the back connection\r\n */\r\nvar SubBackConnectionMutation = /** @class */ (function (_super) {\r\n    __extends(SubBackConnectionMutation, _super);\r\n    function SubBackConnectionMutation() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    SubBackConnectionMutation.prototype.mutate = function (network) {\r\n        var possible = network.connections\r\n            .filter(function (conn) { return conn.from.outgoing.length > 1; })\r\n            .filter(function (conn) { return conn.to.incoming.length > 1; })\r\n            .filter(function (conn) { return network.nodes.indexOf(conn.from) > network.nodes.indexOf(conn.to); });\r\n        if (possible.length > 0) {\r\n            var randomConnection = Utils_1.pickRandom(possible);\r\n            network.disconnect(randomConnection.from, randomConnection.to);\r\n        }\r\n    };\r\n    return SubBackConnectionMutation;\r\n}(Mutation));\r\nexports.SubBackConnectionMutation = SubBackConnectionMutation;\r\n/**\r\n * Swap nodes mutation.\r\n *\r\n * Swaps the values of two randomly picked nodes.\r\n *\r\n * @prop {boolean} mutateOutput=false Swap bias and activation function of network output neurons too. Disable this to keep output of a neural network normalized.\r\n * @example\r\n * let myNetwork = new Network(5, 5);\r\n *\r\n * myNetwork.mutate(new SwapNodesMutation());\r\n */\r\nvar SwapNodesMutation = /** @class */ (function (_super) {\r\n    __extends(SwapNodesMutation, _super);\r\n    function SwapNodesMutation(mutateOutput) {\r\n        if (mutateOutput === void 0) { mutateOutput = false; }\r\n        var _this = _super.call(this) || this;\r\n        _this.mutateOutput = mutateOutput;\r\n        return _this;\r\n    }\r\n    SwapNodesMutation.prototype.mutate = function (network) {\r\n        var possible = this.mutateOutput\r\n            ? network.nodes.filter(function (node) { return node !== undefined && !node.isInputNode(); }) // hidden or output nodes\r\n            : network.nodes.filter(function (node) { return node !== undefined && node.isHiddenNode(); }); // only hidden nodes\r\n        if (possible.length >= 2) {\r\n            // select two different nodes from the filtered array\r\n            var node1_1 = Utils_1.pickRandom(possible);\r\n            var node2 = Utils_1.pickRandom(possible.filter(function (node) { return node !== node1_1; }));\r\n            // change there parameters\r\n            var biasTemp = node1_1.bias;\r\n            var squashTemp = node1_1.squash;\r\n            node1_1.bias = node2.bias;\r\n            node1_1.squash = node2.squash;\r\n            node2.bias = biasTemp;\r\n            node2.squash = squashTemp;\r\n        }\r\n    };\r\n    return SwapNodesMutation;\r\n}(Mutation));\r\nexports.SwapNodesMutation = SwapNodesMutation;\r\n/**\r\n * Array of all mutation methods\r\n *\r\n * @example <caption>A group of mutation methods for evolution</caption>\r\n * let myNetwork = new Network(5, 5);\r\n *\r\n * network.evolve(trainingset, {\r\n *  mutation: methods.mutation.ALL // all mutation methods\r\n * }\r\n */\r\nvar ALL_MUTATIONS = [\r\n    new AddNodeMutation(),\r\n    new SubNodeMutation(),\r\n    new AddConnectionMutation(),\r\n    new SubConnectionMutation(),\r\n    new ModWeightMutation(),\r\n    new ModBiasMutation(),\r\n    new ModActivationMutation(),\r\n    new AddGateMutation(),\r\n    new SubGateMutation(),\r\n    new AddSelfConnectionMutation(),\r\n    new SubSelfConnectionMutation(),\r\n    new AddBackConnectionMutation(),\r\n    new SubBackConnectionMutation(),\r\n    new SwapNodesMutation(),\r\n];\r\nexports.ALL_MUTATIONS = ALL_MUTATIONS;\r\n/**\r\n * Array of all feedforwad mutation methods\r\n *\r\n * @example <caption>A group of mutation methods for evolution</caption>\r\n * let myNetwork = new Network(5, 5);\r\n *\r\n * network.evolve(trainingset, {\r\n *  mutation: methods.mutation.FEEDFORWARD_MUTATIONS // all feedforward mutation methods\r\n * }\r\n */\r\nvar FEEDFORWARD_MUTATIONS = [\r\n    new AddNodeMutation(),\r\n    new SubNodeMutation(),\r\n    new AddConnectionMutation(),\r\n    new SubConnectionMutation(),\r\n    new ModWeightMutation(),\r\n    new ModBiasMutation(),\r\n    new ModActivationMutation(),\r\n    new SwapNodesMutation(),\r\n];\r\nexports.FEEDFORWARD_MUTATIONS = FEEDFORWARD_MUTATIONS;\r\nvar NO_STRUCTURE_MUTATIONS = [\r\n    new ModWeightMutation(),\r\n    new ModBiasMutation(),\r\n    new ModActivationMutation(),\r\n];\r\nexports.NO_STRUCTURE_MUTATIONS = NO_STRUCTURE_MUTATIONS;\r\nvar ONLY_STRUCTURE = [\r\n    new AddNodeMutation(),\r\n    new SubNodeMutation(),\r\n    new AddConnectionMutation(),\r\n    new SubConnectionMutation(),\r\n    new AddGateMutation(),\r\n    new SubGateMutation(),\r\n    new AddSelfConnectionMutation(),\r\n    new SubSelfConnectionMutation(),\r\n    new AddBackConnectionMutation(),\r\n    new SubBackConnectionMutation(),\r\n    new SwapNodesMutation(),\r\n];\r\nexports.ONLY_STRUCTURE = ONLY_STRUCTURE;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ActivationType;\r\n(function (ActivationType) {\r\n    ActivationType[ActivationType[\"NO_ACTIVATION\"] = 0] = \"NO_ACTIVATION\";\r\n    ActivationType[ActivationType[\"LogisticActivation\"] = 1] = \"LogisticActivation\";\r\n    ActivationType[ActivationType[\"TanhActivation\"] = 2] = \"TanhActivation\";\r\n    ActivationType[ActivationType[\"IdentityActivation\"] = 3] = \"IdentityActivation\";\r\n    ActivationType[ActivationType[\"StepActivation\"] = 4] = \"StepActivation\";\r\n    ActivationType[ActivationType[\"RELUActivation\"] = 5] = \"RELUActivation\";\r\n    ActivationType[ActivationType[\"SoftSignActivation\"] = 6] = \"SoftSignActivation\";\r\n    ActivationType[ActivationType[\"SinusoidActivation\"] = 7] = \"SinusoidActivation\";\r\n    ActivationType[ActivationType[\"GaussianActivation\"] = 8] = \"GaussianActivation\";\r\n    ActivationType[ActivationType[\"BentIdentityActivation\"] = 9] = \"BentIdentityActivation\";\r\n    ActivationType[ActivationType[\"BipolarActivation\"] = 10] = \"BipolarActivation\";\r\n    ActivationType[ActivationType[\"BipolarSigmoidActivation\"] = 11] = \"BipolarSigmoidActivation\";\r\n    ActivationType[ActivationType[\"HardTanhActivation\"] = 12] = \"HardTanhActivation\";\r\n    ActivationType[ActivationType[\"AbsoluteActivation\"] = 13] = \"AbsoluteActivation\";\r\n    ActivationType[ActivationType[\"InverseActivation\"] = 14] = \"InverseActivation\";\r\n    ActivationType[ActivationType[\"SELUActivation\"] = 15] = \"SELUActivation\";\r\n})(ActivationType = exports.ActivationType || (exports.ActivationType = {}));\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * Activation functions\r\n *\r\n * Activation functions determine what activation value neurons should get. Depending on your network's environment, choosing a suitable activation function can have a positive impact on the learning ability of the network.\r\n *\r\n * @see [Activation Function on Wikipedia](https://en.wikipedia.org/wiki/Activation_function)\r\n * @see [Beginners Guide to Activation Functions](https://towardsdatascience.com/secret-sauce-behind-the-beauty-of-deep-learning-beginners-guide-to-activation-functions-a8e23a57d046)\r\n * @see [Understanding activation functions in neural networks](https://medium.com/the-theory-of-everything/understanding-activation-functions-in-neural-networks-9491262884e0)\r\n * @see [List of activation functions in neural networks with pros/cons](https://stats.stackexchange.com/questions/115258/comprehensive-list-of-activation-functions-in-neural-networks-with-pros-cons)\r\n *\r\n *\r\n * @example\r\n * let { methods, Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Changing a neuron's activation function\r\n * let A = new Node();\r\n * A.squash = new LogisticActivation();\r\n */\r\nvar ActivationType_1 = require(\"../enums/ActivationType\");\r\nvar Activation = /** @class */ (function () {\r\n    function Activation() {\r\n        this.type = ActivationType_1.ActivationType.NO_ACTIVATION;\r\n    }\r\n    Activation.getActivation = function (activationType) {\r\n        switch (activationType) {\r\n            case ActivationType_1.ActivationType.LogisticActivation:\r\n                return new LogisticActivation();\r\n            case ActivationType_1.ActivationType.TanhActivation:\r\n                return new TanhActivation();\r\n            case ActivationType_1.ActivationType.IdentityActivation:\r\n                return new IdentityActivation();\r\n            case ActivationType_1.ActivationType.StepActivation:\r\n                return new StepActivation();\r\n            case ActivationType_1.ActivationType.RELUActivation:\r\n                return new RELUActivation();\r\n            case ActivationType_1.ActivationType.SoftSignActivation:\r\n                return new SoftSignActivation();\r\n            case ActivationType_1.ActivationType.SinusoidActivation:\r\n                return new LogisticActivation();\r\n            case ActivationType_1.ActivationType.GaussianActivation:\r\n                return new GaussianActivation();\r\n            case ActivationType_1.ActivationType.BentIdentityActivation:\r\n                return new BentIdentityActivation();\r\n            case ActivationType_1.ActivationType.BipolarActivation:\r\n                return new BipolarActivation();\r\n            case ActivationType_1.ActivationType.BipolarSigmoidActivation:\r\n                return new BipolarSigmoidActivation();\r\n            case ActivationType_1.ActivationType.HardTanhActivation:\r\n                return new HardTanhActivation();\r\n            case ActivationType_1.ActivationType.AbsoluteActivation:\r\n                return new AbsoluteActivation();\r\n            case ActivationType_1.ActivationType.InverseActivation:\r\n                return new InverseActivation();\r\n            case ActivationType_1.ActivationType.SELUActivation:\r\n                return new SELUActivation();\r\n        }\r\n        throw new ReferenceError(activationType + \" is not the name of any available activations! These are all available activations: \" + ALL_ACTIVATIONS);\r\n    };\r\n    return Activation;\r\n}());\r\nexports.Activation = Activation;\r\n/**\r\n * [Logistic function.](https://en.wikipedia.org/wiki/Logistic_function)\r\n *\r\n * @param x Input value(s) to activation function\r\n * @param derivative Flag to select derivative function\r\n *\r\n * @example\r\n * let { methods, Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Changing a neuron's activation function\r\n * let A = new Node();\r\n * A.squash = new LogisticActivation();\r\n */\r\nvar LogisticActivation = /** @class */ (function () {\r\n    function LogisticActivation() {\r\n        this.type = ActivationType_1.ActivationType.LogisticActivation;\r\n    }\r\n    LogisticActivation.prototype.calc = function (x, derivative) {\r\n        if (derivative === void 0) { derivative = false; }\r\n        if (!derivative) {\r\n            return 1 / (1 + Math.exp(-x));\r\n        }\r\n        else {\r\n            return this.calc(x, false) * (1 - this.calc(x, false));\r\n        }\r\n    };\r\n    return LogisticActivation;\r\n}());\r\nexports.LogisticActivation = LogisticActivation;\r\n/**\r\n * [TanH function.](https://en.wikipedia.org/wiki/Hyperbolic_function#Hyperbolic_tangent)\r\n *\r\n * @param x Input value to activation function\r\n * @param derivative Flag to select derivative function\r\n *\r\n * @example\r\n * let { methods, Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Changing a neuron's activation function\r\n * let A = new Node();\r\n * A.squash = new TanhActivation();\r\n */\r\nvar TanhActivation = /** @class */ (function () {\r\n    function TanhActivation() {\r\n        this.type = ActivationType_1.ActivationType.TanhActivation;\r\n    }\r\n    TanhActivation.prototype.calc = function (x, derivative) {\r\n        if (derivative === void 0) { derivative = false; }\r\n        if (!derivative) {\r\n            return Math.tanh(x);\r\n        }\r\n        else {\r\n            return 1 - this.calc(x, false) * this.calc(x, false);\r\n        }\r\n    };\r\n    return TanhActivation;\r\n}());\r\nexports.TanhActivation = TanhActivation;\r\n/**\r\n * [Identity function.](https://en.wikipedia.org/wiki/Identity_function)\r\n *\r\n * Returns input as output, used for [memory neurons](Layer#.Memory).\r\n *\r\n * @param x Input values to activation function\r\n * @param derivative Flag to select derivative function\r\n *\r\n * @example\r\n * let { methods, Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Changing a neuron's activation function\r\n * let A = new Node();\r\n * A.squash = new IdentityActivation();\r\n */\r\nvar IdentityActivation = /** @class */ (function () {\r\n    function IdentityActivation() {\r\n        this.type = ActivationType_1.ActivationType.IdentityActivation;\r\n    }\r\n    IdentityActivation.prototype.calc = function (x, derivative) {\r\n        if (derivative === void 0) { derivative = false; }\r\n        if (!derivative) {\r\n            return x;\r\n        }\r\n        else {\r\n            return 1;\r\n        }\r\n    };\r\n    return IdentityActivation;\r\n}());\r\nexports.IdentityActivation = IdentityActivation;\r\n/**\r\n * [Step function.](https://en.wikipedia.org/wiki/Heaviside_step_function)\r\n *\r\n * @param x Input values to activation function\r\n * @param derivative Flag to select derivative function\r\n *\r\n * @example\r\n * let { methods, Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Changing a neuron's activation function\r\n * let A = new Node();\r\n * A.squash = new StepActivation();\r\n */\r\nvar StepActivation = /** @class */ (function () {\r\n    function StepActivation() {\r\n        this.type = ActivationType_1.ActivationType.StepActivation;\r\n    }\r\n    StepActivation.prototype.calc = function (x, derivative) {\r\n        if (derivative === void 0) { derivative = false; }\r\n        if (!derivative) {\r\n            return x < 0 ? 0 : 1;\r\n        }\r\n        else {\r\n            return 0;\r\n        }\r\n    };\r\n    return StepActivation;\r\n}());\r\nexports.StepActivation = StepActivation;\r\n/**\r\n * [ReLU function.]{@link https://en.wikipedia.org/wiki/Rectifier_(neural_networks)}\r\n *\r\n * @param x Input values to activation function\r\n * @param derivative Flag to select derivative function\r\n *\r\n * @example\r\n * let { methods, Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Changing a neuron's activation function\r\n * let A = new Node();\r\n * A.squash = new RELUActivation();\r\n */\r\nvar RELUActivation = /** @class */ (function () {\r\n    function RELUActivation() {\r\n        this.type = ActivationType_1.ActivationType.RELUActivation;\r\n    }\r\n    RELUActivation.prototype.calc = function (x, derivative) {\r\n        if (derivative === void 0) { derivative = false; }\r\n        if (!derivative) {\r\n            return x <= 0 ? 0 : x;\r\n        }\r\n        else {\r\n            return x <= 0 ? 0 : 1;\r\n        }\r\n    };\r\n    return RELUActivation;\r\n}());\r\nexports.RELUActivation = RELUActivation;\r\n/**\r\n * [SoftSign function.](https://en.wikipedia.org/wiki/Activation_function#Comparison_of_activation_functions)\r\n *\r\n * @param x Input values to activation function\r\n * @param derivative Flag to select derivative function\r\n *\r\n * @example\r\n * let { methods, Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Changing a neuron's activation function\r\n * let A = new Node();\r\n * A.squash = new SoftSignActivation;\r\n */\r\nvar SoftSignActivation = /** @class */ (function () {\r\n    function SoftSignActivation() {\r\n        this.type = ActivationType_1.ActivationType.SoftSignActivation;\r\n    }\r\n    SoftSignActivation.prototype.calc = function (x, derivative) {\r\n        if (derivative === void 0) { derivative = false; }\r\n        if (!derivative) {\r\n            return x / (1 + Math.abs(x));\r\n        }\r\n        else {\r\n            return x / ((1 + Math.abs(x)) * (1 + Math.abs(x)));\r\n        }\r\n    };\r\n    return SoftSignActivation;\r\n}());\r\nexports.SoftSignActivation = SoftSignActivation;\r\n/**\r\n * [Sinusoid function.](https://en.wikipedia.org/wiki/Sine_wave)\r\n *\r\n * @param x Input values to activation function\r\n * @param derivative Flag to select derivative function\r\n *\r\n * @example\r\n * let { methods, Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Changing a neuron's activation function\r\n * let A = new Node();\r\n * A.squash = new SinusoidActivation();\r\n */\r\nvar SinusoidActivation = /** @class */ (function () {\r\n    function SinusoidActivation() {\r\n        this.type = ActivationType_1.ActivationType.SinusoidActivation;\r\n    }\r\n    SinusoidActivation.prototype.calc = function (x, derivative) {\r\n        if (derivative === void 0) { derivative = false; }\r\n        if (!derivative) {\r\n            return Math.sin(x);\r\n        }\r\n        else {\r\n            return Math.cos(x);\r\n        }\r\n    };\r\n    return SinusoidActivation;\r\n}());\r\nexports.SinusoidActivation = SinusoidActivation;\r\n/**\r\n * [Guassian function.](https://en.wikipedia.org/wiki/Gaussian_function)\r\n *\r\n * @param x Input values to activation function\r\n * @param derivative Flag to select derivative function\r\n *\r\n * @example\r\n * let { methods, Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Changing a neuron's activation function\r\n * let A = new Node();\r\n * A.squash = new GaussianActivation();\r\n */\r\nvar GaussianActivation = /** @class */ (function () {\r\n    function GaussianActivation() {\r\n        this.type = ActivationType_1.ActivationType.GaussianActivation;\r\n    }\r\n    GaussianActivation.prototype.calc = function (x, derivative) {\r\n        if (derivative === void 0) { derivative = false; }\r\n        if (!derivative) {\r\n            return Math.exp(-x * x);\r\n        }\r\n        else {\r\n            return -2 * x * this.calc(x, false);\r\n        }\r\n    };\r\n    return GaussianActivation;\r\n}());\r\nexports.GaussianActivation = GaussianActivation;\r\n/**\r\n * [Bent identity function.](https://en.wikipedia.org/wiki/Activation_function#Comparison_of_activation_functions)\r\n *\r\n * @param x Input values to activation function\r\n * @param derivative Flag to select derivative function\r\n *\r\n * @example\r\n * let { methods, Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Changing a neuron's activation function\r\n * let A = new Node();\r\n * A.squash = new BentIdentityActivation();\r\n */\r\nvar BentIdentityActivation = /** @class */ (function () {\r\n    function BentIdentityActivation() {\r\n        this.type = ActivationType_1.ActivationType.BentIdentityActivation;\r\n    }\r\n    BentIdentityActivation.prototype.calc = function (x, derivative) {\r\n        if (derivative === void 0) { derivative = false; }\r\n        if (!derivative) {\r\n            return (Math.sqrt(x * x + 1) - 1) / 2 + x;\r\n        }\r\n        else {\r\n            return x / (2 * Math.sqrt(x * x + 1)) + 1;\r\n        }\r\n    };\r\n    return BentIdentityActivation;\r\n}());\r\nexports.BentIdentityActivation = BentIdentityActivation;\r\n/**\r\n * [Bipolar function](https://wagenaartje.github.io/neataptic/docs/methods/activation/), if x > 0 then returns 1, otherwise returns -1\r\n *\r\n * @param x Input value to activation function\r\n * @param derivative Flag to select derivative function\r\n *\r\n * @example\r\n * let { methods, Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Changing a neuron's activation function\r\n * let A = new Node();\r\n * A.squash = new BipolarActivation();\r\n */\r\nvar BipolarActivation = /** @class */ (function () {\r\n    function BipolarActivation() {\r\n        this.type = ActivationType_1.ActivationType.BipolarActivation;\r\n    }\r\n    BipolarActivation.prototype.calc = function (x, derivative) {\r\n        if (derivative === void 0) { derivative = false; }\r\n        if (!derivative) {\r\n            return x > 0 ? 1 : -1;\r\n        }\r\n        else {\r\n            return 0;\r\n        }\r\n    };\r\n    return BipolarActivation;\r\n}());\r\nexports.BipolarActivation = BipolarActivation;\r\n/**\r\n * [Bipolar sigmoid function.](https://wagenaartje.github.io/neataptic/docs/methods/activation/)\r\n *\r\n * @param  x Input values to activation function\r\n * @param derivative Flag to select derivative function\r\n *\r\n * @example\r\n * let { methods, Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Changing a neuron's activation function\r\n * let A = new Node();\r\n * A.squash = new BipolarSigmoidActivation();\r\n */\r\nvar BipolarSigmoidActivation = /** @class */ (function () {\r\n    function BipolarSigmoidActivation() {\r\n        this.type = ActivationType_1.ActivationType.BipolarSigmoidActivation;\r\n    }\r\n    BipolarSigmoidActivation.prototype.calc = function (x, derivative) {\r\n        if (derivative === void 0) { derivative = false; }\r\n        if (!derivative) {\r\n            return 2 / (1 + Math.exp(-x)) - 1;\r\n        }\r\n        else {\r\n            return (2 * Math.exp(-x)) / ((1 + Math.exp(-x)) * (1 + Math.exp(-x)));\r\n        }\r\n    };\r\n    return BipolarSigmoidActivation;\r\n}());\r\nexports.BipolarSigmoidActivation = BipolarSigmoidActivation;\r\n/**\r\n * [Hard tanh function.](https://wagenaartje.github.io/neataptic/docs/methods/activation/)\r\n *\r\n * @param x Input values to activation function\r\n * @param derivative Flag to select derivative function\r\n *\r\n * @example\r\n * let { methods, Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Changing a neuron's activation function\r\n * let A = new Node();\r\n * A.squash = new HardTanhActivation();\r\n */\r\nvar HardTanhActivation = /** @class */ (function () {\r\n    function HardTanhActivation() {\r\n        this.type = ActivationType_1.ActivationType.HardTanhActivation;\r\n    }\r\n    HardTanhActivation.prototype.calc = function (x, derivative) {\r\n        if (derivative === void 0) { derivative = false; }\r\n        if (!derivative) {\r\n            return Math.max(-1, Math.min(1, x));\r\n        }\r\n        else {\r\n            return Math.abs(x) < 1 ? 1 : 0;\r\n        }\r\n    };\r\n    return HardTanhActivation;\r\n}());\r\nexports.HardTanhActivation = HardTanhActivation;\r\n/**\r\n * [Absolute function.](https://wagenaartje.github.io/neataptic/docs/methods/activation/)\r\n *\r\n * Avoid using this activation function on a node with a selfconnection\r\n *\r\n * @param x Input values to activation function\r\n * @param derivative Flag to select derivative function\r\n *\r\n * @example\r\n * let { methods, Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Changing a neuron's activation function\r\n * let A = new Node();\r\n * A.squash = new AbsoluteActivation();\r\n */\r\nvar AbsoluteActivation = /** @class */ (function () {\r\n    function AbsoluteActivation() {\r\n        this.type = ActivationType_1.ActivationType.AbsoluteActivation;\r\n    }\r\n    AbsoluteActivation.prototype.calc = function (x, derivative) {\r\n        if (derivative === void 0) { derivative = false; }\r\n        if (!derivative) {\r\n            return Math.abs(x);\r\n        }\r\n        else {\r\n            return x < 0 ? -1 : 1;\r\n        }\r\n    };\r\n    return AbsoluteActivation;\r\n}());\r\nexports.AbsoluteActivation = AbsoluteActivation;\r\n/**\r\n * [Inverse function.](https://wagenaartje.github.io/neataptic/docs/methods/activation/)\r\n *\r\n * @param x Input values to activation function\r\n * @param derivative Flag to select derivative function\r\n *\r\n * @example\r\n * let { methods, Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Changing a neuron's activation function\r\n * let A = new Node();\r\n * A.squash = new InverseActivation();\r\n */\r\nvar InverseActivation = /** @class */ (function () {\r\n    function InverseActivation() {\r\n        this.type = ActivationType_1.ActivationType.InverseActivation;\r\n    }\r\n    InverseActivation.prototype.calc = function (x, derivative) {\r\n        if (derivative === void 0) { derivative = false; }\r\n        if (!derivative) {\r\n            return 1 - x;\r\n        }\r\n        else {\r\n            return -1;\r\n        }\r\n    };\r\n    return InverseActivation;\r\n}());\r\nexports.InverseActivation = InverseActivation;\r\n/**\r\n * [Scaled exponential linear unit.](https://towardsdatascience.com/selu-make-fnns-great-again-snn-8d61526802a9)\r\n *\r\n * Exponential linear units try to make the mean activations closer to zero which speeds up learning. It has been shown that ELUs can obtain higher classification accuracy than ReLUs. α is a hyper-parameter here and to be tuned and the constraint is α ≥ 0(zero).\r\n *\r\n * @see {@link https://arxiv.org/pdf/1706.02515.pdf|Self-Normalizing Neural Networks}\r\n *\r\n * @param x Input value to activation function\r\n * @param derivative Flag to select derivative function\r\n *\r\n * @example\r\n * let { methods, Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Changing a neuron's activation function\r\n * let A = new Node();\r\n * A.squash = new SELUActivation();\r\n */\r\nvar SELUActivation = /** @class */ (function () {\r\n    function SELUActivation() {\r\n        this.type = ActivationType_1.ActivationType.SELUActivation;\r\n    }\r\n    SELUActivation.prototype.calc = function (x, derivative) {\r\n        if (derivative === void 0) { derivative = false; }\r\n        var alpha = 1.6732632423543772848170429916717; // this is bad\r\n        var scale = 1.0507009873554804934193349852946; // this is bad\r\n        if (!derivative) {\r\n            if (x > 0) {\r\n                return x * scale;\r\n            }\r\n            else {\r\n                return alpha * Math.exp(x) - alpha * scale;\r\n            }\r\n        }\r\n        else {\r\n            if (x > 0) {\r\n                return scale;\r\n            }\r\n            else {\r\n                return alpha * Math.exp(x) * scale;\r\n            }\r\n        }\r\n    };\r\n    return SELUActivation;\r\n}());\r\nexports.SELUActivation = SELUActivation;\r\nvar ALL_ACTIVATIONS = [\r\n    ActivationType_1.ActivationType.LogisticActivation,\r\n    ActivationType_1.ActivationType.TanhActivation,\r\n    ActivationType_1.ActivationType.IdentityActivation,\r\n    ActivationType_1.ActivationType.StepActivation,\r\n    ActivationType_1.ActivationType.RELUActivation,\r\n    ActivationType_1.ActivationType.SoftSignActivation,\r\n    ActivationType_1.ActivationType.SinusoidActivation,\r\n    ActivationType_1.ActivationType.GaussianActivation,\r\n    ActivationType_1.ActivationType.BentIdentityActivation,\r\n    ActivationType_1.ActivationType.BipolarActivation,\r\n    ActivationType_1.ActivationType.BipolarSigmoidActivation,\r\n    ActivationType_1.ActivationType.HardTanhActivation,\r\n    ActivationType_1.ActivationType.AbsoluteActivation,\r\n    ActivationType_1.ActivationType.InverseActivation,\r\n    ActivationType_1.ActivationType.SELUActivation\r\n];\r\nexports.ALL_ACTIVATIONS = ALL_ACTIVATIONS;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * A connection instance describes the connection between two nodes. If you're looking for connections between [Groups](Group) please see [Connection Methods](connection)\r\n *\r\n * @param from Connection origin node (neuron)\r\n * @param to Connection destination node (neuron)\r\n * @param weight=random Weight of the connection\r\n * @param gateNode Node which gates this connection\r\n *\r\n * @prop {Node} from Connection origin node (neuron)\r\n * @prop {Node} to Connection destination node (neuron)\r\n * @prop {number} weight=random Weight of the connection\r\n * @prop {number} gain=1 Used for gating, gets multiplied with weight\r\n * @prop {Node} gateNode=null The node gating this connection\r\n * @prop {number} eligibility=0\r\n * @prop {Node[]} xTraceNodes\r\n * @prop {number[]} xTraceValues\r\n * @prop {number[]} delta_weights\r\n * @prop {number} deltaWeightsPrevious=0 Tracks [momentum](https://www.willamette.edu/~gorr/classes/cs449/momrate.html)\r\n * @prop {number} deltaWeightsTotal=0 Tracks [momentum](https://www.willamette.edu/~gorr/classes/cs449/momrate.html) - _for [batch training](https://www.quora.com/What-is-the-difference-between-batch-online-and-mini-batch-training-in-neural-networks-Which-one-should-I-use-for-a-small-to-medium-sized-dataset-for-prediction-purposes)_\r\n *\r\n * @see {@link connection|Connection Methods}\r\n * @see {@link Node|Node}\r\n */\r\nvar Connection = /** @class */ (function () {\r\n    function Connection(from, to, weight, gateNode) {\r\n        this.from = from;\r\n        this.to = to;\r\n        this.weight = weight !== null && weight !== void 0 ? weight : 0;\r\n        this.gain = 1;\r\n        this.eligibility = 0;\r\n        this.deltaWeightsPrevious = 0;\r\n        this.deltaWeightsTotal = 0;\r\n        this.xTraceNodes = [];\r\n        this.xTraceValues = [];\r\n        if (gateNode) {\r\n            this.gateNode = gateNode;\r\n            gateNode.addGate(this);\r\n        }\r\n        else {\r\n            this.gateNode = null;\r\n        }\r\n    }\r\n    /**\r\n     * Returns an innovation ID\r\n     *\r\n     * @see {@link https://en.wikipedia.org/wiki/Pairing_function (Cantor pairing function)|Pairing function (Cantor pairing function)}\r\n     *\r\n     * @param a - A [natural number](https://en.wikipedia.org/wiki/Natural_number), which is an integer greater than or equal to zero\r\n     * @param b - A [natural number](https://en.wikipedia.org/wiki/Natural_number), which is an integer greater than or equal to zero\r\n     *\r\n     * @return An Integer that uniquely represents a pair of Integers\r\n     */\r\n    Connection.innovationID = function (a, b) {\r\n        return 1 / 2 * (a + b) * (a + b + 1) + b;\r\n    };\r\n    /**\r\n     * Returns the connection as a JSON\r\n     *\r\n     * @return Connection as a JSON\r\n     */\r\n    Connection.prototype.toJSON = function () {\r\n        return {\r\n            fromIndex: this.from.index,\r\n            toIndex: this.to.index,\r\n            gateNodeIndex: this.gateNode === null ? null : this.gateNode.index,\r\n            weight: this.weight\r\n        };\r\n    };\r\n    return Connection;\r\n}());\r\nexports.Connection = Connection;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Mutation_1 = require(\"../methods/Mutation\");\r\nvar Activation_1 = require(\"../methods/Activation\");\r\nvar Connection_1 = require(\"./Connection\");\r\nvar Utils_1 = require(\"../methods/Utils\");\r\nvar NodeType_1 = require(\"../enums/NodeType\");\r\nvar ActivationType_1 = require(\"../enums/ActivationType\");\r\n/**\r\n * Creates a new neuron/node\r\n *\r\n * Neurons are the basic unit of the neural network. They can be connected together, or used to gate connections between other neurons. A Neuron can perform basically 4 operations: form connections, gate connections, activate and [propagate](https://www.youtube.com/watch?v=Ilg3gGewQ5U).\r\n *\r\n * For more information check:\r\n * - [here](https://becominghuman.ai/what-is-an-artificial-neuron-8b2e421ce42e)\r\n * - [here](https://en.wikipedia.org/wiki/Artificial_neuron)\r\n * - [here](https://wagenaartje.github.io/neataptic/docs/architecture/node/)\r\n * - [here](https://github.com/cazala/synaptic/wiki/Neural-Networks-101)\r\n * - [here](https://keras.io/backend/#bias_add)\r\n *\r\n * @param type defines the type of node\r\n *\r\n * @prop {number} bias Neuron's bias [here](https://becominghuman.ai/what-is-an-artificial-neuron-8b2e421ce42e)\r\n * @prop {activation} squash [Activation function](https://medium.com/the-theory-of-everything/understanding-activation-functions-in-neural-networks-9491262884e0)\r\n * @prop {string} type\r\n * @prop {number} activation Output value\r\n * @prop {number} state\r\n * @prop {number} old\r\n * @prop {number} mask=1 Used for dropout. This is either 0 (ignored) or 1 (included) during training and is used to avoid [overfit](https://www.kdnuggets.com/2015/04/preventing-overfitting-neural-networks.html).\r\n * @prop {number} previousDeltaBias\r\n * @prop {number} totalDeltaBias\r\n * @prop {Array<Connection>} incoming Incoming connections to this node\r\n * @prop {Array<Connection>} outgoing Outgoing connections from this node\r\n * @prop {Array<Connection>} gated Connections this node gates\r\n * @prop {Connection} connections_self A self-connection\r\n * @prop {number} error.responsibility\r\n * @prop {number} error.projected\r\n * @prop {number} error.gated\r\n *\r\n * @example\r\n * let { Node } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * let node = new Node();\r\n */\r\nvar Node = /** @class */ (function () {\r\n    function Node(type) {\r\n        if (type === void 0) { type = NodeType_1.NodeType.HIDDEN; }\r\n        this.type = type;\r\n        this.bias = Utils_1.randDouble(-1, 1);\r\n        this.squash = new Activation_1.LogisticActivation();\r\n        this.activation = 0;\r\n        this.derivative = 1;\r\n        this.state = 0;\r\n        this.old = 0;\r\n        this.mask = 1;\r\n        this.deltaBiasPrevious = 0;\r\n        this.deltaBiasTotal = 0;\r\n        this.incoming = [];\r\n        this.outgoing = [];\r\n        this.gated = [];\r\n        this.selfConnection = new Connection_1.Connection(this, this, 0);\r\n        this.errorResponsibility = 0;\r\n        this.errorProjected = 0;\r\n        this.errorGated = 0;\r\n        this.index = NaN;\r\n    }\r\n    /**\r\n     * Convert a json object to a node\r\n     *\r\n     * @param json A node represented as a JSON object\r\n     *\r\n     * @returns itself\r\n     *\r\n     * @example <caption>From Node.toJSON()</caption>\r\n     * const { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let otherNode = new Node();\r\n     * let json = otherNode.toJSON();\r\n     * let node = Node.fromJSON(json);\r\n     *\r\n     * console.log(node);\r\n     */\r\n    Node.prototype.fromJSON = function (json) {\r\n        var _a, _b, _c, _d;\r\n        this.bias = (_a = json.bias) !== null && _a !== void 0 ? _a : Utils_1.randDouble(-1, 1);\r\n        this.type = json.type;\r\n        this.squash = Activation_1.Activation.getActivation((_b = json.squash) !== null && _b !== void 0 ? _b : ActivationType_1.ActivationType.LogisticActivation);\r\n        this.mask = (_c = json.mask) !== null && _c !== void 0 ? _c : 1;\r\n        this.index = (_d = json.index) !== null && _d !== void 0 ? _d : NaN;\r\n        return this;\r\n    };\r\n    /**\r\n     * Clears this node's state information - _i.e. resets node and its connections to \"factory settings\"_\r\n     *\r\n     * `node.clear()` is useful for predicting time series.\r\n     *\r\n     * @example\r\n     * const { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let node = new Node();\r\n     *\r\n     * node.activate([1, 0]);\r\n     * node.propagate([1]);\r\n     *\r\n     * console.log(node); // Node has state information (e.g. `node.derivative`)\r\n     *\r\n     * node.clear(); // Factory resets node\r\n     *\r\n     * console.log(node); // Node has no state information\r\n     */\r\n    Node.prototype.clear = function () {\r\n        for (var _i = 0, _a = this.incoming; _i < _a.length; _i++) {\r\n            var connection = _a[_i];\r\n            connection.eligibility = 0;\r\n            connection.xTraceNodes = [];\r\n            connection.xTraceValues = [];\r\n        }\r\n        for (var _b = 0, _c = this.gated; _b < _c.length; _b++) {\r\n            var connection = _c[_b];\r\n            connection.gain = 0;\r\n        }\r\n        this.errorResponsibility = this.errorProjected = this.errorGated = 0;\r\n        this.old = this.state = this.activation = 0;\r\n    };\r\n    /**\r\n     * Mutates the node's bias\r\n     *\r\n     * @param method The method is needed for the min and max value of the node's bias otherwise a range of [-1,1] is chosen\r\n     *\r\n     * @example\r\n     * const { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let node = new Node();\r\n     *\r\n     * console.log(node);\r\n     *\r\n     * node.mutateBias(); // Changes node's bias\r\n     */\r\n    Node.prototype.mutateBias = function (method) {\r\n        if (method === void 0) { method = new Mutation_1.ModBiasMutation(); }\r\n        this.bias += Utils_1.randDouble(method.min, method.max); // add a random value in range [min,max)\r\n    };\r\n    /**\r\n     * Mutates the node's activation function\r\n     *\r\n     * @example\r\n     * const { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let node = new Node();\r\n     *\r\n     * console.log(node);\r\n     *\r\n     * node.mutateBias(); // Changes node's activation function\r\n     */\r\n    Node.prototype.mutateActivation = function (allowedActivations) {\r\n        var _this = this;\r\n        if (allowedActivations === void 0) { allowedActivations = Activation_1.ALL_ACTIVATIONS; }\r\n        // pick a random activation from allowed activations except the current activation\r\n        var possible = allowedActivations.filter(function (activation) { return activation !== _this.squash.type; });\r\n        if (possible.length > 0) {\r\n            var newActivationType = Utils_1.pickRandom(possible);\r\n            this.squash = Activation_1.Activation.getActivation(newActivationType);\r\n        }\r\n    };\r\n    /**\r\n     * Checks if the given node(s) are have outgoing connections to this node\r\n     *\r\n     * @param node Checks if `node(s)` have outgoing connections into this node\r\n     *\r\n     * @return Returns true, if every node(s) has an outgoing connection into this node\r\n     *\r\n     * @example <caption>Check one <code>node</code></caption>\r\n     * const { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let otherNode = new Node();\r\n     * let node = new Node();\r\n     * otherNode.connect(node);\r\n     *\r\n     * console.log(node.isProjectedBy(otherNode)); // true\r\n     *\r\n     * @example <caption>Check many <code>nodes</code></caption>\r\n     * const { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let otherNodes = Array.from({ length: 5 }, () => new Node());\r\n     * let node = new Node();\r\n     *\r\n     * otherNodes.forEach(otherNode => otherNode.connect(node));\r\n     *\r\n     * console.log(node.isProjectedBy(otherNodes)); // true\r\n     */\r\n    Node.prototype.isProjectedBy = function (node) {\r\n        if (node === this) { // self connection\r\n            return this.selfConnection.weight !== 0; // is projected, if weight of self connection is unequal 0\r\n        }\r\n        else {\r\n            return this.incoming.map(function (conn) { return conn.from; }).includes(node); // check every incoming connection for node\r\n        }\r\n    };\r\n    /**\r\n     * Checks if this node has an outgoing connection(s) into the given node(s)\r\n     *\r\n     * @param node Checks if this node has outgoing connection(s) into `node(s)`\r\n     *\r\n     * @returns Returns true, if this node has an outgoing connection into every node(s)\r\n     *\r\n     * @example <caption>Check one <code>node</code></caption>\r\n     * const { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let otherNode = new Node();\r\n     * let node = new Node();\r\n     * node.connect(otherNode);\r\n     *\r\n     * console.log(node.isProjectingTo(otherNode)); // true\r\n     *\r\n     * @example <caption>Check many <code>nodes</code></caption>\r\n     * const { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let otherNodes = Array.from({ length: 5 }, () => new Node());\r\n     * let node = new Node();\r\n     *\r\n     * otherNodes.forEach(otherNode => node.connect(otherNode));\r\n     *\r\n     * console.log(node.isProjectingTo(otherNodes)); // true\r\n     */\r\n    Node.prototype.isProjectingTo = function (node) {\r\n        if (node === this) { // self connection\r\n            return this.selfConnection.weight !== 0; // is projected, if weight of self connection is unequal 0\r\n        }\r\n        else {\r\n            return this.outgoing.map(function (conn) { return conn.to; }).includes(node); // check every outgoing connection for node\r\n        }\r\n    };\r\n    /**\r\n     * This node gates (influences) the given connection\r\n     *\r\n     * @param connection Connection to be gated (influenced) by a neuron\r\n     *\r\n     * @example <caption>Gate one <code>connection</code></caption>\r\n     * const { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let input = new Node();\r\n     * let output = new Node();\r\n     * let connection = input.connect(output);\r\n     *\r\n     * let node = new Node();\r\n     *\r\n     * console.log(connection.gateNode === node); // false\r\n     *\r\n     * node.gate(connection); // Node now gates (manipulates) `connection`\r\n     *\r\n     * console.log(connection.gateNode === node); // true\r\n     */\r\n    Node.prototype.addGate = function (connection) {\r\n        this.gated.push(connection);\r\n        connection.gateNode = this;\r\n    };\r\n    /**\r\n     * Stops this node from gating (manipulating) the given connection(s)\r\n     *\r\n     * @param  connection Connections to ungate - _i.e. remove this node from_\r\n     *\r\n     * @example <caption>Ungate one <code>connection</code></caption>\r\n     * const { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let input = new Node();\r\n     * let output = new Node();\r\n     * let connection = input.connect(output);\r\n     *\r\n     * let node = new Node();\r\n     *\r\n     * console.log(connection.gateNode === node); // false\r\n     *\r\n     * node.addGate(connection); // Node now gates (manipulates) `connection`\r\n     *\r\n     * console.log(connection.gateNode === node); // true\r\n     *\r\n     * node.removeGate(connection); // Node is removed from `connection`\r\n     *\r\n     * console.log(connection.gateNode === node); // false\r\n     */\r\n    Node.prototype.removeGate = function (connection) {\r\n        Utils_1.removeFromArray(this.gated, connection);\r\n        connection.gateNode = null;\r\n        connection.gain = 1;\r\n    };\r\n    /**\r\n     * Connects this node to the given node(s)\r\n     *\r\n     * @param target Node(s) to project connection(s) to\r\n     * @param weight Initial connection(s) [weight](https://en.wikipedia.org/wiki/Synaptic_weight)\r\n     * @param twoSided If `true` connect nodes to each other\r\n     *\r\n     * @example <caption>Connecting node (neuron) to another node (neuron)</caption>\r\n     * const { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let node = new Node();\r\n     * let otherNode = new Node();\r\n     *\r\n     * let connection = node.connect(otherNode); // Both nodes now share a connection\r\n     *\r\n     * console.log(connection); // Connection { from: [Object object], to: [Object object], ...}\r\n     *\r\n     *\r\n     * @example <caption>Connecting a node (neuron) to itself</caption>\r\n     * const { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let node = new Node();\r\n     *\r\n     * let connection = node.connect(node); // Node is connected to itself.\r\n     *\r\n     * console.log(connection); // Connection { from: [Object object], to: [Object object], ...}\r\n     */\r\n    Node.prototype.connect = function (target, weight, twoSided) {\r\n        if (weight === void 0) { weight = 1; }\r\n        if (twoSided === void 0) { twoSided = false; }\r\n        if (target === this) { // self connection\r\n            this.selfConnection.weight = weight;\r\n            return this.selfConnection;\r\n        }\r\n        else if (this.isProjectingTo(target)) {\r\n            throw new ReferenceError(); // already connected\r\n        }\r\n        else {\r\n            var connection = new Connection_1.Connection(this, target, weight); // create new connection\r\n            // add it to the arrays\r\n            this.outgoing.push(connection);\r\n            target.incoming.push(connection);\r\n            if (twoSided) {\r\n                target.connect(this); // connect in the other direction\r\n            }\r\n            return connection;\r\n        }\r\n    };\r\n    /**\r\n     * Disconnects this node from the given node(s)\r\n     *\r\n     * @param node Node(s) to remove connection(s) to\r\n     * @param twoSided=false If `true` disconnects nodes from each other (i.e. both sides)\r\n     *\r\n     * @example <caption>Disconnect from one <code>node</code></caption>\r\n     * const { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let node = new Node();\r\n     * let other = new Node();\r\n     *\r\n     * node.connect(other); // `node` now connected to `other`\r\n     *\r\n     * console.log(node.incoming.length); // 0\r\n     * console.log(node.outgoing.length); // 1\r\n     *\r\n     * node.disconnect(other); // `node` is now disconnected from `other`\r\n     *\r\n     * console.log(node.incoming.length); // 0\r\n     * console.log(node.outgoing.length); // 0\r\n     *\r\n     * @example <caption>Connect to one <code>node</code> - <em>two-sided</em></caption>\r\n     * const { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let node = new Node();\r\n     * let other = new Node();\r\n     *\r\n     * // `node` & `other` are now connected to each other\r\n     * node.connect(other, true);\r\n     *\r\n     * console.log(node.incoming.length); // 1\r\n     * console.log(node.outgoing.length); // 1\r\n     *\r\n     * // `node` & `other` are now disconnected from each other\r\n     * node.disconnect(other, true);\r\n     *\r\n     * console.log(node.incoming.length); // 0\r\n     * console.log(node.outgoing.length); // 0\r\n     */\r\n    Node.prototype.disconnect = function (node, twoSided) {\r\n        if (twoSided === void 0) { twoSided = false; }\r\n        if (node === this) { // self connection\r\n            this.selfConnection.weight = 0; // set weight to 0\r\n            return this.selfConnection;\r\n        }\r\n        var connections = this.outgoing.filter(function (conn) { return conn.to === node; });\r\n        if (connections.length === 0) {\r\n            throw new Error(\"No Connection found\");\r\n        }\r\n        var connection = connections[0];\r\n        // remove it from the arrays\r\n        Utils_1.removeFromArray(this.outgoing, connection);\r\n        Utils_1.removeFromArray(connection.to.incoming, connection);\r\n        if (connection.gateNode !== undefined && connection.gateNode != null) {\r\n            connection.gateNode.removeGate(connection); // if connection is gated -> remove gate\r\n        }\r\n        if (twoSided) {\r\n            node.disconnect(this); // disconnect the other direction\r\n        }\r\n        return connection;\r\n    };\r\n    /**\r\n     * Backpropagate the error (a.k.a. learn).\r\n     *\r\n     * After an activation, you can teach the node what should have been the correct output (a.k.a. train). This is done by backpropagating. [Momentum](https://www.willamette.edu/~gorr/classes/cs449/momrate.html) adds a fraction of the previous weight update to the current one. When the gradient keeps pointing in the same direction, this will increase the size of the steps taken towards the minimum.\r\n     *\r\n     * If you combine a high learning rate with a lot of momentum, you will rush past the minimum (of the error function) with huge steps. It is therefore often necessary to reduce the global learning rate µ when using a lot of momentum (m close to 1).\r\n     *\r\n     * @param target The target value (i.e. \"the value the network SHOULD have given\")\r\n     * @param options More options for propagation\r\n     * @param [options.rate=0.3] [Learning rate](https://towardsdatascience.com/understanding-learning-rates-and-how-it-improves-performance-in-deep-learning-d0d4059c1c10)\r\n     * @param [options.momentum=0] [Momentum](https://www.willamette.edu/~gorr/classes/cs449/momrate.html) adds a fraction of the previous weight update to the current one.\r\n     * @param [options.update=true] When set to false weights won't update, but when set to true after being false the last propagation will include the deltaweights of the first \"update:false\" propagations too.\r\n     *\r\n     * @example\r\n     * let { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let A = new Node();\r\n     * let B = new Node('output');\r\n     * A.connect(B);\r\n     *\r\n     * let learningRate = .3;\r\n     * let momentum = 0;\r\n     *\r\n     * for(let i = 0; i < 20000; i++)\r\n     * {\r\n     *   // when A activates 1\r\n     *   A.activate(1);\r\n     *\r\n     *   // train B to activate 0\r\n     *   B.activate();\r\n     *   B.propagate(learningRate, momentum, true, 0);\r\n     * }\r\n     *\r\n     * // test it\r\n     * A.activate(1);\r\n     * B.activate(); // 0.006540565760853365\r\n     *\r\n     * @see [Regularization Neataptic](https://wagenaartje.github.io/neataptic/docs/methods/regularization/)\r\n     * @see [What is backpropagation | YouTube](https://www.youtube.com/watch?v=Ilg3gGewQ5U)\r\n     */\r\n    Node.prototype.propagate = function (target, options) {\r\n        if (options === void 0) { options = {}; }\r\n        options.momentum = Utils_1.getOrDefault(options.momentum, 0);\r\n        options.rate = Utils_1.getOrDefault(options.rate, 0.3);\r\n        options.update = Utils_1.getOrDefault(options.update, true);\r\n        if (target !== undefined && Number.isFinite(target)) {\r\n            this.errorResponsibility = this.errorProjected = target - this.activation;\r\n        }\r\n        else {\r\n            this.errorProjected = 0;\r\n            for (var _i = 0, _a = this.outgoing; _i < _a.length; _i++) {\r\n                var connection = _a[_i];\r\n                this.errorProjected += connection.to.errorResponsibility * connection.weight * connection.gain;\r\n            }\r\n            this.errorProjected *= this.derivative;\r\n            this.errorGated = 0;\r\n            for (var _b = 0, _c = this.gated; _b < _c.length; _b++) { // for all connections gated by this node\r\n                var connection = _c[_b];\r\n                var influence = void 0;\r\n                if (connection.to.selfConnection.gateNode === this) { // self connection is gated with this node\r\n                    influence = connection.to.old + connection.weight * connection.from.activation;\r\n                }\r\n                else {\r\n                    influence = connection.weight * connection.from.activation;\r\n                }\r\n                this.errorGated += connection.to.errorResponsibility * influence;\r\n            }\r\n            this.errorGated *= this.derivative;\r\n            this.errorResponsibility = this.errorProjected + this.errorGated;\r\n        }\r\n        for (var _d = 0, _e = this.incoming; _d < _e.length; _d++) {\r\n            var connection = _e[_d];\r\n            // calculate gradient\r\n            var gradient = this.errorProjected * connection.eligibility;\r\n            for (var j = 0; j < connection.xTraceNodes.length; j++) {\r\n                var node = connection.xTraceNodes[j];\r\n                gradient += node.errorResponsibility * connection.xTraceValues[j];\r\n            }\r\n            connection.deltaWeightsTotal += options.rate * gradient * this.mask;\r\n            if (options.update) {\r\n                connection.deltaWeightsTotal += options.momentum * connection.deltaWeightsPrevious;\r\n                connection.weight += connection.deltaWeightsTotal;\r\n                connection.deltaWeightsPrevious = connection.deltaWeightsTotal;\r\n                connection.deltaWeightsTotal = 0;\r\n            }\r\n        }\r\n        this.deltaBiasTotal += options.rate * this.errorResponsibility;\r\n        if (options.update) {\r\n            this.deltaBiasTotal += options.momentum * this.deltaBiasPrevious;\r\n            this.bias += this.deltaBiasTotal;\r\n            this.deltaBiasPrevious = this.deltaBiasTotal;\r\n            this.deltaBiasTotal = 0;\r\n        }\r\n    };\r\n    /**\r\n     * Actives the node.\r\n     *\r\n     * When a neuron activates, it computes its state from all its input connections and 'squashes' it using its activation function, and returns the output (activation).\r\n     *\r\n     * You can also provide the activation (a float between 0 and 1) as a parameter, which is useful for neurons in the input layer.\r\n     *\r\n     * @param [input] Environment signal (i.e. optional numerical value passed to the network as input)  - _should only be passed in input neurons_\r\n     * @param [trace] Controls whether traces are created when activation happens (a trace is meta information left behind for different uses, e.g. backpropagation).\r\n     *\r\n     * @returns A neuron's ['Squashed'](https://medium.com/the-theory-of-everything/understanding-activation-functions-in-neural-networks-9491262884e0) output value\r\n     *\r\n     * @example\r\n     * let { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let A = new Node();\r\n     * let B = new Node();\r\n     *\r\n     * A.connect(B);\r\n     * A.activate(0.5); // 0.5\r\n     * B.activate(); // 0.3244554645\r\n     */\r\n    Node.prototype.activate = function (input, trace) {\r\n        var _this = this;\r\n        if (trace === void 0) { trace = true; }\r\n        if (input !== undefined) {\r\n            return this.activation = input;\r\n        }\r\n        else if (this.isInputNode()) {\r\n            throw new ReferenceError(\"There is no input given to an input node!\");\r\n        }\r\n        if (trace) {\r\n            this.old = this.state;\r\n            this.state = this.selfConnection.gain * this.selfConnection.weight * this.state + this.bias;\r\n            this.incoming.forEach(function (conn) {\r\n                _this.state += conn.from.activation * conn.weight * conn.gain;\r\n            });\r\n            this.activation = this.squash.calc(this.state, false) * this.mask;\r\n            this.derivative = this.squash.calc(this.state, true);\r\n            // store traces\r\n            var nodes_1 = [];\r\n            var influences_1 = [];\r\n            // Adjust 'gain' (to gated connections) & Build traces\r\n            this.gated.forEach(function (connection) {\r\n                connection.gain = _this.activation;\r\n                // Build traces\r\n                var index = nodes_1.indexOf(connection.to);\r\n                if (index > -1) { // Node & influence exist\r\n                    influences_1[index] += connection.weight * connection.from.activation;\r\n                }\r\n                else { // Add node & corresponding influence\r\n                    nodes_1.push(connection.to);\r\n                    if (connection.to.selfConnection.gateNode === _this) {\r\n                        influences_1.push(connection.weight * connection.from.activation + connection.to.old);\r\n                    }\r\n                    else {\r\n                        influences_1.push(connection.weight * connection.from.activation);\r\n                    }\r\n                }\r\n            });\r\n            // Forwarding 'xTrace' (to incoming connections)\r\n            for (var _i = 0, _a = this.incoming; _i < _a.length; _i++) {\r\n                var connection = _a[_i];\r\n                connection.eligibility = this.selfConnection.gain * this.selfConnection.weight * connection.eligibility + connection.from.activation * connection.gain;\r\n                for (var i = 0; i < nodes_1.length; i++) {\r\n                    var node = nodes_1[i];\r\n                    var influence = influences_1[i];\r\n                    var index = connection.xTraceNodes.indexOf(node);\r\n                    if (index > -1) {\r\n                        connection.xTraceValues[index] = node.selfConnection.gain * node.selfConnection.weight * connection.xTraceValues[index] + this.derivative * connection.eligibility * influence;\r\n                    }\r\n                    else {\r\n                        connection.xTraceNodes.push(node);\r\n                        connection.xTraceValues.push(this.derivative * connection.eligibility * influence);\r\n                    }\r\n                }\r\n            }\r\n            return this.activation;\r\n        }\r\n        else {\r\n            if (this.isInputNode())\r\n                return this.activation = 0;\r\n            this.state = this.selfConnection.gain * this.selfConnection.weight * this.state + this.bias;\r\n            for (var _b = 0, _c = this.incoming; _b < _c.length; _b++) {\r\n                var connection = _c[_b];\r\n                this.state += connection.from.activation * connection.weight * connection.gain;\r\n            }\r\n            this.activation = this.squash.calc(this.state, false);\r\n            // Adjust gain\r\n            for (var _d = 0, _e = this.gated; _d < _e.length; _d++) {\r\n                var connection = _e[_d];\r\n                connection.gain = this.activation;\r\n            }\r\n            return this.activation;\r\n        }\r\n    };\r\n    /**\r\n     * Converts the node to a json object that can later be converted back\r\n     *\r\n     * @returns A node representing json object\r\n     *\r\n     * @example\r\n     * const { Node } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let node = new Node();\r\n     *\r\n     * console.log(node.toJSON());\r\n     */\r\n    Node.prototype.toJSON = function () {\r\n        return {\r\n            bias: this.bias,\r\n            type: this.type,\r\n            squash: this.squash.type,\r\n            mask: this.mask,\r\n            index: this.index\r\n        };\r\n    };\r\n    Node.prototype.isInputNode = function () {\r\n        return this.type === NodeType_1.NodeType.INPUT;\r\n    };\r\n    Node.prototype.isHiddenNode = function () {\r\n        return this.type === NodeType_1.NodeType.HIDDEN;\r\n    };\r\n    Node.prototype.isOutputNode = function () {\r\n        return this.type === NodeType_1.NodeType.OUTPUT;\r\n    };\r\n    Node.prototype.setBias = function (bias) {\r\n        this.bias = bias;\r\n        return this;\r\n    };\r\n    Node.prototype.setSquash = function (activationType) {\r\n        this.squash = Activation_1.Activation.getActivation(activationType);\r\n        return this;\r\n    };\r\n    return Node;\r\n}());\r\nexports.Node = Node;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Layer_1 = require(\"../Layer\");\r\nvar Node_1 = require(\"../../Node\");\r\nvar ActivationType_1 = require(\"../../../enums/ActivationType\");\r\nvar NodeType_1 = require(\"../../../enums/NodeType\");\r\nvar DenseLayer = /** @class */ (function (_super) {\r\n    __extends(DenseLayer, _super);\r\n    function DenseLayer(outputSize, options) {\r\n        var _a;\r\n        if (options === void 0) { options = {}; }\r\n        var _b;\r\n        var _this = _super.call(this, outputSize) || this;\r\n        var activation = (_b = options.activationType) !== null && _b !== void 0 ? _b : ActivationType_1.ActivationType.LogisticActivation;\r\n        for (var i = 0; i < outputSize; i++) {\r\n            _this.inputNodes.add(new Node_1.Node(NodeType_1.NodeType.HIDDEN).setSquash(activation));\r\n        }\r\n        _this.outputNodes = _this.inputNodes;\r\n        (_a = _this.nodes).push.apply(_a, Array.from(_this.inputNodes));\r\n        return _this;\r\n    }\r\n    return DenseLayer;\r\n}(Layer_1.Layer));\r\nexports.DenseLayer = DenseLayer;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Node_1 = require(\"../Node\");\r\nvar NodeType_1 = require(\"../../enums/NodeType\");\r\nvar Activation_1 = require(\"../../methods/Activation\");\r\nvar ActivationType_1 = require(\"../../enums/ActivationType\");\r\nvar ConstantNode = /** @class */ (function (_super) {\r\n    __extends(ConstantNode, _super);\r\n    function ConstantNode() {\r\n        var _this = _super.call(this, NodeType_1.NodeType.HIDDEN) || this;\r\n        _this.bias = 1;\r\n        return _this;\r\n    }\r\n    ConstantNode.prototype.fromJSON = function (json) {\r\n        var _a, _b;\r\n        this.index = (_a = json.index) !== null && _a !== void 0 ? _a : -1;\r\n        this.squash = Activation_1.Activation.getActivation((_b = json.squash) !== null && _b !== void 0 ? _b : ActivationType_1.ActivationType.IdentityActivation);\r\n        return this;\r\n    };\r\n    ConstantNode.prototype.toJSON = function () {\r\n        return { index: this.index, squash: this.squash.type };\r\n    };\r\n    ConstantNode.prototype.mutateBias = function () {\r\n        throw new ReferenceError(\"Cannot mutate a pool node!\");\r\n    };\r\n    ConstantNode.prototype.mutateActivation = function () {\r\n        throw new ReferenceError(\"Cannot mutate a pool node!\");\r\n    };\r\n    ConstantNode.prototype.addGate = function () {\r\n        throw new ReferenceError(\"A pool node can't gate a connection!\");\r\n    };\r\n    ConstantNode.prototype.removeGate = function () {\r\n        throw new ReferenceError(\"A pool node can't gate a connection!\");\r\n    };\r\n    ConstantNode.prototype.setBias = function () {\r\n        throw new ReferenceError(\"Cannot set the bias of a pool node!\");\r\n    };\r\n    return ConstantNode;\r\n}(Node_1.Node));\r\nexports.ConstantNode = ConstantNode;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ConstantNode_1 = require(\"./ConstantNode\");\r\nvar Utils_1 = require(\"../../methods/Utils\");\r\nvar DropoutNode = /** @class */ (function (_super) {\r\n    __extends(DropoutNode, _super);\r\n    function DropoutNode(probability) {\r\n        var _this = _super.call(this) || this;\r\n        _this.probability = probability;\r\n        _this.droppedOut = false;\r\n        return _this;\r\n    }\r\n    DropoutNode.prototype.activate = function () {\r\n        var _this = this;\r\n        if (this.incoming.length !== 1) {\r\n            throw new RangeError(\"Dropout node should have exactly one incoming connection!\");\r\n        }\r\n        var incomingConnection = this.incoming[0];\r\n        // https://stats.stackexchange.com/a/219240\r\n        if (Utils_1.randDouble(0, 1) < this.probability) {\r\n            // DROPOUT\r\n            this.droppedOut = true;\r\n            this.state = 0;\r\n        }\r\n        else {\r\n            this.droppedOut = false;\r\n            this.state = incomingConnection.from.activation * incomingConnection.weight * incomingConnection.gain;\r\n            this.state *= 1 / (1 - this.probability);\r\n        }\r\n        this.activation = this.squash.calc(this.state, false) * this.mask;\r\n        // Adjust gain\r\n        this.gated.forEach(function (conn) { return conn.gain = _this.activation; });\r\n        return this.activation;\r\n    };\r\n    DropoutNode.prototype.propagate = function (target, options) {\r\n        if (options === void 0) { options = {}; }\r\n        options.momentum = Utils_1.getOrDefault(options.momentum, 0);\r\n        options.rate = Utils_1.getOrDefault(options.rate, 0.3);\r\n        options.update = Utils_1.getOrDefault(options.update, true);\r\n        var connectionsStates = this.outgoing.map(function (conn) { return conn.to.errorResponsibility * conn.weight * conn.gain; });\r\n        this.errorResponsibility = this.errorProjected = Utils_1.sum(connectionsStates) / (1 - this.probability);\r\n        if (this.incoming.length !== 1) {\r\n            throw new RangeError(\"Dropout node should have exactly one incoming connection!\");\r\n        }\r\n        var incomingConnection = this.incoming[0];\r\n        // calculate gradient\r\n        if (!this.droppedOut) {\r\n            var gradient = this.errorProjected * incomingConnection.eligibility;\r\n            for (var i = 0; i < incomingConnection.xTraceNodes.length; i++) {\r\n                gradient += incomingConnection.xTraceNodes[i].errorResponsibility * incomingConnection.xTraceValues[i];\r\n            }\r\n            if (options.update) {\r\n                incomingConnection.deltaWeightsTotal += options.rate * gradient * this.mask + options.momentum * incomingConnection.deltaWeightsPrevious;\r\n                incomingConnection.weight += incomingConnection.deltaWeightsTotal;\r\n                incomingConnection.deltaWeightsPrevious = incomingConnection.deltaWeightsTotal;\r\n                incomingConnection.deltaWeightsTotal = 0;\r\n            }\r\n        }\r\n    };\r\n    DropoutNode.prototype.fromJSON = function (json) {\r\n        _super.prototype.fromJSON.call(this, json);\r\n        this.probability = json.probability;\r\n        return this;\r\n    };\r\n    DropoutNode.prototype.toJSON = function () {\r\n        return Object.assign(_super.prototype.toJSON.call(this), {\r\n            probability: this.probability\r\n        });\r\n    };\r\n    return DropoutNode;\r\n}(ConstantNode_1.ConstantNode));\r\nexports.DropoutNode = DropoutNode;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Layer_1 = require(\"../Layer\");\r\nvar ActivationType_1 = require(\"../../../enums/ActivationType\");\r\nvar DropoutNode_1 = require(\"../../Nodes/DropoutNode\");\r\nvar ConnectionType_1 = require(\"../../../enums/ConnectionType\");\r\nvar DropoutLayer = /** @class */ (function (_super) {\r\n    __extends(DropoutLayer, _super);\r\n    function DropoutLayer(outputSize, options) {\r\n        var _a;\r\n        if (options === void 0) { options = {}; }\r\n        var _b, _c;\r\n        var _this = _super.call(this, outputSize) || this;\r\n        var activation = (_b = options.activationType) !== null && _b !== void 0 ? _b : ActivationType_1.ActivationType.IdentityActivation;\r\n        var probability = (_c = options.probability) !== null && _c !== void 0 ? _c : 0.1;\r\n        for (var i = 0; i < outputSize; i++) {\r\n            _this.inputNodes.add(new DropoutNode_1.DropoutNode(probability).setSquash(activation));\r\n        }\r\n        _this.outputNodes = _this.inputNodes;\r\n        (_a = _this.nodes).push.apply(_a, Array.from(_this.inputNodes));\r\n        return _this;\r\n    }\r\n    DropoutLayer.prototype.getDefaultIncomingConnectionType = function () {\r\n        return ConnectionType_1.ConnectionType.ONE_TO_ONE;\r\n    };\r\n    DropoutLayer.prototype.connectionTypeisAllowed = function (type) {\r\n        return type === ConnectionType_1.ConnectionType.ONE_TO_ONE;\r\n    };\r\n    return DropoutLayer;\r\n}(Layer_1.Layer));\r\nexports.DropoutLayer = DropoutLayer;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Utils_1 = require(\"../../methods/Utils\");\r\nvar ConstantNode_1 = require(\"./ConstantNode\");\r\nvar NodeType_1 = require(\"../../enums/NodeType\");\r\nvar NoiseNode = /** @class */ (function (_super) {\r\n    __extends(NoiseNode, _super);\r\n    function NoiseNode(options) {\r\n        if (options === void 0) { options = {}; }\r\n        var _this = _super.call(this) || this;\r\n        _this.noiseType = Utils_1.getOrDefault(options.noiseType, NodeType_1.NoiseNodeType.GAUSSIAN_NOISE);\r\n        _this.options = options;\r\n        return _this;\r\n    }\r\n    NoiseNode.prototype.activate = function () {\r\n        var _a, _b, _c, _d;\r\n        this.old = this.state;\r\n        var incomingStates = this.incoming.map(function (conn) { return conn.from.activation * conn.weight * conn.gain; });\r\n        switch (this.noiseType) {\r\n        }\r\n        switch (this.noiseType) {\r\n            case NodeType_1.NoiseNodeType.GAUSSIAN_NOISE:\r\n                this.state = Utils_1.avg(incomingStates) + Utils_1.generateGaussian((_b = (_a = this.options.gaussian) === null || _a === void 0 ? void 0 : _a.mean) !== null && _b !== void 0 ? _b : 0, (_d = (_c = this.options.gaussian) === null || _c === void 0 ? void 0 : _c.deviation) !== null && _d !== void 0 ? _d : 2);\r\n                break;\r\n            default:\r\n                throw new ReferenceError(\"Cannot activate this noise type!\");\r\n        }\r\n        this.activation = this.squash.calc(this.state, false) * this.mask;\r\n        this.derivative = this.squash.calc(this.state, true);\r\n        return this.activation;\r\n    };\r\n    NoiseNode.prototype.propagate = function (target, options) {\r\n        if (options === void 0) { options = {}; }\r\n        options.momentum = Utils_1.getOrDefault(options.momentum, 0);\r\n        options.rate = Utils_1.getOrDefault(options.rate, 0.3);\r\n        options.update = Utils_1.getOrDefault(options.update, true);\r\n        var connectionsStates = this.outgoing.map(function (conn) { return conn.to.errorResponsibility * conn.weight * conn.gain; });\r\n        this.errorResponsibility = this.errorProjected = Utils_1.sum(connectionsStates) * this.derivative;\r\n        for (var _i = 0, _a = this.incoming; _i < _a.length; _i++) {\r\n            var connection = _a[_i];\r\n            // calculate gradient\r\n            var gradient = this.errorProjected * connection.eligibility;\r\n            for (var i = 0; i < connection.xTraceNodes.length; i++) {\r\n                gradient += connection.xTraceNodes[i].errorResponsibility * connection.xTraceValues[i];\r\n            }\r\n            connection.deltaWeightsTotal += options.rate * gradient * this.mask;\r\n            if (options.update) {\r\n                connection.deltaWeightsTotal += options.momentum * connection.deltaWeightsPrevious;\r\n                connection.weight += connection.deltaWeightsTotal;\r\n                connection.deltaWeightsPrevious = connection.deltaWeightsTotal;\r\n                connection.deltaWeightsTotal = 0;\r\n            }\r\n        }\r\n    };\r\n    return NoiseNode;\r\n}(ConstantNode_1.ConstantNode));\r\nexports.NoiseNode = NoiseNode;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Layer_1 = require(\"../Layer\");\r\nvar ActivationType_1 = require(\"../../../enums/ActivationType\");\r\nvar ConnectionType_1 = require(\"../../../enums/ConnectionType\");\r\nvar NoiseNode_1 = require(\"../../Nodes/NoiseNode\");\r\nvar NodeType_1 = require(\"../../../enums/NodeType\");\r\nvar NoiseLayer = /** @class */ (function (_super) {\r\n    __extends(NoiseLayer, _super);\r\n    function NoiseLayer(outputSize, options) {\r\n        var _a;\r\n        if (options === void 0) { options = {}; }\r\n        var _b;\r\n        var _this = _super.call(this, outputSize) || this;\r\n        var activation = (_b = options.activationType) !== null && _b !== void 0 ? _b : ActivationType_1.ActivationType.IdentityActivation;\r\n        for (var i = 0; i < outputSize; i++) {\r\n            _this.inputNodes.add(new NoiseNode_1.NoiseNode({\r\n                noiseType: NodeType_1.NoiseNodeType.GAUSSIAN_NOISE,\r\n                gaussian: options\r\n            }).setSquash(activation));\r\n        }\r\n        _this.outputNodes = _this.inputNodes;\r\n        (_a = _this.nodes).push.apply(_a, Array.from(_this.inputNodes));\r\n        return _this;\r\n    }\r\n    NoiseLayer.prototype.getDefaultIncomingConnectionType = function () {\r\n        return ConnectionType_1.ConnectionType.ONE_TO_ONE;\r\n    };\r\n    NoiseLayer.prototype.connectionTypeisAllowed = function (type) {\r\n        return type === ConnectionType_1.ConnectionType.ONE_TO_ONE;\r\n    };\r\n    return NoiseLayer;\r\n}(Layer_1.Layer));\r\nexports.NoiseLayer = NoiseLayer;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Layer_1 = require(\"../Layer\");\r\nvar Node_1 = require(\"../../Node\");\r\nvar NodeType_1 = require(\"../../../enums/NodeType\");\r\nvar ActivationType_1 = require(\"../../../enums/ActivationType\");\r\nvar OutputLayer = /** @class */ (function (_super) {\r\n    __extends(OutputLayer, _super);\r\n    function OutputLayer(outputSize, options) {\r\n        var _a;\r\n        if (options === void 0) { options = {}; }\r\n        var _b;\r\n        var _this = _super.call(this, outputSize) || this;\r\n        var activation = (_b = options.activationType) !== null && _b !== void 0 ? _b : ActivationType_1.ActivationType.IdentityActivation;\r\n        for (var i = 0; i < outputSize; i++) {\r\n            _this.inputNodes.add(new Node_1.Node(NodeType_1.NodeType.OUTPUT).setSquash(activation));\r\n        }\r\n        (_a = _this.nodes).push.apply(_a, Array.from(_this.inputNodes));\r\n        return _this;\r\n    }\r\n    OutputLayer.prototype.connect = function () {\r\n        throw new ReferenceError(\"Could not connect an OutputLayer!\");\r\n    };\r\n    return OutputLayer;\r\n}(Layer_1.Layer));\r\nexports.OutputLayer = OutputLayer;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Layer_1 = require(\"../Layer\");\r\nvar Node_1 = require(\"../../Node\");\r\nvar NodeType_1 = require(\"../../../enums/NodeType\");\r\nvar ConnectionType_1 = require(\"../../../enums/ConnectionType\");\r\nvar NoiseLayer_1 = require(\"../NoiseLayers/NoiseLayer\");\r\nvar InputLayer = /** @class */ (function (_super) {\r\n    __extends(InputLayer, _super);\r\n    function InputLayer(outputSize, options) {\r\n        var _a;\r\n        if (options === void 0) { options = {}; }\r\n        var _b;\r\n        var _this = _super.call(this, outputSize) || this;\r\n        for (var i = 0; i < outputSize; i++) {\r\n            var node = new Node_1.Node(NodeType_1.NodeType.INPUT);\r\n            _this.nodes.push(node);\r\n        }\r\n        if (options.noise) {\r\n            var noiseLayer = new NoiseLayer_1.NoiseLayer((_b = options.noise) !== null && _b !== void 0 ? _b : NodeType_1.NoiseNodeType.GAUSSIAN_NOISE);\r\n            noiseLayer.outputNodes.forEach(function (node) { return _this.outputNodes.add(node); });\r\n            (_a = _this.connections).push.apply(_a, Layer_1.Layer.connect(_this.nodes, noiseLayer, noiseLayer.getDefaultIncomingConnectionType()));\r\n        }\r\n        else {\r\n            _this.nodes.forEach(function (node) { return _this.outputNodes.add(node); });\r\n        }\r\n        return _this;\r\n    }\r\n    InputLayer.prototype.getDefaultIncomingConnectionType = function () {\r\n        return ConnectionType_1.ConnectionType.NO_CONNECTION;\r\n    };\r\n    InputLayer.prototype.connectionTypeisAllowed = function (type) {\r\n        return type === ConnectionType_1.ConnectionType.NO_CONNECTION;\r\n    };\r\n    return InputLayer;\r\n}(Layer_1.Layer));\r\nexports.InputLayer = InputLayer;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar NodeType_1 = require(\"../../enums/NodeType\");\r\nvar Utils_1 = require(\"../../methods/Utils\");\r\nvar ConstantNode_1 = require(\"./ConstantNode\");\r\nvar PoolNode = /** @class */ (function (_super) {\r\n    __extends(PoolNode, _super);\r\n    function PoolNode(poolingType) {\r\n        if (poolingType === void 0) { poolingType = NodeType_1.PoolNodeType.MAX_POOLING; }\r\n        var _this = _super.call(this) || this;\r\n        _this.poolingType = poolingType;\r\n        _this.receivingIndex = -1;\r\n        return _this;\r\n    }\r\n    PoolNode.prototype.fromJSON = function (json) {\r\n        _super.prototype.fromJSON.call(this, json);\r\n        this.poolingType = json.poolType;\r\n        return this;\r\n    };\r\n    PoolNode.prototype.activate = function () {\r\n        var _this = this;\r\n        var incomingStates = this.incoming.map(function (conn) { return conn.from.activation * conn.weight * conn.gain; });\r\n        if (this.poolingType === NodeType_1.PoolNodeType.MAX_POOLING) {\r\n            this.receivingIndex = Utils_1.maxValueIndex(incomingStates);\r\n            this.state = incomingStates[this.receivingIndex];\r\n        }\r\n        else if (this.poolingType === NodeType_1.PoolNodeType.AVG_POOLING) {\r\n            this.state = Utils_1.avg(incomingStates);\r\n        }\r\n        else if (this.poolingType === NodeType_1.PoolNodeType.MIN_POOLING) {\r\n            this.receivingIndex = Utils_1.minValueIndex(incomingStates);\r\n            this.state = incomingStates[this.receivingIndex];\r\n        }\r\n        else {\r\n            throw new ReferenceError(\"No valid pooling type! Type: \" + this.poolingType);\r\n        }\r\n        this.activation = this.squash.calc(this.state, false) * this.mask;\r\n        if (this.poolingType === NodeType_1.PoolNodeType.AVG_POOLING) {\r\n            this.derivative = this.squash.calc(this.state, true);\r\n        }\r\n        // Adjust gain\r\n        this.gated.forEach(function (conn) { return conn.gain = _this.activation; });\r\n        return this.activation;\r\n    };\r\n    PoolNode.prototype.propagate = function (target, options) {\r\n        if (options === void 0) { options = {}; }\r\n        options.momentum = Utils_1.getOrDefault(options.momentum, 0);\r\n        options.rate = Utils_1.getOrDefault(options.rate, 0.3);\r\n        options.update = Utils_1.getOrDefault(options.update, true);\r\n        var connectionsStates = this.outgoing.map(function (conn) { return conn.to.errorResponsibility * conn.weight * conn.gain; });\r\n        this.errorResponsibility = this.errorProjected = Utils_1.sum(connectionsStates) * this.derivative;\r\n        if (this.poolingType === NodeType_1.PoolNodeType.AVG_POOLING) {\r\n            for (var _i = 0, _a = this.incoming; _i < _a.length; _i++) {\r\n                var connection = _a[_i];\r\n                // calculate gradient\r\n                var gradient = this.errorProjected * connection.eligibility;\r\n                for (var i = 0; i < connection.xTraceNodes.length; i++) {\r\n                    gradient += connection.xTraceNodes[i].errorResponsibility * connection.xTraceValues[i];\r\n                }\r\n                connection.deltaWeightsTotal += options.rate * gradient * this.mask;\r\n                if (options.update) {\r\n                    connection.deltaWeightsTotal += options.momentum * connection.deltaWeightsPrevious;\r\n                    connection.weight += connection.deltaWeightsTotal;\r\n                    connection.deltaWeightsPrevious = connection.deltaWeightsTotal;\r\n                    connection.deltaWeightsTotal = 0;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            // TODO: don't think that this is correct\r\n            // Passing only the connections that were used for getting the min or max\r\n            for (var i = 0; i < this.incoming.length; i++) {\r\n                this.incoming[i].weight = this.receivingIndex === i ? 1 : 0;\r\n                this.incoming[i].gain = this.receivingIndex === i ? 1 : 0;\r\n            }\r\n        }\r\n    };\r\n    PoolNode.prototype.toJSON = function () {\r\n        return Object.assign(_super.prototype.toJSON.call(this), {\r\n            poolType: this.poolingType\r\n        });\r\n    };\r\n    return PoolNode;\r\n}(ConstantNode_1.ConstantNode));\r\nexports.PoolNode = PoolNode;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Layer_1 = require(\"../Layer\");\r\nvar ConnectionType_1 = require(\"../../../enums/ConnectionType\");\r\nvar PoolingLayer = /** @class */ (function (_super) {\r\n    __extends(PoolingLayer, _super);\r\n    function PoolingLayer(outputSize) {\r\n        return _super.call(this, outputSize) || this;\r\n    }\r\n    PoolingLayer.prototype.getDefaultIncomingConnectionType = function () {\r\n        return ConnectionType_1.ConnectionType.POOLING;\r\n    };\r\n    return PoolingLayer;\r\n}(Layer_1.Layer));\r\nexports.PoolingLayer = PoolingLayer;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar PoolNode_1 = require(\"../../Nodes/PoolNode\");\r\nvar NodeType_1 = require(\"../../../enums/NodeType\");\r\nvar PoolingLayer_1 = require(\"./PoolingLayer\");\r\nvar ActivationType_1 = require(\"../../../enums/ActivationType\");\r\nvar AvgPooling1DLayer = /** @class */ (function (_super) {\r\n    __extends(AvgPooling1DLayer, _super);\r\n    function AvgPooling1DLayer(outputSize, options) {\r\n        var _a;\r\n        if (options === void 0) { options = {}; }\r\n        var _b;\r\n        var _this = _super.call(this, outputSize) || this;\r\n        var activationType = (_b = options.activationType) !== null && _b !== void 0 ? _b : ActivationType_1.ActivationType.IdentityActivation;\r\n        for (var i = 0; i < outputSize; i++) {\r\n            _this.inputNodes.add(new PoolNode_1.PoolNode(NodeType_1.PoolNodeType.AVG_POOLING).setSquash(activationType));\r\n        }\r\n        _this.outputNodes = _this.inputNodes;\r\n        (_a = _this.nodes).push.apply(_a, Array.from(_this.inputNodes));\r\n        return _this;\r\n    }\r\n    return AvgPooling1DLayer;\r\n}(PoolingLayer_1.PoolingLayer));\r\nexports.AvgPooling1DLayer = AvgPooling1DLayer;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar PoolNode_1 = require(\"../../Nodes/PoolNode\");\r\nvar NodeType_1 = require(\"../../../enums/NodeType\");\r\nvar PoolingLayer_1 = require(\"./PoolingLayer\");\r\nvar ActivationType_1 = require(\"../../../enums/ActivationType\");\r\nvar MinPooling1DLayer = /** @class */ (function (_super) {\r\n    __extends(MinPooling1DLayer, _super);\r\n    function MinPooling1DLayer(outputSize, options) {\r\n        var _a;\r\n        if (options === void 0) { options = {}; }\r\n        var _b;\r\n        var _this = _super.call(this, outputSize) || this;\r\n        var activationType = (_b = options.activationType) !== null && _b !== void 0 ? _b : ActivationType_1.ActivationType.IdentityActivation;\r\n        for (var i = 0; i < outputSize; i++) {\r\n            _this.inputNodes.add(new PoolNode_1.PoolNode(NodeType_1.PoolNodeType.MIN_POOLING).setSquash(activationType));\r\n        }\r\n        _this.outputNodes = _this.inputNodes;\r\n        (_a = _this.nodes).push.apply(_a, Array.from(_this.inputNodes));\r\n        return _this;\r\n    }\r\n    return MinPooling1DLayer;\r\n}(PoolingLayer_1.PoolingLayer));\r\nexports.MinPooling1DLayer = MinPooling1DLayer;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar PoolNode_1 = require(\"../../Nodes/PoolNode\");\r\nvar NodeType_1 = require(\"../../../enums/NodeType\");\r\nvar PoolingLayer_1 = require(\"./PoolingLayer\");\r\nvar ActivationType_1 = require(\"../../../enums/ActivationType\");\r\nvar MaxPooling1DLayer = /** @class */ (function (_super) {\r\n    __extends(MaxPooling1DLayer, _super);\r\n    function MaxPooling1DLayer(outputSize, options) {\r\n        var _a;\r\n        if (options === void 0) { options = {}; }\r\n        var _b;\r\n        var _this = _super.call(this, outputSize) || this;\r\n        var activationType = (_b = options.activationType) !== null && _b !== void 0 ? _b : ActivationType_1.ActivationType.IdentityActivation;\r\n        for (var i = 0; i < outputSize; i++) {\r\n            _this.inputNodes.add(new PoolNode_1.PoolNode(NodeType_1.PoolNodeType.MAX_POOLING).setSquash(activationType));\r\n        }\r\n        _this.outputNodes = _this.inputNodes;\r\n        (_a = _this.nodes).push.apply(_a, Array.from(_this.inputNodes));\r\n        return _this;\r\n    }\r\n    return MaxPooling1DLayer;\r\n}(PoolingLayer_1.PoolingLayer));\r\nexports.MaxPooling1DLayer = MaxPooling1DLayer;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AvgPooling1DLayer_1 = require(\"./AvgPooling1DLayer\");\r\nvar GlobalAvgPooling1DLayer = /** @class */ (function (_super) {\r\n    __extends(GlobalAvgPooling1DLayer, _super);\r\n    function GlobalAvgPooling1DLayer(outputSize, options) {\r\n        if (options === void 0) { options = {}; }\r\n        return _super.call(this, 1, options) || this;\r\n    }\r\n    return GlobalAvgPooling1DLayer;\r\n}(AvgPooling1DLayer_1.AvgPooling1DLayer));\r\nexports.GlobalAvgPooling1DLayer = GlobalAvgPooling1DLayer;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar MaxPooling1DLayer_1 = require(\"./MaxPooling1DLayer\");\r\nvar GlobalMaxPooling1DLayer = /** @class */ (function (_super) {\r\n    __extends(GlobalMaxPooling1DLayer, _super);\r\n    function GlobalMaxPooling1DLayer(outputSize, options) {\r\n        if (options === void 0) { options = {}; }\r\n        return _super.call(this, 1, options) || this;\r\n    }\r\n    return GlobalMaxPooling1DLayer;\r\n}(MaxPooling1DLayer_1.MaxPooling1DLayer));\r\nexports.GlobalMaxPooling1DLayer = GlobalMaxPooling1DLayer;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar MinPooling1DLayer_1 = require(\"./MinPooling1DLayer\");\r\nvar GlobalMinPooling1DLayer = /** @class */ (function (_super) {\r\n    __extends(GlobalMinPooling1DLayer, _super);\r\n    function GlobalMinPooling1DLayer(outputSize, options) {\r\n        if (options === void 0) { options = {}; }\r\n        return _super.call(this, 1, options) || this;\r\n    }\r\n    return GlobalMinPooling1DLayer;\r\n}(MinPooling1DLayer_1.MinPooling1DLayer));\r\nexports.GlobalMinPooling1DLayer = GlobalMinPooling1DLayer;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Layer_1 = require(\"../Layer\");\r\nvar Activation_1 = require(\"../../../methods/Activation\");\r\nvar Node_1 = require(\"../../Node\");\r\nvar ActivationType_1 = require(\"../../../enums/ActivationType\");\r\nvar NodeType_1 = require(\"../../../enums/NodeType\");\r\nvar ConnectionType_1 = require(\"../../../enums/ConnectionType\");\r\nvar GatingType_1 = require(\"../../../enums/GatingType\");\r\nvar GRULayer = /** @class */ (function (_super) {\r\n    __extends(GRULayer, _super);\r\n    function GRULayer(outputSize, options) {\r\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v;\r\n        if (options === void 0) { options = {}; }\r\n        var _w;\r\n        var _this = _super.call(this, outputSize) || this;\r\n        var updateGate = [];\r\n        var inverseUpdateGate = [];\r\n        var resetGate = [];\r\n        var memoryCell = [];\r\n        var previousOutput = [];\r\n        for (var i = 0; i < outputSize; i++) {\r\n            _this.inputNodes.add(new Node_1.Node(NodeType_1.NodeType.HIDDEN));\r\n            updateGate.push(new Node_1.Node(NodeType_1.NodeType.HIDDEN).setBias(1));\r\n            inverseUpdateGate.push(new Node_1.Node(NodeType_1.NodeType.HIDDEN).setBias(0).setSquash(ActivationType_1.ActivationType.LogisticActivation));\r\n            resetGate.push(new Node_1.Node(NodeType_1.NodeType.HIDDEN).setBias(0));\r\n            memoryCell.push(new Node_1.Node(NodeType_1.NodeType.HIDDEN).setSquash(ActivationType_1.ActivationType.TanhActivation));\r\n            previousOutput.push(new Node_1.Node(NodeType_1.NodeType.HIDDEN).setBias(0).setSquash(ActivationType_1.ActivationType.LogisticActivation));\r\n            _this.outputNodes.add(new Node_1.Node(NodeType_1.NodeType.HIDDEN));\r\n        }\r\n        (_a = _this.connections).push.apply(_a, Layer_1.Layer.connect(_this.inputNodes, updateGate, ConnectionType_1.ConnectionType.ALL_TO_ALL));\r\n        (_b = _this.connections).push.apply(_b, Layer_1.Layer.connect(_this.inputNodes, resetGate, ConnectionType_1.ConnectionType.ALL_TO_ALL));\r\n        (_c = _this.connections).push.apply(_c, Layer_1.Layer.connect(_this.inputNodes, memoryCell, ConnectionType_1.ConnectionType.ALL_TO_ALL));\r\n        (_d = _this.connections).push.apply(_d, Layer_1.Layer.connect(previousOutput, updateGate, ConnectionType_1.ConnectionType.ALL_TO_ALL));\r\n        (_e = _this.connections).push.apply(_e, Layer_1.Layer.connect(updateGate, inverseUpdateGate, ConnectionType_1.ConnectionType.ONE_TO_ONE, 1));\r\n        (_f = _this.connections).push.apply(_f, Layer_1.Layer.connect(previousOutput, resetGate, ConnectionType_1.ConnectionType.ALL_TO_ALL));\r\n        var reset = Layer_1.Layer.connect(previousOutput, memoryCell, ConnectionType_1.ConnectionType.ALL_TO_ALL);\r\n        (_g = _this.connections).push.apply(_g, reset);\r\n        (_h = _this.gates).push.apply(_h, Layer_1.Layer.gate(resetGate, reset, GatingType_1.GatingType.OUTPUT));\r\n        var update = Layer_1.Layer.connect(previousOutput, _this.outputNodes, ConnectionType_1.ConnectionType.ALL_TO_ALL);\r\n        var inverseUpdate = Layer_1.Layer.connect(memoryCell, _this.outputNodes, ConnectionType_1.ConnectionType.ALL_TO_ALL);\r\n        (_j = _this.connections).push.apply(_j, update);\r\n        (_k = _this.connections).push.apply(_k, inverseUpdate);\r\n        (_l = _this.gates).push.apply(_l, Layer_1.Layer.gate(updateGate, update, GatingType_1.GatingType.OUTPUT));\r\n        (_m = _this.gates).push.apply(_m, Layer_1.Layer.gate(inverseUpdateGate, inverseUpdate, GatingType_1.GatingType.OUTPUT));\r\n        (_o = _this.connections).push.apply(_o, Layer_1.Layer.connect(_this.outputNodes, previousOutput, ConnectionType_1.ConnectionType.ONE_TO_ONE, 1));\r\n        (_p = _this.nodes).push.apply(_p, Array.from(_this.inputNodes));\r\n        (_q = _this.nodes).push.apply(_q, updateGate);\r\n        (_r = _this.nodes).push.apply(_r, inverseUpdateGate);\r\n        (_s = _this.nodes).push.apply(_s, resetGate);\r\n        (_t = _this.nodes).push.apply(_t, memoryCell);\r\n        (_u = _this.nodes).push.apply(_u, Array.from(_this.outputNodes));\r\n        (_v = _this.nodes).push.apply(_v, previousOutput);\r\n        var activation = Activation_1.Activation.getActivation((_w = options.activationType) !== null && _w !== void 0 ? _w : ActivationType_1.ActivationType.LogisticActivation);\r\n        _this.outputNodes.forEach(function (node) { return node.squash = activation; });\r\n        return _this;\r\n    }\r\n    return GRULayer;\r\n}(Layer_1.Layer));\r\nexports.GRULayer = GRULayer;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Layer_1 = require(\"../Layer\");\r\nvar ActivationType_1 = require(\"../../../enums/ActivationType\");\r\nvar Node_1 = require(\"../../Node\");\r\nvar NodeType_1 = require(\"../../../enums/NodeType\");\r\nvar ConnectionType_1 = require(\"../../../enums/ConnectionType\");\r\nvar GatingType_1 = require(\"../../../enums/GatingType\");\r\nvar Activation_1 = require(\"../../../methods/Activation\");\r\nvar LSTMLayer = /** @class */ (function (_super) {\r\n    __extends(LSTMLayer, _super);\r\n    function LSTMLayer(outputSize, options) {\r\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t;\r\n        if (options === void 0) { options = {}; }\r\n        var _u;\r\n        var _this = _super.call(this, outputSize) || this;\r\n        var inputGate = [];\r\n        var forgetGate = [];\r\n        var memoryCell = [];\r\n        var outputGate = [];\r\n        for (var i = 0; i < outputSize; i++) {\r\n            _this.inputNodes.add(new Node_1.Node(NodeType_1.NodeType.HIDDEN));\r\n            inputGate.push(new Node_1.Node(NodeType_1.NodeType.HIDDEN).setBias(1));\r\n            forgetGate.push(new Node_1.Node(NodeType_1.NodeType.HIDDEN).setBias(1).setSquash(ActivationType_1.ActivationType.LogisticActivation));\r\n            memoryCell.push(new Node_1.Node(NodeType_1.NodeType.HIDDEN));\r\n            outputGate.push(new Node_1.Node(NodeType_1.NodeType.HIDDEN).setBias(1));\r\n            _this.outputNodes.add(new Node_1.Node(NodeType_1.NodeType.HIDDEN));\r\n        }\r\n        (_a = _this.connections).push.apply(_a, Layer_1.Layer.connect(memoryCell, inputGate, ConnectionType_1.ConnectionType.ALL_TO_ALL));\r\n        (_b = _this.connections).push.apply(_b, Layer_1.Layer.connect(memoryCell, forgetGate, ConnectionType_1.ConnectionType.ALL_TO_ALL));\r\n        (_c = _this.connections).push.apply(_c, Layer_1.Layer.connect(memoryCell, outputGate, ConnectionType_1.ConnectionType.ALL_TO_ALL));\r\n        var forgetGateConnections = Layer_1.Layer.connect(memoryCell, memoryCell, ConnectionType_1.ConnectionType.ONE_TO_ONE);\r\n        var outputGateConnections = Layer_1.Layer.connect(memoryCell, _this.outputNodes, ConnectionType_1.ConnectionType.ALL_TO_ALL);\r\n        (_d = _this.connections).push.apply(_d, forgetGateConnections);\r\n        (_e = _this.connections).push.apply(_e, outputGateConnections);\r\n        (_f = _this.connections).push.apply(_f, Layer_1.Layer.connect(_this.inputNodes, memoryCell, ConnectionType_1.ConnectionType.ALL_TO_ALL));\r\n        (_g = _this.connections).push.apply(_g, Layer_1.Layer.connect(_this.inputNodes, outputGate, ConnectionType_1.ConnectionType.ALL_TO_ALL));\r\n        (_h = _this.connections).push.apply(_h, Layer_1.Layer.connect(_this.inputNodes, forgetGate, ConnectionType_1.ConnectionType.ALL_TO_ALL));\r\n        var inputGateConnections = Layer_1.Layer.connect(_this.inputNodes, inputGate, ConnectionType_1.ConnectionType.ALL_TO_ALL);\r\n        (_j = _this.connections).push.apply(_j, inputGateConnections);\r\n        (_k = _this.gates).push.apply(_k, Layer_1.Layer.gate(forgetGate, forgetGateConnections, GatingType_1.GatingType.SELF));\r\n        (_l = _this.gates).push.apply(_l, Layer_1.Layer.gate(outputGate, outputGateConnections, GatingType_1.GatingType.OUTPUT));\r\n        (_m = _this.gates).push.apply(_m, Layer_1.Layer.gate(inputGate, inputGateConnections, GatingType_1.GatingType.INPUT));\r\n        (_o = _this.nodes).push.apply(_o, Array.from(_this.inputNodes));\r\n        (_p = _this.nodes).push.apply(_p, inputGate);\r\n        (_q = _this.nodes).push.apply(_q, forgetGate);\r\n        (_r = _this.nodes).push.apply(_r, memoryCell);\r\n        (_s = _this.nodes).push.apply(_s, outputGate);\r\n        (_t = _this.nodes).push.apply(_t, Array.from(_this.outputNodes));\r\n        var activation = Activation_1.Activation.getActivation((_u = options.activationType) !== null && _u !== void 0 ? _u : ActivationType_1.ActivationType.TanhActivation);\r\n        _this.outputNodes.forEach(function (node) { return node.squash = activation; });\r\n        return _this;\r\n    }\r\n    return LSTMLayer;\r\n}(Layer_1.Layer));\r\nexports.LSTMLayer = LSTMLayer;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Layer_1 = require(\"../Layer\");\r\nvar Activation_1 = require(\"../../../methods/Activation\");\r\nvar Node_1 = require(\"../../Node\");\r\nvar ActivationType_1 = require(\"../../../enums/ActivationType\");\r\nvar NodeType_1 = require(\"../../../enums/NodeType\");\r\nvar ConnectionType_1 = require(\"../../../enums/ConnectionType\");\r\nvar MemoryLayer = /** @class */ (function (_super) {\r\n    __extends(MemoryLayer, _super);\r\n    function MemoryLayer(outputSize, options) {\r\n        var _a, _b, _c;\r\n        if (options === void 0) { options = {}; }\r\n        var _d, _e;\r\n        var _this = _super.call(this, outputSize) || this;\r\n        for (var i = 0; i < outputSize; i++) {\r\n            _this.inputNodes.add(new Node_1.Node(NodeType_1.NodeType.HIDDEN));\r\n        }\r\n        var prevNodes = Array.from(_this.inputNodes);\r\n        var nodes = [];\r\n        for (var i = 0; i < ((_d = options.memorySize) !== null && _d !== void 0 ? _d : 1); i++) {\r\n            var block = [];\r\n            for (var j = 0; j < outputSize; j++) {\r\n                var node = new Node_1.Node(NodeType_1.NodeType.HIDDEN);\r\n                node.squash = new Activation_1.IdentityActivation();\r\n                node.bias = 0;\r\n                block.push(node);\r\n            }\r\n            (_a = _this.connections).push.apply(_a, Layer_1.Layer.connect(prevNodes, block, ConnectionType_1.ConnectionType.ONE_TO_ONE));\r\n            nodes.push.apply(nodes, block);\r\n            prevNodes = block;\r\n        }\r\n        (_b = _this.nodes).push.apply(_b, Array.from(_this.inputNodes));\r\n        (_c = _this.nodes).push.apply(_c, (nodes.reverse()));\r\n        prevNodes.forEach(function (node) { return _this.outputNodes.add(node); });\r\n        var activation = Activation_1.Activation.getActivation((_e = options.activationType) !== null && _e !== void 0 ? _e : ActivationType_1.ActivationType.LogisticActivation);\r\n        _this.outputNodes.forEach(function (node) { return node.squash = activation; });\r\n        return _this;\r\n    }\r\n    return MemoryLayer;\r\n}(Layer_1.Layer));\r\nexports.MemoryLayer = MemoryLayer;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * Loss functions play an important role in neural networks. They give neural networks an indication of 'how wrong' they are; a.k.a. how far they are from the desired outputs. Also in fitness functions, loss functions play an important role.\r\n *\r\n * @see [Loss Function on Wikipedia](https://en.wikipedia.org/wiki/Loss_function)\r\n */\r\nvar Loss = /** @class */ (function () {\r\n    function Loss() {\r\n    }\r\n    return Loss;\r\n}());\r\nexports.Loss = Loss;\r\n/**\r\n * Cross entropy error\r\n *\r\n * @see {@link http://bit.ly/2p5W29A | Cross-entropy Error Function}\r\n * @param targets Ideal value\r\n * @param outputs Actual values\r\n *\r\n * @return [Cross entropy error](https://ml-cheatsheet.readthedocs.io/en/latest/loss_functions.html)\r\n *\r\n * @example\r\n * let myNetwork = new Network(5, 5);\r\n * myNetwork.train(trainingData, { loss: new CrossEntropyLoss() });\r\n */\r\nvar CrossEntropyLoss = /** @class */ (function (_super) {\r\n    __extends(CrossEntropyLoss, _super);\r\n    function CrossEntropyLoss() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    CrossEntropyLoss.prototype.calc = function (targets, outputs) {\r\n        var error = 0;\r\n        outputs.forEach((function (value, index) {\r\n            error -= targets[index] * Math.log(Math.max(value, 1e-15)) + (1 - targets[index]) * Math.log(1 - Math.max(value, 1e-15));\r\n        }));\r\n        return error / outputs.length;\r\n    };\r\n    return CrossEntropyLoss;\r\n}(Loss));\r\nexports.CrossEntropyLoss = CrossEntropyLoss;\r\n/**\r\n * Mean Squared Error\r\n *\r\n * @param targets Ideal value\r\n * @param outputs Actual values\r\n *\r\n * @return [Mean squared error](https://medium.freecodecamp.org/machine-learning-mean-squared-error-regression-line-c7dde9a26b93)\r\n *\r\n * @example\r\n * let myNetwork = new Network(5, 5);\r\n * myNetwork.train(trainingData, { loss: new MSELoss() });\r\n */\r\nvar MSELoss = /** @class */ (function (_super) {\r\n    __extends(MSELoss, _super);\r\n    function MSELoss() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    MSELoss.prototype.calc = function (targets, outputs) {\r\n        var error = 0;\r\n        outputs.forEach((function (value, index) {\r\n            error += Math.pow(targets[index] - value, 2);\r\n        }));\r\n        return error / outputs.length;\r\n    };\r\n    return MSELoss;\r\n}(Loss));\r\nexports.MSELoss = MSELoss;\r\n/**\r\n * Binary Error\r\n *\r\n * @param targets Ideal value\r\n * @param outputs Actual values\r\n *\r\n * @return misses The amount of times targets value was missed\r\n *\r\n * @example\r\n * let myNetwork = new Network(5, 5);\r\n * myNetwork.train(trainingData, {\r\n *   log: 1,\r\n *   iterations: 500,\r\n *   error: 0.03,\r\n *   rate: 0.05,\r\n *   loss: new BinaryLoss()\r\n * });\r\n */\r\nvar BinaryLoss = /** @class */ (function (_super) {\r\n    __extends(BinaryLoss, _super);\r\n    function BinaryLoss() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    BinaryLoss.prototype.calc = function (targets, outputs) {\r\n        var error = 0;\r\n        outputs.forEach((function (value, index) {\r\n            error += Math.round(targets[index] * 2) !== Math.round(value * 2) ? 1 : 0;\r\n        }));\r\n        return error / outputs.length;\r\n    };\r\n    return BinaryLoss;\r\n}(Loss));\r\nexports.BinaryLoss = BinaryLoss;\r\n/**\r\n * Mean Absolute Error\r\n *\r\n * @param targets Ideal value\r\n * @param outputs Actual values\r\n *\r\n * @return [Mean absolute error](https://en.wikipedia.org/wiki/Mean_absolute_error)\r\n *\r\n * @example\r\n * let myNetwork = new Network(5, 5);\r\n * myNetwork.train(trainingData, {\r\n *   log: 1,\r\n *   iterations: 500,\r\n *   error: 0.03,\r\n *   rate: 0.05,\r\n *   loss: new MAELoss()\r\n * });\r\n */\r\nvar MAELoss = /** @class */ (function (_super) {\r\n    __extends(MAELoss, _super);\r\n    function MAELoss() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    MAELoss.prototype.calc = function (targets, outputs) {\r\n        var error = 0;\r\n        outputs.forEach((function (value, index) {\r\n            error += Math.abs(targets[index] - value);\r\n        }));\r\n        return error / outputs.length;\r\n    };\r\n    return MAELoss;\r\n}(Loss));\r\nexports.MAELoss = MAELoss;\r\n/**\r\n * Mean Absolute Percentage Error\r\n *\r\n * @param targets Ideal value\r\n * @param outputs Actual values\r\n *\r\n * @return [Mean absolute percentage error](https://en.wikipedia.org/wiki/Mean_absolute_percentage_error)\r\n *\r\n * @example\r\n * let myNetwork = new Network(5, 5);\r\n * myNetwork.train(trainingData, {\r\n *   log: 1,\r\n *   iterations: 500,\r\n *   error: 0.03,\r\n *   rate: 0.05,\r\n *   loss: new MAPELoss()\r\n * });\r\n */\r\nvar MAPELoss = /** @class */ (function (_super) {\r\n    __extends(MAPELoss, _super);\r\n    function MAPELoss() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    MAPELoss.prototype.calc = function (targets, outputs) {\r\n        var error = 0;\r\n        outputs.forEach((function (value, index) {\r\n            error += Math.abs((value - targets[index]) / Math.max(targets[index], 1e-15));\r\n        }));\r\n        return error / outputs.length;\r\n    };\r\n    return MAPELoss;\r\n}(Loss));\r\nexports.MAPELoss = MAPELoss;\r\n/**\r\n * Weighted Absolute Percentage Error (WAPE)\r\n *\r\n * @param targets Ideal value\r\n * @param outputs Actual values\r\n *\r\n * @return - [Weighted absolute percentage error](https://help.sap.com/doc/saphelp_nw70/7.0.31/en-US/76/487053bbe77c1ee10000000a174cb4/content.htm?no_cache=true)\r\n *\r\n * @example\r\n * let myNetwork = new Network(5, 5);\r\n * myNetwork.train(trainingData, {\r\n *   loss: new WAPELoss()\r\n * });\r\n */\r\nvar WAPELoss = /** @class */ (function (_super) {\r\n    __extends(WAPELoss, _super);\r\n    function WAPELoss() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    WAPELoss.prototype.calc = function (targets, outputs) {\r\n        var error = 0;\r\n        var sum = 0;\r\n        for (var i = 0; i < outputs.length; i++) {\r\n            error += Math.abs(targets[i] - outputs[i]);\r\n            sum += targets[i];\r\n        }\r\n        return error / sum;\r\n    };\r\n    return WAPELoss;\r\n}(Loss));\r\nexports.WAPELoss = WAPELoss;\r\n/**\r\n * Mean Squared Logarithmic Error\r\n *\r\n * @param targets Ideal value\r\n * @param outputs Actual values\r\n *\r\n * @return - [Mean squared logarithmic error](https://peltarion.com/knowledge-center/documentation/modeling-view/build-an-ai-model/loss-functions/mean-squared-logarithmic-error)\r\n *\r\n * @example\r\n * let myNetwork = new Network(5, 5);\r\n * myNetwork.train(trainingData, {\r\n *   log: 1,\r\n *   iterations: 500,\r\n *   error: 0.03,\r\n *   rate: 0.05,\r\n *   loss: new MSLELoss()\r\n * });\r\n */\r\nvar MSLELoss = /** @class */ (function (_super) {\r\n    __extends(MSLELoss, _super);\r\n    function MSLELoss() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    MSLELoss.prototype.calc = function (targets, outputs) {\r\n        var error = 0;\r\n        outputs.forEach((function (value, index) {\r\n            error += Math.log(Math.max(targets[index], 1e-15)) - Math.log(Math.max(value, 1e-15));\r\n        }));\r\n        return error / outputs.length;\r\n    };\r\n    return MSLELoss;\r\n}(Loss));\r\nexports.MSLELoss = MSLELoss;\r\n/**\r\n * Hinge loss, for classifiers\r\n *\r\n * @param targets Ideal value\r\n * @param outputs Actual values\r\n *\r\n * @return - [Hinge loss](https://towardsdatascience.com/support-vector-machines-intuitive-understanding-part-1-3fb049df4ba1)\r\n *\r\n * @example\r\n * let myNetwork = new Network(5, 5);\r\n * myNetwork.train(trainingData, {\r\n *   log: 1,\r\n *   iterations: 500,\r\n *   error: 0.03,\r\n *   rate: 0.05,\r\n *   loss: new HINGELoss()\r\n * });\r\n */\r\nvar HINGELoss = /** @class */ (function (_super) {\r\n    __extends(HINGELoss, _super);\r\n    function HINGELoss() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    HINGELoss.prototype.calc = function (targets, outputs) {\r\n        var error = 0;\r\n        outputs.forEach(function (value, index) {\r\n            error += Math.max(0, 1 - value * targets[index]);\r\n        });\r\n        return error / outputs.length;\r\n    };\r\n    return HINGELoss;\r\n}(Loss));\r\nexports.HINGELoss = HINGELoss;\r\nvar ALL_LOSSES = [\r\n    new CrossEntropyLoss(),\r\n    new MSELoss(),\r\n    new BinaryLoss(),\r\n    new MAELoss(),\r\n    new MAPELoss(),\r\n    new WAPELoss(),\r\n    new MSLELoss(),\r\n    new HINGELoss()\r\n];\r\nexports.ALL_LOSSES = ALL_LOSSES;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * Built-in learning rate policies, which allow for a dynamic learning rate during neural network training.\r\n *\r\n * @see [Learning rates and how-to improve performance](https://towardsdatascience.com/understanding-learning-rates-and-how-it-improves-performance-in-deep-learning-d0d4059c1c10)\r\n * @see [Learning rate policy](https://stackoverflow.com/questions/30033096/what-is-lr-policy-in-caffe/30045244)\r\n *\r\n * @example\r\n * let network = new Network(5, 5);\r\n *\r\n * // OPTION #1: FixedRate\r\n * network.train(dataset, { ratePolicy: new FixedRate() });\r\n *\r\n * // OPTION #2: StepRate\r\n * network.train(dataset, { ratePolicy: new StepRate() });\r\n *\r\n * // OPTION #3: ExponentialRate\r\n * network.train(dataset, { ratePolicy: new ExponentialRate() });\r\n *\r\n * // OPTION #4: InverseRate\r\n * network.train(dataset, { ratePolicy: new InverseRate() });\r\n */\r\nvar Rate = /** @class */ (function () {\r\n    /**\r\n     * Constructs a rate policy\r\n     * @param baseRate the rate at first iteration\r\n     */\r\n    function Rate(baseRate) {\r\n        this.baseRate = baseRate;\r\n    }\r\n    return Rate;\r\n}());\r\nexports.Rate = Rate;\r\n/**\r\n * Fixed Learning Rate\r\n *\r\n * Default rate policy. Using this will make learning rate static (no change). Useful as a way to update a previous rate policy.\r\n *\r\n * @example\r\n * let network = new Network(10, 1);\r\n *\r\n * network.train(dataset, { ratePolicy: new FixedRate(0.3) });\r\n */\r\nvar FixedRate = /** @class */ (function (_super) {\r\n    __extends(FixedRate, _super);\r\n    function FixedRate() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    /**\r\n     * Calculates the current training rate.\r\n     *\r\n     * @param iteration count\r\n     * @returns the current training rate\r\n     */\r\n    FixedRate.prototype.calc = function (iteration) {\r\n        return this.baseRate;\r\n    };\r\n    return FixedRate;\r\n}(Rate));\r\nexports.FixedRate = FixedRate;\r\n/**\r\n * Step Learning Rate\r\n *\r\n * The learning rate will decrease (i.e. 'step down') every `stepSize` iterations.\r\n *\r\n * @example\r\n * let network = new Network(10, 1);\r\n *\r\n * network.train(dataset, { ratePolicy: new StepRate(0.3) });\r\n */\r\nvar StepRate = /** @class */ (function (_super) {\r\n    __extends(StepRate, _super);\r\n    /**\r\n     * Constructs a step rate policy.\r\n     *\r\n     * @param baseRate the rate at first iteration\r\n     * @param gamma=0.9 Learning rate retention per step; - _0 < `gamma` < 1_ - _large `gamma` CAN cause networks to never converge, low `gamma` CAN cause networks to converge too quickly_\r\n     * @param stepSize=100 Learning rate is updated every `step_size` iterations\r\n     */\r\n    function StepRate(baseRate, gamma, stepSize) {\r\n        if (gamma === void 0) { gamma = 0.9; }\r\n        if (stepSize === void 0) { stepSize = 100; }\r\n        var _this = _super.call(this, baseRate) || this;\r\n        _this.gamma = gamma;\r\n        _this.stepSize = stepSize;\r\n        return _this;\r\n    }\r\n    /**\r\n     * Calculates the current training rate.\r\n     *\r\n     * @param iteration count\r\n     * @returns the current training rate\r\n     */\r\n    StepRate.prototype.calc = function (iteration) {\r\n        return this.baseRate * Math.pow(this.gamma, Math.floor(iteration / this.stepSize));\r\n    };\r\n    return StepRate;\r\n}(Rate));\r\nexports.StepRate = StepRate;\r\n/**\r\n * Exponential Learning Rate\r\n *\r\n * The learning rate will exponentially decrease.\r\n *\r\n * The rate at `iteration` is calculated as: `rate = base_rate * Math.pow(gamma, iteration)`\r\n *\r\n * @example\r\n * let network = new Network(10, 1);\r\n *\r\n * network.train(dataset, { ratePolicy: new ExponentialRate(0.3) });\r\n */\r\nvar ExponentialRate = /** @class */ (function (_super) {\r\n    __extends(ExponentialRate, _super);\r\n    /**\r\n     * Constructs a step rate policy.\r\n     *\r\n     * @param baseRate the rate at first iteration\r\n     * @param gamma=0.9 Learning rate retention per step; - _0 < `gamma` < 1_ - _large `gamma` CAN cause networks to never converge, low `gamma` CAN cause networks to converge too quickly_\r\n     */\r\n    function ExponentialRate(baseRate, gamma) {\r\n        if (gamma === void 0) { gamma = 0.999; }\r\n        var _this = _super.call(this, baseRate) || this;\r\n        _this.gamma = gamma;\r\n        return _this;\r\n    }\r\n    /**\r\n     * Calculates the current training rate.\r\n     *\r\n     * @param iteration count\r\n     * @returns the current training rate\r\n     */\r\n    ExponentialRate.prototype.calc = function (iteration) {\r\n        return this.baseRate * Math.pow(this.gamma, iteration);\r\n    };\r\n    return ExponentialRate;\r\n}(Rate));\r\nexports.ExponentialRate = ExponentialRate;\r\n/**\r\n * Inverse Exponential Learning Rate\r\n *\r\n * The learning rate will exponentially decrease.\r\n *\r\n * The rate at `iteration` is calculated as: `rate = baseRate * Math.pow(1 + gamma * iteration, -power)`\r\n *\r\n * @example\r\n * let network = new Network(10, 1);\r\n *\r\n * network.train(dataset, { ratePolicy: new InverseRate(0.3) });\r\n */\r\nvar InverseRate = /** @class */ (function (_super) {\r\n    __extends(InverseRate, _super);\r\n    /**\r\n     * Constructs a step rate policy.\r\n     *\r\n     * @param baseRate the rate at first iteration\r\n     * @param [gamma=0.001] Learning rate decay per iteration; - _0 < `gamma` < 1_ - _large `gamma` CAN cause networks to converge too quickly and stop learning, low `gamma` CAN cause networks to converge to learn VERY slowly_\r\n     * @param power=2 Decay rate per iteration - _0 < `power`_ - _large `power` CAN cause networks to stop learning quickly, low `power` CAN cause networks to learn VERY slowly_\r\n     */\r\n    function InverseRate(baseRate, gamma, power) {\r\n        if (gamma === void 0) { gamma = 0.001; }\r\n        if (power === void 0) { power = 2; }\r\n        var _this = _super.call(this, baseRate) || this;\r\n        _this.gamma = gamma;\r\n        _this.power = power;\r\n        return _this;\r\n    }\r\n    /**\r\n     * Calculates the current training rate.\r\n     *\r\n     * @param iteration count\r\n     * @returns the current training rate\r\n     */\r\n    InverseRate.prototype.calc = function (iteration) {\r\n        return this.baseRate * Math.pow(1 + this.gamma * iteration, -this.power);\r\n    };\r\n    return InverseRate;\r\n}(Rate));\r\nexports.InverseRate = InverseRate;\r\n","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Utils_1 = require(\"./Utils\");\r\n/**\r\n * Genetic Algorithm Selection Methods (Genetic Operator)\r\n *\r\n * @see [Genetic Algorithm - Selection]{@link https://en.wikipedia.org/wiki/Selection_(genetic_algorithm)}\r\n *\r\n * @example\r\n * let myNetwork = new Network(1,1);\r\n * let myTrainingSet = [{ input:[0], output:[1]}, { input:[1], output:[0]}];\r\n *\r\n * myNetwork.evolve(myTrainingSet, {\r\n *  generations: 10,\r\n *  selection: new PowerSelection() // eg.\r\n * });\r\n */\r\nvar Selection = /** @class */ (function () {\r\n    function Selection() {\r\n    }\r\n    return Selection;\r\n}());\r\nexports.Selection = Selection;\r\n/**\r\n * Fitness proportionate selection\r\n *\r\n * [Fitness Proportionate / Roulette Wheel Selection on Wikipedia](https://en.wikipedia.org/wiki/Fitness_proportionate_selection)\r\n *\r\n * @example\r\n * let myNetwork = new Network(1,1);\r\n * let myTrainingSet = [{ input:[0], output:[1]}, { input:[1], output:[0]}];\r\n *\r\n * myNetwork.evolve(myTrainingSet, {\r\n *  iterations: 10,\r\n *  selection: new FitnessProportionateSelection() // eg.\r\n * });\r\n */\r\nvar FitnessProportionateSelection = /** @class */ (function (_super) {\r\n    __extends(FitnessProportionateSelection, _super);\r\n    function FitnessProportionateSelection() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    FitnessProportionateSelection.prototype.select = function (population) {\r\n        var _a, _b, _c;\r\n        var totalFitness = 0;\r\n        var minimalFitness = 0;\r\n        for (var _i = 0, population_1 = population; _i < population_1.length; _i++) {\r\n            var genome = population_1[_i];\r\n            minimalFitness = Math.min((_a = genome.score) !== null && _a !== void 0 ? _a : minimalFitness, minimalFitness);\r\n            totalFitness += (_b = genome.score) !== null && _b !== void 0 ? _b : 0;\r\n        }\r\n        minimalFitness = Math.abs(minimalFitness);\r\n        totalFitness += minimalFitness * population.length;\r\n        var random = Utils_1.randDouble(0, totalFitness);\r\n        var value = 0;\r\n        for (var _d = 0, population_2 = population; _d < population_2.length; _d++) {\r\n            var genome = population_2[_d];\r\n            value += ((_c = genome.score) !== null && _c !== void 0 ? _c : 0) + minimalFitness;\r\n            if (random < value) {\r\n                return genome;\r\n            }\r\n        }\r\n        return Utils_1.pickRandom(population);\r\n    };\r\n    return FitnessProportionateSelection;\r\n}(Selection));\r\nexports.FitnessProportionateSelection = FitnessProportionateSelection;\r\n/**\r\n * Power selection\r\n *\r\n * A random decimal value between 0 and 1 will be generated (e.g. 0.5) then this value will get an exponential value (power, default is 4). So 0.5**4 = 0.0625. This is converted into an index for the array of the current population, sorted from fittest to worst.\r\n *\r\n * @example\r\n * let myNetwork = new Network(1,1);\r\n * let myTrainingSet = [{ input:[0], output:[1]}, { input:[1], output:[0]}];\r\n *\r\n * myNetwork.evolve(myTrainingSet, {\r\n *  iterations: 10,\r\n *  selection: new PowerSelection() // eg.\r\n * });\r\n */\r\nvar PowerSelection = /** @class */ (function (_super) {\r\n    __extends(PowerSelection, _super);\r\n    function PowerSelection(power) {\r\n        if (power === void 0) { power = 4; }\r\n        var _this = _super.call(this) || this;\r\n        _this.power = power;\r\n        return _this;\r\n    }\r\n    PowerSelection.prototype.select = function (population) {\r\n        return population[Math.floor(Math.pow(Math.random(), this.power) * population.length)];\r\n    };\r\n    return PowerSelection;\r\n}(Selection));\r\nexports.PowerSelection = PowerSelection;\r\n/**\r\n * Tournament selection\r\n *\r\n * [Tournament Selection on Wikipedia](https://en.wikipedia.org/wiki/Tournament_selection)\r\n *\r\n * @example\r\n * let myNetwork = new Network(1,1);\r\n * let myTrainingSet = [{ input:[0], output:[1]}, { input:[1], output:[0]}];\r\n *\r\n * myNetwork.evolve(myTrainingSet, {\r\n *  iterations: 10,\r\n *  selection: new TournamentSelection() // eg.\r\n * });\r\n */\r\nvar TournamentSelection = /** @class */ (function (_super) {\r\n    __extends(TournamentSelection, _super);\r\n    /**\r\n     * Constructs a tournament selection.\r\n     * @param size the size of a tournament\r\n     * @param probability Selects the best individual (when probability = 1).\r\n     */\r\n    function TournamentSelection(size, probability) {\r\n        if (size === void 0) { size = 5; }\r\n        if (probability === void 0) { probability = 0.5; }\r\n        var _this = _super.call(this) || this;\r\n        _this.size = size;\r\n        _this.probability = probability;\r\n        return _this;\r\n    }\r\n    TournamentSelection.prototype.select = function (population) {\r\n        if (this.size > population.length) {\r\n            throw new Error(\"Your tournament size should be lower than the population size, please change methods.selection.TOURNAMENT.size\");\r\n        }\r\n        // Create a tournament\r\n        var individuals = [];\r\n        for (var i = 0; i < this.size; i++) {\r\n            individuals.push(Utils_1.pickRandom(population));\r\n        }\r\n        // Sort the tournament individuals by score\r\n        individuals.sort(function (a, b) {\r\n            return b.score === undefined || a.score === undefined ? 0 : b.score - a.score;\r\n        });\r\n        // Select an individual\r\n        for (var i = 0; i < this.size; i++) {\r\n            if (Math.random() < this.probability || i === this.size - 1) {\r\n                return individuals[i];\r\n            }\r\n        }\r\n        return Utils_1.pickRandom(population);\r\n    };\r\n    return TournamentSelection;\r\n}(Selection));\r\nexports.TournamentSelection = TournamentSelection;\r\n","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Network_1 = require(\"./architecture/Network\");\r\nvar Utils_1 = require(\"./methods/Utils\");\r\nvar Selection_1 = require(\"./methods/Selection\");\r\nvar Mutation_1 = require(\"./methods/Mutation\");\r\nvar Activation_1 = require(\"./methods/Activation\");\r\n/**\r\n * Runs the NEAT algorithm on group of neural networks.\r\n *\r\n * @constructs Neat\r\n *\r\n * @private\r\n *\r\n * @param {Array<{input:number[],output:number[]}>} [dataset] A set of input values and ideal output values to evaluate a genome's fitness with. Must be included to use `NEAT.evaluate` without passing a dataset\r\n * @param {EvolveOptions} options - Configuration options\r\n * @param {number} input - The input size of `template` networks.\r\n * @param {number} output - The output size of `template` networks.\r\n * @param {boolean} [options.equal=false] When true [crossover](Network.crossOver) parent genomes are assumed to be equally fit and offspring are built with a random amount of neurons within the range of parents' number of neurons. Set to false to select the \"fittest\" parent as the neuron amount template.\r\n * @param {number} [options.clear=false] Clear the context of the population's nodes, basically reverting them to 'new' neurons. Useful for predicting timeseries with LSTM's.\r\n * @param {number} [options.populationSize=50] Population size of each generation.\r\n * @param {number} [options.growth=0.0001] Set the penalty for large networks. Penalty calculation: penalty = (genome.nodes.length + genome.connectoins.length + genome.gates.length) * growth; This penalty will get added on top of the error. Your growth should be a very small number.\r\n * @param {Loss} [options.loss=new MSELoss()]  Specify the cost function for the evolution, this tells a genome in the population how well it's performing. Default: methods.new MSELoss() (recommended).\r\n * @param {number} [options.amount=1] Set the amount of times to test the trainingset on a genome each generation. Useful for timeseries. Do not use for regular feedfoward problems.\r\n * @param {number} [options.elitism=1] Elitism of every evolution loop. [Elitism in genetic algortihtms.](https://www.researchgate.net/post/What_is_meant_by_the_term_Elitism_in_the_Genetic_Algorithm)\r\n * @param {number} [options.provenance=0] Number of genomes inserted the original network template (Network(input,output)) per evolution.\r\n * @param {number} [options.mutationRate=0.4] Sets the mutation rate. If set to 0.3, 30% of the new population will be mutated. Default is 0.4.\r\n * @param {number} [options.mutationAmount=1] If mutation occurs (randomNumber < mutationRate), sets amount of times a mutation method will be applied to the network.\r\n * @param {boolean} [options.fitnessPopulation=false] Flag to return the fitness of a population of genomes. Set this to false to evaluate each genome inidividually.\r\n * @param {((dataset: { input: number[]; output: number[] }[], population: Network[]) => Promise<void>)} [options.fitness] - A fitness function to evaluate the networks. Takes a `dataset` and a `genome` i.e. a [network](Network) or a `population` i.e. an array of networks and sets the genome `.score` property\r\n * @param {string} [options.selection=FITNESS_PROPORTIONATE] [Selection method](selection) for evolution (e.g. Selection.FITNESS_PROPORTIONATE).\r\n * @param {Array} [options.crossover] Sets allowed crossover methods for evolution.\r\n * @param {Network} [options.network=false] Network to start evolution from\r\n * @param {number} [options.maxNodes=Infinity] Maximum nodes for a potential network\r\n * @param {number} [options.maxConnections=Infinity] Maximum connections for a potential network\r\n * @param {number} [options.maxGates=Infinity] Maximum gates for a potential network\r\n * @param {Mutation[]} [options.mutation] Sets allowed [mutation methods](mutation) for evolution, a random mutation method will be chosen from the array when mutation occurs. Optional, but default methods are non-recurrent\r\n *\r\n * @prop {number} generation A count of the generations\r\n * @prop {Network[]} population The current population for the neat instance. Accessible through `neat.population`\r\n *\r\n * @example\r\n * let { Neat } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * let neat = new Neat(dataset, {\r\n *   elitism: 10,\r\n *   clear: true,\r\n *   populationSize: 1000\r\n * });\r\n */\r\nvar NEAT = /** @class */ (function () {\r\n    function NEAT(dataset, options) {\r\n        if (options === void 0) { options = {}; }\r\n        if (dataset.length === 0) {\r\n            throw new ReferenceError(\"No dataset given !\");\r\n        }\r\n        this.dataset = dataset;\r\n        this.generation = Utils_1.getOrDefault(options.generation, 0);\r\n        this.input = dataset[0].input.length;\r\n        this.output = dataset[0].output.length;\r\n        this.equal = Utils_1.getOrDefault(options.equal, true);\r\n        this.clear = Utils_1.getOrDefault(options.clear, false);\r\n        this.populationSize = Utils_1.getOrDefault(options.populationSize, 50);\r\n        this.elitism = Utils_1.getOrDefault(options.elitism, 2);\r\n        this.provenance = Utils_1.getOrDefault(options.provenance, 0);\r\n        this.mutationRate = Utils_1.getOrDefault(options.mutationRate, 0.6);\r\n        this.mutationAmount = Utils_1.getOrDefault(options.mutationAmount, 5);\r\n        if (!options.fitnessFunction)\r\n            throw new ReferenceError(\"No fitness function given\");\r\n        this.fitnessFunction = options.fitnessFunction;\r\n        this.selection = Utils_1.getOrDefault(options.selection, new Selection_1.FitnessProportionateSelection());\r\n        this.mutations = Utils_1.getOrDefault(options.mutations, Mutation_1.FEEDFORWARD_MUTATIONS);\r\n        this.activations = Utils_1.getOrDefault(options.activations, Activation_1.ALL_ACTIVATIONS);\r\n        this.template = Utils_1.getOrDefault(options.template, new Network_1.Network(this.input, this.output));\r\n        this.maxNodes = Utils_1.getOrDefault(options.maxNodes, Infinity);\r\n        this.maxConnections = Utils_1.getOrDefault(options.maxConnections, Infinity);\r\n        this.maxGates = Utils_1.getOrDefault(options.maxGates, Infinity);\r\n        this.population = [];\r\n        this.createInitialPopulation();\r\n    }\r\n    NEAT.prototype.filterGenome = function (population, template, pickGenome, adjustGenome) {\r\n        var filtered = __spreadArrays(population); // avoid mutations\r\n        if (adjustGenome) {\r\n            filtered\r\n                .filter(function (genome) { return pickGenome(genome); })\r\n                .forEach(function (genome, index) { return filtered[index] = adjustGenome(filtered[index]); });\r\n        }\r\n        else {\r\n            filtered\r\n                .filter(function (genome) { return pickGenome(genome); })\r\n                .forEach(function (genome, index) { return filtered[index] = template.copy(); });\r\n        }\r\n        return filtered;\r\n    };\r\n    NEAT.prototype.mutateRandom = function (genome, possible) {\r\n        if (possible === void 0) { possible = Mutation_1.ALL_MUTATIONS; }\r\n        var maxNodes = this.maxNodes;\r\n        var maxConnections = this.maxConnections;\r\n        var maxGates = this.maxGates;\r\n        possible = possible.filter(function (method) {\r\n            return (method.constructor.name !== Mutation_1.AddNodeMutation.constructor.name || genome.nodes.length < maxNodes ||\r\n                method.constructor.name !== Mutation_1.AddConnectionMutation.constructor.name || genome.connections.length < maxConnections ||\r\n                method.constructor.name !== Mutation_1.AddGateMutation.constructor.name || genome.gates.length < maxGates);\r\n        });\r\n        genome.mutate(Utils_1.pickRandom(possible), { allowedActivations: this.activations });\r\n    };\r\n    /**\r\n     * Evaluates, selects, breeds and mutates population\r\n     *\r\n     * @param {function} [pickGenome] A custom selection function to pick out unwanted genomes. Accepts a network as a parameter and returns true for selection.\r\n     * @param {function} [adjustGenome=self.template] Accepts a network, modifies it, and returns it. Used to modify unwanted genomes returned by `pickGenome` and reincorporate them into the population. If left unset, unwanted genomes will be replaced with the template Network. Will only run when pickGenome is defined.\r\n     *\r\n     * @returns {Network} Fittest network\r\n     *\r\n     * @example\r\n     * let neat = new Neat(dataset, {\r\n     *  elitism: 10,\r\n     *  clear: true,\r\n     *  populationSize: 1000\r\n     * });\r\n     *\r\n     * let filter = function(genome) {\r\n     *  // Remove genomes with more than 100 nodes\r\n     *  return genome.nodes.length > 100 ? true : false\r\n     * }\r\n     *\r\n     * let adjust = function(genome) {\r\n     *  // clear the nodes\r\n     *  return genome.clear()\r\n     * }\r\n     *\r\n     * neat.evolve(evolveSet, filter, adjust).then(function(fittest) {\r\n     *  console.log(fittest)\r\n     * })\r\n     */\r\n    NEAT.prototype.evolve = function (pickGenome, adjustGenome) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var elitists, i, newPopulation, i, fittest;\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        // Check if evolve is possible\r\n                        if (this.elitism + this.provenance > this.populationSize) {\r\n                            throw new Error(\"Can`t evolve! Elitism + provenance exceeds population size!\");\r\n                        }\r\n                        if (!(this.population[this.population.length - 1].score === undefined)) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.evaluate(this.dataset)];\r\n                    case 1:\r\n                        _b.sent();\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        if (pickGenome) {\r\n                            this.population = this.filterGenome(this.population, this.template, pickGenome, adjustGenome);\r\n                        }\r\n                        // Sort in order of fitness (fittest first)\r\n                        this.sort();\r\n                        elitists = [];\r\n                        for (i = 0; i < this.elitism; i++) {\r\n                            elitists.push(this.population[i]);\r\n                        }\r\n                        newPopulation = Array(this.provenance).fill(this.template.copy());\r\n                        // Breed the next individuals\r\n                        for (i = 0; i < this.populationSize - this.elitism - this.provenance; i++) {\r\n                            newPopulation.push(this.getOffspring());\r\n                        }\r\n                        // Replace the old population with the new population\r\n                        this.population = newPopulation;\r\n                        // Mutate the new population\r\n                        this.mutate();\r\n                        // Add the elitists\r\n                        (_a = this.population).push.apply(_a, elitists);\r\n                        // evaluate the population\r\n                        return [4 /*yield*/, this.evaluate(this.dataset)];\r\n                    case 3:\r\n                        // evaluate the population\r\n                        _b.sent();\r\n                        // Check & adjust genomes as needed\r\n                        if (pickGenome) {\r\n                            this.population = this.filterGenome(this.population, this.template, pickGenome, adjustGenome);\r\n                        }\r\n                        // Sort in order of fitness (fittest first)\r\n                        this.sort();\r\n                        fittest = this.population[0].copy();\r\n                        fittest.score = this.population[0].score;\r\n                        // Reset the scores\r\n                        this.population.forEach(function (genome) { return genome.score = undefined; });\r\n                        this.generation++;\r\n                        return [2 /*return*/, fittest];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Selects two genomes from the population with `getParent()`, and returns the offspring from those parents. NOTE: Population MUST be sorted\r\n     *\r\n     * @returns {Network} Child network\r\n     */\r\n    NEAT.prototype.getOffspring = function () {\r\n        this.sort();\r\n        var parent1 = this.selection.select(this.population);\r\n        var parent2 = this.selection.select(this.population);\r\n        if (parent1 === null || parent2 === null) {\r\n            throw new ReferenceError(\"Should not be null!\");\r\n        }\r\n        return Network_1.Network.crossOver(parent1, parent2, this.equal);\r\n    };\r\n    /**\r\n     * Mutates the given (or current) population\r\n     *\r\n     * @param {Mutation} [method] A mutation method to mutate the population with. When not specified will pick a random mutation from the set allowed mutations.\r\n     */\r\n    NEAT.prototype.mutate = function (method) {\r\n        var _this = this;\r\n        if (method) {\r\n            // Elitist genomes should not be included\r\n            this.population\r\n                .filter(function () { return Math.random() <= _this.mutationRate; })\r\n                .forEach(function (genome) {\r\n                for (var i = 0; i < _this.mutationAmount; i++) {\r\n                    genome.mutate(method);\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            // Elitist genomes should not be included\r\n            this.population\r\n                .filter(function () { return Math.random() <= _this.mutationRate; })\r\n                .forEach(function (genome) {\r\n                for (var i = 0; i < _this.mutationAmount; i++) {\r\n                    _this.mutateRandom(genome, _this.mutations);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * Evaluates the current population, basically sets their `.score` property\r\n     *\r\n     * @return {Network} Fittest Network\r\n     */\r\n    NEAT.prototype.evaluate = function (dataset) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (this.clear) {\r\n                            this.population.forEach(function (genome) { return genome.clear(); });\r\n                        }\r\n                        return [4 /*yield*/, this.fitnessFunction(dataset, this.population)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        // Sort the population in order of fitness\r\n                        this.sort();\r\n                        return [2 /*return*/, this.population[0]];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Sorts the population by score\r\n     */\r\n    NEAT.prototype.sort = function () {\r\n        this.population.sort(function (a, b) {\r\n            return a.score === undefined || b.score === undefined ? 0 : b.score - a.score;\r\n        });\r\n    };\r\n    /**\r\n     * Returns the fittest genome of the current population\r\n     *\r\n     * @returns {Network} Current population's fittest genome\r\n     */\r\n    NEAT.prototype.getFittest = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(this.population[this.population.length - 1].score === undefined)) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.evaluate(this.dataset)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        this.sort();\r\n                        return [2 /*return*/, this.population[0]];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Returns the average fitness of the current population\r\n     *\r\n     * @returns {number} Average fitness of the current population\r\n     */\r\n    NEAT.prototype.getAverage = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var score;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(this.population[this.population.length - 1].score === undefined)) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.evaluate(this.dataset)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        score = 0;\r\n                        this.population\r\n                            .map(function (genome) { return genome.score; })\r\n                            .forEach(function (val) { return score += val !== null && val !== void 0 ? val : 0; });\r\n                        return [2 /*return*/, score / this.population.length];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Create the initial pool of genomes\r\n     */\r\n    NEAT.prototype.createInitialPopulation = function () {\r\n        for (var i = 0; i < this.populationSize; i++) {\r\n            this.population.push(this.template.copy());\r\n        }\r\n    };\r\n    return NEAT;\r\n}());\r\nexports.NEAT = NEAT;\r\n","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Connection_1 = require(\"./Connection\");\r\nvar Utils_1 = require(\"../methods/Utils\");\r\nvar Mutation_1 = require(\"../methods/Mutation\");\r\nvar Loss_1 = require(\"../methods/Loss\");\r\nvar Rate_1 = require(\"../methods/Rate\");\r\nvar NEAT_1 = require(\"../NEAT\");\r\nvar threads_1 = require(\"threads\");\r\nrequire(\"threads/register\");\r\nvar NodeType_1 = require(\"../enums/NodeType\");\r\nvar Node_1 = require(\"./Node\");\r\n/**\r\n * Create a neural network\r\n *\r\n * Networks are easy to create, all you need to specify is an `input` and an `output` size.\r\n *\r\n * @constructs Network\r\n *\r\n * @param {number} inputSize Size of input layer AKA neurons in input layer\r\n * @param {number} outputSize Size of output layer AKA neurons in output layer\r\n *\r\n * @prop {number} inputSize Size of input layer AKA neurons in input layer\r\n * @prop {number} outputSize Size of output layer AKA neurons in output layer\r\n * @prop {Array<Node>} nodes Nodes currently within the network\r\n * @prop {Array<Node>} gates Gates within the network\r\n * @prop {Array<Connection>} connections Connections within the network\r\n *\r\n * @example\r\n * let { Network } = require(\"@liquid-carrot/carrot\");\r\n *\r\n * // Network with 2 input neurons and 1 output neuron\r\n * let myNetwork = new Network(2, 1);\r\n */\r\nvar Network = /** @class */ (function () {\r\n    function Network(inputSize, outputSize) {\r\n        this.inputSize = inputSize;\r\n        this.outputSize = outputSize;\r\n        this.nodes = [];\r\n        this.connections = [];\r\n        this.gates = [];\r\n        this.score = undefined;\r\n        // Create input and output nodes\r\n        for (var i = 0; i < inputSize; i++) {\r\n            this.nodes.push(new Node_1.Node(NodeType_1.NodeType.INPUT));\r\n        }\r\n        for (var i = 0; i < outputSize; i++) {\r\n            this.nodes.push(new Node_1.Node(NodeType_1.NodeType.OUTPUT));\r\n        }\r\n        // Connect input and output nodes\r\n        for (var i = 0; i < this.inputSize; i++) {\r\n            for (var j = this.inputSize; j < this.outputSize + this.inputSize; j++) {\r\n                // https://stats.stackexchange.com/a/248040/147931\r\n                var weight = (Math.random() - 0.5) * this.inputSize * Math.sqrt(2 / this.inputSize);\r\n                this.connect(this.nodes[i], this.nodes[j], weight);\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Convert a json object to a network\r\n     *\r\n     * @param {{input:{number},output:{number},dropout:{number},nodes:Array<object>,connections:Array<object>}} json A network represented as a json object\r\n     *\r\n     * @returns {Network} Network A reconstructed network\r\n     *\r\n     * @example\r\n     * let { Network } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let exported = myNetwork.toJSON();\r\n     * let imported = Network.fromJSON(exported) // imported will be a new instance of Network that is an exact clone of myNetwork\r\n     */\r\n    Network.fromJSON = function (json) {\r\n        var network = new Network(json.inputSize, json.outputSize);\r\n        network.nodes = [];\r\n        network.connections = [];\r\n        json.nodes.map(function (nodeJSON) { return new Node_1.Node().fromJSON(nodeJSON); }).forEach(function (node) { return network.nodes[node.index] = node; });\r\n        json.connections.forEach(function (jsonConnection) {\r\n            var connection = network.connect(network.nodes[jsonConnection.fromIndex], network.nodes[jsonConnection.toIndex], jsonConnection.weight);\r\n            if (jsonConnection.gateNodeIndex != null) {\r\n                network.addGate(network.nodes[jsonConnection.gateNodeIndex], connection);\r\n            }\r\n        });\r\n        return network;\r\n    };\r\n    /**\r\n     * Create an offspring from two parent networks.\r\n     *\r\n     * Networks are not required to have the same size, however input and output size should be the same!\r\n     *\r\n     * @todo Add custom [crossover](crossover) method customization\r\n     *\r\n     * @param {Network} network1 First parent network\r\n     * @param {Network} network2 Second parent network\r\n     * @param {boolean} [equal] Flag to indicate equally fit Networks\r\n     *\r\n     * @returns {Network} New network created from mixing parent networks\r\n     */\r\n    Network.crossOver = function (network1, network2, equal) {\r\n        var _a, _b;\r\n        if (network1.inputSize !== network2.inputSize || network1.outputSize !== network2.outputSize) {\r\n            throw new Error(\"Networks don`t have the same input/output size!\");\r\n        }\r\n        // Initialise offspring\r\n        var offspring = new Network(network1.inputSize, network1.outputSize);\r\n        offspring.connections = []; // clear\r\n        offspring.nodes = []; // clear\r\n        // Save scores and create a copy\r\n        var score1 = (_a = network1.score) !== null && _a !== void 0 ? _a : 0;\r\n        var score2 = (_b = network2.score) !== null && _b !== void 0 ? _b : 0;\r\n        // Determine offspring node size\r\n        var offspringSize;\r\n        if (equal || score1 === score2) {\r\n            var max = Math.max(network1.nodes.length, network2.nodes.length);\r\n            var min = Math.min(network1.nodes.length, network2.nodes.length);\r\n            offspringSize = Utils_1.randInt(min, max + 1); // [min,max]\r\n        }\r\n        else if (score1 > score2) {\r\n            offspringSize = network1.nodes.length;\r\n        }\r\n        else {\r\n            offspringSize = network2.nodes.length;\r\n        }\r\n        var inputSize = network1.inputSize;\r\n        var outputSize = network1.outputSize;\r\n        // set node indices\r\n        for (var i = 0; i < network1.nodes.length; i++) {\r\n            network1.nodes[i].index = i;\r\n        }\r\n        // set node indices\r\n        for (var i = 0; i < network2.nodes.length; i++) {\r\n            network2.nodes[i].index = i;\r\n        }\r\n        // Assign nodes from parents to offspring\r\n        for (var i = 0; i < offspringSize; i++) {\r\n            var chosenNode = void 0;\r\n            var chosenNodeType = null;\r\n            // decide what type of node is needed first check for input and output nodes and fill up with hidden nodes\r\n            if (i < inputSize) { // pick input node\r\n                chosenNodeType = NodeType_1.NodeType.INPUT;\r\n                var sourceNetwork = Utils_1.randBoolean() ? network1 : network2;\r\n                var inputNumber = -1;\r\n                var j = -1;\r\n                while (inputNumber < i) {\r\n                    if (j++ >= sourceNetwork.nodes.length) {\r\n                        throw RangeError('something is wrong with the size of the input');\r\n                    }\r\n                    if (sourceNetwork.nodes[j].isInputNode()) {\r\n                        inputNumber++;\r\n                    }\r\n                }\r\n                chosenNode = sourceNetwork.nodes[j];\r\n            }\r\n            else if (i < inputSize + outputSize) { // pick output node\r\n                chosenNodeType = NodeType_1.NodeType.OUTPUT;\r\n                var sourceNetwork = Utils_1.randBoolean() ? network1 : network2;\r\n                var outputNumber = -1;\r\n                var j = -1;\r\n                while (outputNumber < i - inputSize) {\r\n                    j++;\r\n                    if (j >= sourceNetwork.nodes.length) {\r\n                        throw RangeError('something is wrong with the size of the output');\r\n                    }\r\n                    if (sourceNetwork.nodes[j].isOutputNode()) {\r\n                        outputNumber++;\r\n                    }\r\n                }\r\n                chosenNode = sourceNetwork.nodes[j];\r\n            }\r\n            else { // pick hidden node\r\n                chosenNodeType = NodeType_1.NodeType.HIDDEN;\r\n                var sourceNetwork = void 0;\r\n                if (i >= network1.nodes.length) {\r\n                    sourceNetwork = network2;\r\n                }\r\n                else if (i >= network2.nodes.length) {\r\n                    sourceNetwork = network1;\r\n                }\r\n                else {\r\n                    sourceNetwork = Utils_1.randBoolean() ? network1 : network2;\r\n                }\r\n                chosenNode = Utils_1.pickRandom(sourceNetwork.nodes);\r\n            }\r\n            var newNode = new Node_1.Node(chosenNodeType);\r\n            newNode.bias = chosenNode.bias;\r\n            newNode.squash = chosenNode.squash;\r\n            offspring.nodes.push(newNode);\r\n        }\r\n        // Create arrays of connection genes\r\n        var n1connections = [];\r\n        var n2connections = [];\r\n        // Add the connections of network 1\r\n        network1.connections.forEach(function (connection) {\r\n            n1connections[Connection_1.Connection.innovationID(connection.from.index, connection.to.index)] = connection.toJSON();\r\n        });\r\n        // Add the connections of network 2\r\n        network2.connections.forEach(function (connection) {\r\n            n2connections[Connection_1.Connection.innovationID(connection.from.index, connection.to.index)] = connection.toJSON();\r\n        });\r\n        // Split common conn genes from disjoint or excess conn genes\r\n        var connections = [];\r\n        var keys1 = Object.keys(n1connections);\r\n        var keys2 = Object.keys(n2connections);\r\n        for (var i = keys1.length - 1; i >= 0; i--) {\r\n            if (n2connections[parseInt(keys1[i])] !== undefined) {\r\n                connections.push(Utils_1.randBoolean() ? n1connections[parseInt(keys1[i])] : n2connections[parseInt(keys1[i])]);\r\n                n2connections[parseInt(keys1[i])] = undefined;\r\n            }\r\n            else if (score1 >= score2 || equal) {\r\n                connections.push(n1connections[parseInt(keys1[i])]);\r\n            }\r\n        }\r\n        // Excess/disjoint gene\r\n        if (score2 >= score1 || equal) {\r\n            keys2\r\n                .map(function (key) { return parseInt(key); }) // convert to numbers\r\n                .map(function (key) { return n2connections[key]; }) // get the connection\r\n                .filter(function (conn) { return conn !== undefined; }) // filter out undefined connections\r\n                .forEach(function (conn) { return connections.push(conn); }); // add the filtered connections\r\n        }\r\n        // Add common conn genes uniformly\r\n        connections.forEach(function (connectionJSON) {\r\n            if (connectionJSON !== undefined && connectionJSON.toIndex < offspringSize && connectionJSON.fromIndex < offspringSize) {\r\n                var from = offspring.nodes[connectionJSON.fromIndex];\r\n                var to = offspring.nodes[connectionJSON.toIndex];\r\n                var connection = offspring.connect(from, to, connectionJSON.weight);\r\n                if (connectionJSON.gateNodeIndex !== null && connectionJSON.gateNodeIndex < offspringSize) {\r\n                    offspring.addGate(offspring.nodes[connectionJSON.gateNodeIndex], connection);\r\n                }\r\n            }\r\n        });\r\n        return offspring;\r\n    };\r\n    /**\r\n     * Returns a copy of Network.\r\n     *\r\n     * @returns {Network} Returns an identical network\r\n     */\r\n    Network.prototype.copy = function () {\r\n        return Network.fromJSON(this.toJSON());\r\n    };\r\n    /**\r\n     * Connects a Node to another Node or Group in the network\r\n     *\r\n     * @param {Node} from The source Node\r\n     * @param {Node} to The destination Node or Group\r\n     * @param {number} [weight=0] An initial weight for the connections to be formed\r\n     *\r\n     * @returns {Connection[]} An array of the formed connections\r\n     *\r\n     * @example\r\n     * myNetwork.connect(myNetwork.nodes[4], myNetwork.nodes[5]); // connects network node 4 to network node 5\r\n     */\r\n    Network.prototype.connect = function (from, to, weight) {\r\n        if (weight === void 0) { weight = 0; }\r\n        var connection = from.connect(to, weight); // run node-level connect\r\n        this.connections.push(connection); // add it to the array\r\n        return connection;\r\n    };\r\n    /**\r\n     * Activates the network\r\n     *\r\n     * It will activate all the nodes in activation order and produce an output.\r\n     *\r\n     * @function activate\r\n     * @memberof Network\r\n     *\r\n     * @param {number[]} [input] Input values to activate nodes with\r\n     * @param options\r\n     * @param {number} [options.dropoutRate=0] The dropout rate. [dropout](https://medium.com/@amarbudhiraja/https-medium-com-amarbudhiraja-learning-less-to-learn-better-dropout-in-deep-machine-learning-74334da4bfc5)\r\n     * @param {boolean} [options.trace=true] Controls whether traces are created when activation happens (a trace is meta information left behind for different uses, e.g. backpropagation).\r\n     * @returns {number[]} Squashed output values\r\n     *\r\n     * @example\r\n     * let { Network } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * // Create a network\r\n     * let myNetwork = new Network(3, 2);\r\n     *\r\n     * myNetwork.activate([0.8, 1, 0.21]); // gives: [0.49, 0.51]\r\n     */\r\n    Network.prototype.activate = function (input, options) {\r\n        if (options === void 0) { options = {}; }\r\n        if (input.length !== this.inputSize) {\r\n            throw new RangeError(\"Input size of dataset is different to network input size!\");\r\n        }\r\n        // get default value if no value is given\r\n        options.dropoutRate = Utils_1.getOrDefault(options.dropoutRate, 0);\r\n        options.trace = Utils_1.getOrDefault(options.trace, true);\r\n        this.nodes\r\n            .filter(function (node) { return node.isInputNode(); }) // only input nodes\r\n            .forEach(function (node, index) { return node.activate(input[index], options.trace); }); // activate them with the input\r\n        this.nodes\r\n            .filter(function (node) { return node.isHiddenNode(); }) // only hidden nodes\r\n            .forEach(function (node) {\r\n            if (options.dropoutRate) {\r\n                node.mask = Math.random() >= options.dropoutRate ? 1 : 0;\r\n            }\r\n            node.activate(undefined, options.trace); // activate them\r\n        });\r\n        return this.nodes\r\n            .filter(function (node) { return node.isOutputNode(); }) // only output nodes\r\n            .map(function (node) { return node.activate(undefined, options.trace); }); // map them to there activation value will give the network's output\r\n    };\r\n    /**\r\n     * Backpropagate the network\r\n     *\r\n     * This function allows you to teach the network. If you want to do more complex training, use the `network.train()` function.\r\n     *\r\n     * @function propagate\r\n     * @memberof Network\r\n     *\r\n     * @param {number[]} target Ideal values of the previous activate. Will use the difference to improve the weights\r\n     * @param options More option for propagation\r\n     * @param {number} options.momentum=0 [Momentum](https://www.willamette.edu/~gorr/classes/cs449/momrate.html). Adds a fraction of the previous weight update to the current one.\r\n     * @param {boolean} options.update=false When set to false weights won't update, but when set to true after being false the last propagation will include the deltaweights of the first \"update:false\" propagations too.\r\n     * @param {number} options.rate=0.3 Sets the [learning rate](https://towardsdatascience.com/understanding-learning-rates-and-how-it-improves-performance-in-deep-learning-d0d4059c1c10) of the backpropagation process\r\n     *\r\n     * @example\r\n     * let { Network } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let myNetwork = new Network(1,1);\r\n     *\r\n     * // This trains the network to function as a NOT gate\r\n     * for(let nodeIndex: number= 0; i < 1000; i++){\r\n     *  network.activate([0]);\r\n     *  network.propagate(0.2, 0, true, [1]);\r\n     *  network.activate([1]);\r\n     *  network.propagate(0.3, 0, true, [0]);\r\n     * }\r\n     */\r\n    Network.prototype.propagate = function (target, options) {\r\n        if (options === void 0) { options = {}; }\r\n        // get default value if value isn't given\r\n        options.rate = Utils_1.getOrDefault(options.rate, 0.3);\r\n        options.momentum = Utils_1.getOrDefault(options.momentum, 0);\r\n        options.update = Utils_1.getOrDefault(options.update, false);\r\n        if (target.length !== this.outputSize) {\r\n            throw new Error(\"Output target length should match network output length\");\r\n        }\r\n        // Backpropagation: output -> hidden -> input\r\n        // propagate through the output nodes\r\n        this.nodes\r\n            .filter(function (node) { return node.isOutputNode(); }) // only output nodes\r\n            .forEach(function (node, index) { return node.propagate(target[index], options); }); // propagate\r\n        // propagate backwards through the hidden nodes\r\n        for (var i = this.nodes.length - 1; i >= 0; i--) {\r\n            if (this.nodes[i].isHiddenNode()) { // only hidden nodes\r\n                this.nodes[i].propagate(undefined, options);\r\n            }\r\n        }\r\n        // propagate through the input nodes\r\n        this.nodes\r\n            .filter(function (node) { return node.isInputNode(); }) // only input nodes\r\n            .forEach(function (node) { return node.propagate(undefined, options); }); // propagate\r\n    };\r\n    /**\r\n     * Clear the context of the network\r\n     *\r\n     * @function clear\r\n     * @memberof Network\r\n     */\r\n    Network.prototype.clear = function () {\r\n        this.nodes.forEach(function (node) { return node.clear(); });\r\n    };\r\n    /**\r\n     * Removes the connection of the `from` node to the `to` node\r\n     *\r\n     * @function disconnect\r\n     * @memberof Network\r\n     *\r\n     * @param {Node} from Source node\r\n     * @param {Node} to Destination node\r\n     *\r\n     * @example\r\n     * myNetwork.disconnect(myNetwork.nodes[4], myNetwork.nodes[5]);\r\n     * // now node 4 does not have an effect on the output of node 5 anymore\r\n     */\r\n    Network.prototype.disconnect = function (from, to) {\r\n        var _this = this;\r\n        // remove the connection network-level\r\n        this.connections\r\n            .filter(function (conn) { return conn.from === from; }) // check for incoming node\r\n            .filter(function (conn) { return conn.to === to; }) // check for outgoing node\r\n            .forEach(function (conn) {\r\n            if (conn.gateNode !== null) {\r\n                _this.removeGate(conn); // remove possible gate\r\n            }\r\n            Utils_1.removeFromArray(_this.connections, conn); // remove connection from array\r\n        });\r\n        // disconnect node-level\r\n        return from.disconnect(to);\r\n    };\r\n    /**\r\n     * Makes a network node gate a connection\r\n     *\r\n     * @function gate\r\n     * @memberof Network\r\n     *\r\n     * @todo Add ability to gate several network connections at once\r\n     *\r\n     * @param {Node} node Gating node\r\n     * @param {Connection} connection Connection to gate with node\r\n     *\r\n     * @example\r\n     * let { Network } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * myNetwork.gate(myNetwork.nodes[1], myNetwork.connections[5])\r\n     * // now: connection 5's weight is multiplied with node 1's activaton\r\n     */\r\n    Network.prototype.addGate = function (node, connection) {\r\n        if (this.nodes.indexOf(node) === -1) {\r\n            throw new ReferenceError(\"This node is not part of the network!\");\r\n        }\r\n        else if (connection.gateNode != null) {\r\n            return;\r\n        }\r\n        node.addGate(connection);\r\n        this.gates.push(connection);\r\n    };\r\n    /**\r\n     * Remove the gate of a connection.\r\n     *\r\n     * @function ungate\r\n     * @memberof Network\r\n     *\r\n     * @param {Connection} connection Connection to remove gate from\r\n     */\r\n    Network.prototype.removeGate = function (connection) {\r\n        if (!this.gates.includes(connection)) {\r\n            throw new Error(\"This connection is not gated!\");\r\n        }\r\n        Utils_1.removeFromArray(this.gates, connection);\r\n        if (connection.gateNode != null) {\r\n            connection.gateNode.removeGate(connection);\r\n        }\r\n    };\r\n    /**\r\n     * Removes a node from a network, all its connections will be redirected. If it gates a connection, the gate will be removed.\r\n     *\r\n     * @function remove\r\n     * @memberof Network\r\n     *\r\n     * @param {Node} node Node to remove from the network\r\n     * @param keepGates\r\n     */\r\n    Network.prototype.removeNode = function (node, keepGates) {\r\n        var _this = this;\r\n        if (keepGates === void 0) { keepGates = new Mutation_1.SubNodeMutation().keepGates; }\r\n        if (!this.nodes.includes(node)) {\r\n            throw new ReferenceError(\"This node does not exist in the network!\");\r\n        }\r\n        this.disconnect(node, node); // remove self connection\r\n        var inputs = []; // keep track\r\n        var gates = []; // keep track\r\n        var outputs = []; // keep track\r\n        var connections = []; // keep track\r\n        // read all inputs from node and keep track of the nodes that gate the incoming connection\r\n        for (var i = node.incoming.length - 1; i >= 0; i--) {\r\n            var connection = node.incoming[i];\r\n            if (keepGates && connection.gateNode !== null && connection.gateNode !== node) {\r\n                gates.push(connection.gateNode);\r\n            }\r\n            inputs.push(connection.from);\r\n            this.disconnect(connection.from, node);\r\n        }\r\n        // read all outputs from node and keep track of the nodes that gate the outgoing connection\r\n        for (var i = node.outgoing.length - 1; i >= 0; i--) {\r\n            var connection = node.outgoing[i];\r\n            if (keepGates && connection.gateNode !== null && connection.gateNode !== node) {\r\n                gates.push(connection.gateNode);\r\n            }\r\n            outputs.push(connection.to);\r\n            this.disconnect(node, connection.to);\r\n        }\r\n        // add all connections the node has\r\n        inputs.forEach(function (input) {\r\n            outputs.forEach(function (output) {\r\n                if (!input.isProjectingTo(output)) {\r\n                    connections.push(_this.connect(input, output));\r\n                }\r\n            });\r\n        });\r\n        // as long as there are gates and connections\r\n        while (gates.length > 0 && connections.length > 0) {\r\n            var gate = gates.shift(); // take a gate node and remove it from the array\r\n            if (gate === undefined) {\r\n                continue;\r\n            }\r\n            var connection = Utils_1.pickRandom(connections); // take a random connection\r\n            this.addGate(gate, connection); // gate the connection with the gate node\r\n            Utils_1.removeFromArray(connections, connection); // remove the connection from the array\r\n        }\r\n        // remove every gate the node has\r\n        for (var i = node.gated.length - 1; i >= 0; i--) {\r\n            this.removeGate(node.gated[i]);\r\n        }\r\n        Utils_1.removeFromArray(this.nodes, node); // remove the node from the nodes array\r\n    };\r\n    /**\r\n     * Mutates the network with the given method.\r\n     *\r\n     * @function mutate\r\n     * @memberof Network\r\n     *\r\n     * @param {Mutation} method [Mutation method](mutation)\r\n     * @param {object} options\r\n     * @param {number} [options.maxNodes] Maximum amount of [Nodes](node) a network can grow to\r\n     * @param {number} [options.maxConnections] Maximum amount of [Connections](connection) a network can grow to\r\n     * @param {number} [options.maxGates] Maximum amount of Gates a network can grow to\r\n     *\r\n     * @example\r\n     * let { Network } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * myNetwork = myNetwork.mutate(new AddNodeMutation()) // returns a mutated network with an added gate\r\n     */\r\n    Network.prototype.mutate = function (method, options) {\r\n        method.mutate(this, options);\r\n    };\r\n    /**\r\n     * Selects a random mutation method and returns a mutated copy of the network. Warning! Mutates network directly.\r\n     *\r\n     * @function mutateRandom\r\n     *\r\n     * @memberof Network\r\n     *\r\n     * @param {Mutation[]} [allowedMethods=methods.mutation.ALL] An array of [Mutation methods](mutation) to automatically pick from\r\n     * @param {object} options\r\n     * @param {number} [options.maxNodes] Maximum amount of [Nodes](node) a network can grow to\r\n     * @param {number} [options.maxConnections] Maximum amount of [Connections](connection) a network can grow to\r\n     * @param {number} [options.maxGates] Maximum amount of Gates a network can grow to\r\n     */\r\n    Network.prototype.mutateRandom = function (allowedMethods, options) {\r\n        if (allowedMethods === void 0) { allowedMethods = Mutation_1.ALL_MUTATIONS; }\r\n        if (options === void 0) { options = {}; }\r\n        if (allowedMethods.length === 0) {\r\n            return;\r\n        }\r\n        // mutate the network with a random allowed mutation\r\n        this.mutate(Utils_1.pickRandom(allowedMethods), options);\r\n    };\r\n    /**\r\n     * Train the given data to this network\r\n     *\r\n     * @function train\r\n     * @memberof Network\r\n     *\r\n     * @param {Array<{input:number[],output:number[]}>} dataset A data of input values and ideal output values to train the network with\r\n     * @param {TrainOptions} options Options used to train network\r\n     * @param {options.loss} [options.loss=new MSELoss()] The [options.loss function](https://en.wikipedia.org/wiki/Loss_function) used to determine network error\r\n     * @param {rate} [options.ratePolicy=new FixedRate(options.rate)] A [learning rate policy](https://towardsdatascience.com/understanding-learning-rates-and-how-it-improves-performance-in-deep-learning-d0d4059c1c10), i.e. how to change the learning rate during training to get better network performance\r\n     * @param {number} [options.rate=0.3] Sets the [learning rate](https://towardsdatascience.com/understanding-learning-rates-and-how-it-improves-performance-in-deep-learning-d0d4059c1c10) of the backpropagation process\r\n     * @param {number} [options.iterations=1000] Sets amount of training cycles the process will maximally run, even when the target error has not been reached.\r\n     * @param {number} [options.error] The target error to train for, once the network falls below this error, the process is stopped. Lower error rates require more training cycles.\r\n     * @param {number} [options.dropout=0] [Dropout rate](https://medium.com/@amarbudhiraja/https-medium-com-amarbudhiraja-learning-less-to-learn-better-options.dropout-in-deep-machine-learning-74334da4bfc5) likelihood for any given neuron to be ignored during network training. Must be between zero and one, numbers closer to one will result in more neurons ignored.\r\n     * @param {number} [options.momentum=0] [Momentum](https://www.willamette.edu/~gorr/classes/cs449/momrate.html). Adds a fraction of the previous weight update to the current one.\r\n     * @param {number} [options.batchSize=1] Sets the (mini-) batch size of your training. Default: 1 [(online training)](https://www.quora.com/What-is-the-difference-between-batch-online-and-mini-batch-training-in-neural-networks-Which-one-should-I-use-for-a-small-to-medium-sized-dataset-for-prediction-purposes)\r\n     * @param {number} [options.crossValidate.testSize] Sets the amount of test cases that should be assigned to cross validation. If data to 0.4, 40% of the given data will be used for cross validation.\r\n     * @param {number} [options.crossValidate.testError] Sets the target error of the validation data.\r\n     * @param {boolean} [options.clear=false] If set to true, will clear the network after every activation. This is useful for training LSTM's, more importantly for timeseries prediction.\r\n     * @param {boolean} [options.shuffle=false] When set to true, will shuffle the training data every iterationNumber. Good option to use if the network is performing worse in [cross validation](https://artint.info/html/ArtInt_189.html) than in the real training data.\r\n     * @param {number|boolean} [options.log=false] If set to n, outputs training status every n iterations. Setting `log` to 1 will log the status every iteration_number\r\n     * @param {number} [options.schedule.iterations] You can schedule tasks to happen every n iterations. Paired with `options.schedule.function`\r\n     * @param {schedule} [options.schedule.function] A function to run every n iterations as data by `options.schedule.iterations`. Passed as an object with a \"function\" property that contains the function to run.\r\n     *\r\n     * @returns {{error:{number},iterations:{number},time:{number}}} A summary object of the network's performance\r\n     *\r\n     * @example <caption>Training with Defaults</caption>\r\n     * let { Network } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let network = new Network(2, 1);\r\n     *\r\n     * // Train the XOR gate\r\n     * network.train([{ input: [0,0], output: [0] },\r\n     *                { input: [0,1], output: [1] },\r\n     *                { input: [1,0], output: [1] },\r\n     *                { input: [1,1], output: [0] }]);\r\n     *\r\n     * network.activate([0,1]); // 0.9824...\r\n     *\r\n     * @example <caption>Training with Options</caption>\r\n     * let { Network } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let network = new Network(2, 1);\r\n     *\r\n     * let trainingSet = [\r\n     *    { input: [0,0], output: [0] },\r\n     *    { input: [0,1], output: [1] },\r\n     *    { input: [1,0], output: [1] },\r\n     *    { input: [1,1], output: [0] }\r\n     * ];\r\n     *\r\n     * // Train the XNOR gate\r\n     * network.train(trainingSet, {\r\n     *    log: 1,\r\n     *    iterations: 1000,\r\n     *    error: 0.0001,\r\n     *    rate: 0.2\r\n     * });\r\n     *\r\n     * @example <caption>Cross Validation Example</caption>\r\n     * let { Network } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let network = new Network(2,1);\r\n     *\r\n     * let trainingSet = [ // PS: don't use cross validation for small sets, this is just an example\r\n     *  { input: [0,0], output: [1] },\r\n     *  { input: [0,1], output: [0] },\r\n     *  { input: [1,0], output: [0] },\r\n     *  { input: [1,1], output: [1] }\r\n     * ];\r\n     *\r\n     * // Train the XNOR gate\r\n     * network.train(trainingSet, {\r\n     *  crossValidate:\r\n     *    {\r\n     *      testSize: 0.4,\r\n     *      testError: 0.02\r\n     *    }\r\n     * });\r\n     *\r\n     */\r\n    Network.prototype.train = function (dataset, options) {\r\n        if (options === void 0) { options = {}; }\r\n        var _a;\r\n        if (dataset[0].input.length !== this.inputSize || dataset[0].output.length !== this.outputSize) {\r\n            throw new Error(\"Dataset input/output size should be same as network input/output size!\");\r\n        }\r\n        // Use the default values, if no value is given\r\n        options.iterations = Utils_1.getOrDefault(options.iterations, -1);\r\n        options.error = Utils_1.getOrDefault(options.error, -1);\r\n        options.loss = Utils_1.getOrDefault(options.loss, new Loss_1.MSELoss());\r\n        options.dropout = Utils_1.getOrDefault(options.dropout, 0);\r\n        options.momentum = Utils_1.getOrDefault(options.momentum, 0);\r\n        options.batchSize = Math.min(dataset.length, Utils_1.getOrDefault(options.batchSize, dataset.length));\r\n        var baseRate = Utils_1.getOrDefault(options.rate, 0.3);\r\n        options.ratePolicy = Utils_1.getOrDefault(options.ratePolicy, new Rate_1.FixedRate(baseRate));\r\n        options.log = Utils_1.getOrDefault(options.log, NaN);\r\n        var start = Date.now();\r\n        if (options.iterations <= 0 && options.error <= 0) {\r\n            throw new Error(\"At least one of the following options must be specified: error, iterations\");\r\n        }\r\n        // Split into trainingSet and testSet if cross validation is enabled\r\n        var trainingSetSize;\r\n        var trainingSet;\r\n        var testSet;\r\n        if (options.crossValidateTestSize && options.crossValidateTestSize > 0) {\r\n            trainingSetSize = Math.ceil((1 - options.crossValidateTestSize) * dataset.length);\r\n            trainingSet = dataset.slice(0, trainingSetSize);\r\n            testSet = dataset.slice(trainingSetSize);\r\n        }\r\n        else {\r\n            trainingSet = dataset;\r\n            testSet = [];\r\n        }\r\n        var currentTrainingRate;\r\n        var iterationCount = 0;\r\n        var error = 1;\r\n        // train until the target error is reached or the target iterations are reached\r\n        while (error > options.error && (options.iterations <= 0 || iterationCount < options.iterations)) {\r\n            iterationCount++;\r\n            // update the rate according to the rate policy\r\n            currentTrainingRate = options.ratePolicy.calc(iterationCount);\r\n            // train a single epoch\r\n            var trainError = this.trainEpoch(trainingSet, options.batchSize, currentTrainingRate, options.momentum, options.loss, options.dropout);\r\n            if (options.clear) {\r\n                this.clear();\r\n            }\r\n            // Run test with the testSet, if cross validation is enabled\r\n            if (options.crossValidateTestSize) {\r\n                error = this.test(testSet, options.loss);\r\n                if (options.clear) {\r\n                    this.clear();\r\n                }\r\n            }\r\n            else {\r\n                error = trainError;\r\n            }\r\n            if ((_a = options.shuffle) !== null && _a !== void 0 ? _a : false) {\r\n                Utils_1.shuffle(dataset);\r\n            }\r\n            if (options.log > 0 && iterationCount % options.log === 0) {\r\n                console.log(\"iteration number\", iterationCount, \"error\", error, \"training rate\", currentTrainingRate);\r\n            }\r\n            if (options.schedule && iterationCount % options.schedule.iterations === 0) {\r\n                options.schedule.function(error, iterationCount);\r\n            }\r\n        }\r\n        if (options.clear) {\r\n            this.clear();\r\n        }\r\n        return {\r\n            error: error,\r\n            iterations: iterationCount,\r\n            time: Date.now() - start\r\n        };\r\n    };\r\n    /**\r\n     * Performs one training epoch and returns the error - this is a private function used in `self.train`\r\n     *\r\n     * @todo Add `@param` tag descriptions\r\n     * @todo Add `@returns` tag description\r\n     *\r\n     * @private\r\n     *\r\n     * @param {Array<{input:number[], output: number[]}>} dataset\r\n     * @param {number} batchSize\r\n     * @param {number} trainingRate\r\n     * @param {number} momentum\r\n     * @param {loss} loss\r\n     * @param {number} dropoutRate=0.5 The dropout rate to use when training\r\n     *\r\n     * @returns {number}\r\n     */\r\n    Network.prototype.trainEpoch = function (dataset, batchSize, trainingRate, momentum, loss, dropoutRate) {\r\n        if (dropoutRate === void 0) { dropoutRate = 0.5; }\r\n        var errorSum = 0;\r\n        for (var i = 0; i < dataset.length; i++) {\r\n            var input = dataset[i].input;\r\n            var correctOutput = dataset[i].output;\r\n            var update = (i + 1) % batchSize === 0 || i + 1 === dataset.length;\r\n            var output = this.activate(input, { dropoutRate: dropoutRate });\r\n            this.propagate(correctOutput, { rate: trainingRate, momentum: momentum, update: update });\r\n            errorSum += loss.calc(correctOutput, output);\r\n        }\r\n        return errorSum / dataset.length;\r\n    };\r\n    /**\r\n     * Tests a set and returns the error and elapsed time\r\n     *\r\n     * @function test\r\n     * @memberof Network\r\n     *\r\n     * @param {Array<{input:number[],output:number[]}>} dataset A set of input values and ideal output values to test the network against\r\n     * @param {Loss} [loss=new MSELoss()] The [loss function](https://en.wikipedia.org/wiki/Loss_function) used to determine network error\r\n     *\r\n     * @returns {number} A summary object of the network's performance\r\n     *\r\n     */\r\n    Network.prototype.test = function (dataset, loss) {\r\n        if (loss === void 0) { loss = new Loss_1.MSELoss(); }\r\n        var error = 0;\r\n        for (var _i = 0, dataset_1 = dataset; _i < dataset_1.length; _i++) {\r\n            var entry = dataset_1[_i];\r\n            var input = entry.input;\r\n            var target = entry.output;\r\n            var output = this.activate(input, { trace: false });\r\n            error += loss.calc(target, output);\r\n        }\r\n        return error / dataset.length;\r\n    };\r\n    /**\r\n     * Convert the network to a json object\r\n     *\r\n     * @function toJSON\r\n     * @memberof Network\r\n     *\r\n     * @returns {NetworkJSON} The network represented as a json object\r\n     *\r\n     * @example\r\n     * let { Network } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * let exported = myNetwork.toJSON();\r\n     * let imported = Network.fromJSON(exported) // imported will be a new instance of Network that is an exact clone of myNetwork\r\n     */\r\n    Network.prototype.toJSON = function () {\r\n        var json = {\r\n            nodes: [],\r\n            connections: [],\r\n            inputSize: this.inputSize,\r\n            outputSize: this.outputSize,\r\n        };\r\n        // set node indices\r\n        for (var i = 0; i < this.nodes.length; i++) {\r\n            this.nodes[i].index = i;\r\n        }\r\n        // convert all nodes to json and add the to the json object\r\n        this.nodes.forEach(function (node) {\r\n            json.nodes.push(node.toJSON());\r\n            if (node.selfConnection.weight !== 0) {\r\n                // if there is a self connection\r\n                // add it to the json object\r\n                json.connections.push(node.selfConnection.toJSON());\r\n            }\r\n        });\r\n        this.connections\r\n            .map(function (conn) { return conn.toJSON(); }) // convert all connections to json\r\n            .forEach(function (connJSON) { return json.connections.push(connJSON); }); // and add them to the json object\r\n        return json;\r\n    };\r\n    /**\r\n     * Evolves the network to reach a lower error on a dataset using the [NEAT algorithm](http://nn.cs.utexas.edu/downloads/papers/stanley.ec02.pdf)\r\n     *\r\n     * If both `iterations` and `error` options are unset, evolve will default to `iterations` as an end condition.\r\n     *\r\n     * @function evolve\r\n     * @memberof Network\r\n     *\r\n     * @param {Array<{input:number[],output:number[]}>} dataset A set of input values and ideal output values to train the network with\r\n     * @param {object} [options] Configuration options\r\n     * @param {number} [options.iterations=1000] Set the maximum amount of iterations/generations for the algorithm to run.\r\n     * @param {number} [options.error=0.05] Set the target error. The algorithm will stop once this target error has been reached.\r\n     * @param {number} [options.growth=0.0001] Set the penalty for large networks. Penalty calculation: penalty = (genome.nodes.length + genome.connectoins.length + genome.gates.length) * growth; This penalty will get added on top of the error. Your growth should be a very small number.\r\n     * @param {loss} [options.loss=loss.MSE]  Specify the loss function for the evolution, this tells a genome in the population how well it's performing. Default: methods.loss.MSE (recommended).\r\n     * @param {number} [options.amount=1] Set the amount of times to test the trainingset on a genome each generation. Useful for timeseries. Do not use for regular feedfoward problems.\r\n     * @param {number} [options.threads] Specify the amount of threads to use. Default value is the amount of cores in your CPU.\r\n     * @param {Network} [options.network]\r\n     * @param {number|boolean} [options.log=false] If set to n, outputs training status every n iterations. Setting `log` to 1 will log the status every iteration\r\n     * @param {number} [options.schedule.iterations] You can schedule tasks to happen every n iterations. Paired with `options.schedule.function`\r\n     * @param {schedule} [options.schedule.function] A function to run every n iterations as set by `options.schedule.iterations`. Passed as an object with a \"function\" property that contains the function to run.\r\n     * @param {boolean} [options.clear=false] If set to true, will clear the network after every activation. This is useful for evolving recurrent networks, more importantly for timeseries prediction.\r\n     * @param {boolean} [options.equal=true] If set to true when [Network.crossOver](Network.crossOver) runs it will assume both genomes are equally fit.\r\n     * @param {number} [options.populationSize=50] Population size of each generation.\r\n     * @param {number} [options.elitism=1] Elitism of every evolution loop. [Elitism in genetic algorithms.](https://www.researchgate.net/post/What_is_meant_by_the_term_Elitism_in_the_Genetic_Algorithm)\r\n     * @param {number} [options.provenance=0] Number of genomes inserted into the original network template (Network(input,output)) per evolution.\r\n     * @param {number} [options.mutationRate=0.4] Sets the mutation rate. If set to 0.3, 30% of the new population will be mutated.\r\n     * @param {number} [options.mutationAmount=1] If mutation occurs (randomNumber < mutationRate), sets amount of times a mutation method will be applied to the network.\r\n     * @param {boolean} [options.fitnessPopulation=true] Flag to return the fitness of a population of genomes. false => evaluate each genome individually. true => evaluate entire population. Adjust fitness function accordingly\r\n     * @param {Function} [options.fitness] - A fitness function to evaluate the networks. Takes a `genome`, i.e. a [network](Network), and a `dataset` and sets the genome's score property\r\n     * @param {string} [options.selection=new FitnessProportionateSelection()] [Selection method](selection) for evolution (e.g. methods.Selection.FITNESS_PROPORTIONATE).\r\n     * @param {Array} [options.crossover] Sets allowed crossover methods for evolution.\r\n     * @param {Array} [options.mutation] Sets allowed [mutation methods](mutation) for evolution, a random mutation method will be chosen from the array when mutation occurs. Optional, but default methods are non-recurrent.\r\n     * @param {number} [options.maxNodes=Infinity] Maximum nodes for a potential network\r\n     * @param {number} [options.maxConnections=Infinity] Maximum connections for a potential network\r\n     * @param {number} [options.maxGates=Infinity] Maximum gates for a potential network\r\n     * @param {function} [options.mutationSelection=random] Custom mutation selection function if given\r\n     * @param {boolean} [options.efficientMutation=false] Test & reduce [mutation methods](mutation) to avoid failed mutation attempts\r\n     *\r\n     * @returns {{error:{number},iterations:{number},time:{number}}} A summary object of the network's performance. <br /> Properties include: `error` - error of the best genome, `iterations` - generations used to evolve networks, `time` - clock time elapsed while evolving\r\n     *\r\n     * @example\r\n     * let { Network, methods } = require(\"@liquid-carrot/carrot\");\r\n     *\r\n     * async function execute () {\r\n     *    var network = new Network(2,1);\r\n     *\r\n     *    // XOR dataset\r\n     *    var trainingSet = [\r\n     *        { input: [0,0], output: [0] },\r\n     *        { input: [0,1], output: [1] },\r\n     *        { input: [1,0], output: [1] },\r\n     *        { input: [1,1], output: [0] }\r\n     *    ];\r\n     *\r\n     *    await network.evolve(trainingSet, {\r\n     *        mutation: methods.mutation.FFW,\r\n     *        equal: true,\r\n     *        error: 0.05,\r\n     *        elitism: 5,\r\n     *        mutationRate: 0.5\r\n     *    });\r\n     *\r\n     *    // another option\r\n     *    // await network.evolve(trainingSet, {\r\n     *    //     mutation: methods.mutation.FFW,\r\n     *    //     equal: true,\r\n     *    //     error: 0.05,\r\n     *    //     elitism: 5,\r\n     *    //     mutationRate: 0.5,\r\n     *    //     loss: (targets, outputs) => {\r\n     *    //       const error = outputs.reduce(function(total, value, index) {\r\n     *    //         return total += Math.pow(targets[index] - outputs[index], 2);\r\n     *    //       }, 0);\r\n     *    //\r\n     *    //       return error / outputs.length;\r\n     *    //     }\r\n     *    // });\r\n     *\r\n     *\r\n     *    network.activate([0,0]); // 0.2413\r\n     *    network.activate([0,1]); // 1.0000\r\n     *    network.activate([1,0]); // 0.7663\r\n     *    network.activate([1,1]); // -0.008\r\n     * }\r\n     *\r\n     * execute();\r\n     */\r\n    Network.prototype.evolve = function (dataset, options) {\r\n        if (options === void 0) { options = {}; }\r\n        var _a, _b, _c, _d;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var targetError, start, serializedDataSet, workerPool, neat, error, bestFitness, bestGenome, fittest, fitness;\r\n            return __generator(this, function (_e) {\r\n                switch (_e.label) {\r\n                    case 0:\r\n                        if (dataset[0].input.length !== this.inputSize || dataset[0].output.length !== this.outputSize) {\r\n                            throw new Error(\"Dataset input/output size should be same as network input/output size!\");\r\n                        }\r\n                        targetError = 0;\r\n                        if (typeof options.iterations === \"undefined\" && typeof options.error === \"undefined\") {\r\n                            options.iterations = 1000;\r\n                            targetError = 0.05;\r\n                        }\r\n                        else if (options.iterations) {\r\n                            targetError = -1; // run until iterations\r\n                        }\r\n                        else if (options.error) {\r\n                            targetError = options.error;\r\n                            options.iterations = 0; // run until error\r\n                        }\r\n                        // set options to default if necessary\r\n                        options.growth = Utils_1.getOrDefault(options.growth, 0.0001);\r\n                        options.loss = Utils_1.getOrDefault(options.loss, new Loss_1.MSELoss());\r\n                        options.amount = Utils_1.getOrDefault(options.amount, 1);\r\n                        options.maxNodes = Utils_1.getOrDefault(options.maxNodes, Infinity);\r\n                        options.maxConnections = Utils_1.getOrDefault(options.maxConnections, Infinity);\r\n                        options.maxGates = Utils_1.getOrDefault(options.maxGates, Infinity);\r\n                        options.threads = Utils_1.getOrDefault(options.threads, 4);\r\n                        start = Date.now();\r\n                        serializedDataSet = JSON.stringify(dataset);\r\n                        if (!options.fitnessFunction) {\r\n                            // if no fitness function is given\r\n                            // create default one\r\n                            // init a pool of workers\r\n                            workerPool = threads_1.Pool(function () { return threads_1.spawn(new threads_1.Worker(\"../multithreading/Worker\")); }, options.threads);\r\n                            options.fitnessFunction = function (dataset, population) {\r\n                                return __awaiter(this, void 0, void 0, function () {\r\n                                    var _loop_1, _i, population_1, genome;\r\n                                    var _this = this;\r\n                                    return __generator(this, function (_a) {\r\n                                        switch (_a.label) {\r\n                                            case 0:\r\n                                                _loop_1 = function (genome) {\r\n                                                    // add a task to the workerPool's queue\r\n                                                    // TODO: should not ignore this\r\n                                                    // @ts-ignore\r\n                                                    workerPool.queue(function (test) { return __awaiter(_this, void 0, void 0, function () {\r\n                                                        var _a;\r\n                                                        var _b, _c;\r\n                                                        return __generator(this, function (_d) {\r\n                                                            switch (_d.label) {\r\n                                                                case 0:\r\n                                                                    if (genome === undefined) {\r\n                                                                        return [2 /*return*/];\r\n                                                                    }\r\n                                                                    // test the genome\r\n                                                                    _a = genome;\r\n                                                                    return [4 /*yield*/, test(serializedDataSet, JSON.stringify(genome.toJSON()), Loss_1.ALL_LOSSES.indexOf((_b = options.loss) !== null && _b !== void 0 ? _b : new Loss_1.MSELoss()))];\r\n                                                                case 1:\r\n                                                                    // test the genome\r\n                                                                    _a.score = -(_d.sent());\r\n                                                                    if (genome.score === undefined) {\r\n                                                                        genome.score = -Infinity;\r\n                                                                        return [2 /*return*/];\r\n                                                                    }\r\n                                                                    // subtract growth value\r\n                                                                    genome.score -= ((_c = options.growth) !== null && _c !== void 0 ? _c : 0.0001) * (genome.nodes.length\r\n                                                                        - genome.inputSize\r\n                                                                        - genome.outputSize\r\n                                                                        + genome.connections.length\r\n                                                                        + genome.gates.length);\r\n                                                                    return [2 /*return*/];\r\n                                                            }\r\n                                                        });\r\n                                                    }); });\r\n                                                };\r\n                                                for (_i = 0, population_1 = population; _i < population_1.length; _i++) {\r\n                                                    genome = population_1[_i];\r\n                                                    _loop_1(genome);\r\n                                                }\r\n                                                return [4 /*yield*/, workerPool.settled()];\r\n                                            case 1:\r\n                                                _a.sent(); // wait until every task is done\r\n                                                return [2 /*return*/];\r\n                                        }\r\n                                    });\r\n                                });\r\n                            };\r\n                        }\r\n                        options.template = this; // set this network as template for first generation\r\n                        neat = new NEAT_1.NEAT(dataset, options);\r\n                        error = -Infinity;\r\n                        bestFitness = -Infinity;\r\n                        _e.label = 1;\r\n                    case 1:\r\n                        if (!(error < -targetError && (options.iterations === 0 || neat.generation < ((_a = options.iterations) !== null && _a !== void 0 ? _a : 0)))) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, neat.evolve()];\r\n                    case 2:\r\n                        fittest = _e.sent();\r\n                        fitness = (_b = fittest.score) !== null && _b !== void 0 ? _b : -Infinity;\r\n                        // add the growth value back to get the real error\r\n                        error = fitness + options.growth * (fittest.nodes.length\r\n                            - fittest.inputSize\r\n                            - fittest.outputSize\r\n                            + fittest.connections.length\r\n                            + fittest.gates.length);\r\n                        if (fitness > bestFitness) {\r\n                            bestFitness = fitness;\r\n                            bestGenome = fittest;\r\n                        }\r\n                        if (((_c = options.log) !== null && _c !== void 0 ? _c : 0) > 0 && neat.generation % ((_d = options.log) !== null && _d !== void 0 ? _d : 0) === 0) {\r\n                            console.log(\"iteration\", neat.generation, \"fitness\", fitness, \"error\", -error);\r\n                        }\r\n                        if (options.schedule && neat.generation % options.schedule.iterations === 0) {\r\n                            options.schedule.function(fitness, -error, neat.generation);\r\n                        }\r\n                        return [3 /*break*/, 1];\r\n                    case 3:\r\n                        if (bestGenome !== undefined) {\r\n                            // set this network to the fittest from NEAT\r\n                            this.nodes = bestGenome.nodes;\r\n                            this.connections = bestGenome.connections;\r\n                            this.gates = bestGenome.gates;\r\n                            if (options.clear) {\r\n                                this.clear();\r\n                            }\r\n                        }\r\n                        if (workerPool) {\r\n                            workerPool.terminate(); // stop all processes\r\n                        }\r\n                        return [2 /*return*/, {\r\n                                error: -error,\r\n                                iterations: neat.generation,\r\n                                time: Date.now() - start,\r\n                            }];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return Network;\r\n}());\r\nexports.Network = Network;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Layer_1 = require(\"./Layers/Layer\");\r\nvar InputLayer_1 = require(\"./Layers/CoreLayers/InputLayer\");\r\nvar Network_1 = require(\"./Network\");\r\nvar OutputLayer_1 = require(\"./Layers/CoreLayers/OutputLayer\");\r\nvar Architect = /** @class */ (function () {\r\n    function Architect() {\r\n        this.layers = [];\r\n    }\r\n    Architect.prototype.addLayer = function (layer, incomingConnectionType) {\r\n        var connectionType = incomingConnectionType !== null && incomingConnectionType !== void 0 ? incomingConnectionType : layer.getDefaultIncomingConnectionType();\r\n        if (!layer.connectionTypeisAllowed(connectionType)) {\r\n            throw new ReferenceError(\"Connection type \" + connectionType + \" is not allowed at layer \" + layer.constructor.name);\r\n        }\r\n        this.layers.push({\r\n            layer: layer,\r\n            incomingConnectionType: connectionType\r\n        });\r\n        return this; // function as builder class\r\n    };\r\n    Architect.prototype.buildModel = function () {\r\n        var _a, _b, _c, _d, _e;\r\n        if (!(this.layers[0].layer instanceof InputLayer_1.InputLayer)) {\r\n            throw new ReferenceError(\"First layer has to be a InputLayer! Currently is: \" + this.layers[0].layer.constructor.name);\r\n        }\r\n        if (!(this.layers[this.layers.length - 1].layer instanceof OutputLayer_1.OutputLayer)) {\r\n            throw new ReferenceError(\"Last layer has to be a OutputLayer! Currently is: \" + this.layers[this.layers.length - 1].layer.constructor.name);\r\n        }\r\n        var inputSize = this.layers[0].layer.nodes.length;\r\n        var outputSize = this.layers[this.layers.length - 1].layer.nodes.length;\r\n        var network = new Network_1.Network(inputSize, outputSize);\r\n        network.nodes = [];\r\n        network.connections = [];\r\n        for (var i = 0; i < this.layers.length - 1; i++) {\r\n            (_a = network.connections).push.apply(_a, Layer_1.Layer.connect(this.layers[i].layer, this.layers[i + 1].layer, this.layers[i + 1].incomingConnectionType));\r\n            (_b = network.nodes).push.apply(_b, this.layers[i].layer.nodes);\r\n            (_c = network.connections).push.apply(_c, this.layers[i].layer.connections);\r\n            (_d = network.gates).push.apply(_d, this.layers[i].layer.gates);\r\n        }\r\n        (_e = network.nodes).push.apply(_e, this.layers[this.layers.length - 1].layer.nodes);\r\n        return network;\r\n    };\r\n    return Architect;\r\n}());\r\nexports.Architect = Architect;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar DenseLayer_1 = require(\"../src/architecture/Layers/CoreLayers/DenseLayer\");\r\nexports.DenseLayer = DenseLayer_1.DenseLayer;\r\nvar Node_1 = require(\"../src/architecture/Node\");\r\nexports.Node = Node_1.Node;\r\nvar DropoutLayer_1 = require(\"../src/architecture/Layers/CoreLayers/DropoutLayer\");\r\nexports.DropoutLayer = DropoutLayer_1.DropoutLayer;\r\nvar NoiseLayer_1 = require(\"../src/architecture/Layers/NoiseLayers/NoiseLayer\");\r\nexports.NoiseLayer = NoiseLayer_1.NoiseLayer;\r\nvar OutputLayer_1 = require(\"../src/architecture/Layers/CoreLayers/OutputLayer\");\r\nexports.OutputLayer = OutputLayer_1.OutputLayer;\r\nvar InputLayer_1 = require(\"../src/architecture/Layers/CoreLayers/InputLayer\");\r\nexports.InputLayer = InputLayer_1.InputLayer;\r\nvar AvgPooling1DLayer_1 = require(\"../src/architecture/Layers/PoolingLayers/AvgPooling1DLayer\");\r\nexports.AvgPooling1DLayer = AvgPooling1DLayer_1.AvgPooling1DLayer;\r\nvar MinPooling1DLayer_1 = require(\"../src/architecture/Layers/PoolingLayers/MinPooling1DLayer\");\r\nexports.MinPooling1DLayer = MinPooling1DLayer_1.MinPooling1DLayer;\r\nvar MaxPooling1DLayer_1 = require(\"../src/architecture/Layers/PoolingLayers/MaxPooling1DLayer\");\r\nexports.MaxPooling1DLayer = MaxPooling1DLayer_1.MaxPooling1DLayer;\r\nvar GlobalAvgPooling1DLayer_1 = require(\"../src/architecture/Layers/PoolingLayers/GlobalAvgPooling1DLayer\");\r\nexports.GlobalAvgPooling1DLayer = GlobalAvgPooling1DLayer_1.GlobalAvgPooling1DLayer;\r\nvar GlobalMaxPooling1DLayer_1 = require(\"../src/architecture/Layers/PoolingLayers/GlobalMaxPooling1DLayer\");\r\nexports.GlobalMaxPooling1DLayer = GlobalMaxPooling1DLayer_1.GlobalMaxPooling1DLayer;\r\nvar GlobalMinPooling1DLayer_1 = require(\"../src/architecture/Layers/PoolingLayers/GlobalMinPooling1DLayer\");\r\nexports.GlobalMinPooling1DLayer = GlobalMinPooling1DLayer_1.GlobalMinPooling1DLayer;\r\nvar PoolingLayer_1 = require(\"../src/architecture/Layers/PoolingLayers/PoolingLayer\");\r\nexports.PoolingLayer = PoolingLayer_1.PoolingLayer;\r\nvar GRULayer_1 = require(\"../src/architecture/Layers/RecurrentLayers/GRULayer\");\r\nexports.GRULayer = GRULayer_1.GRULayer;\r\nvar LSTMLayer_1 = require(\"../src/architecture/Layers/RecurrentLayers/LSTMLayer\");\r\nexports.LSTMLayer = LSTMLayer_1.LSTMLayer;\r\nvar MemoryLayer_1 = require(\"../src/architecture/Layers/RecurrentLayers/MemoryLayer\");\r\nexports.MemoryLayer = MemoryLayer_1.MemoryLayer;\r\nvar Layer_1 = require(\"../src/architecture/Layers/Layer\");\r\nexports.Layer = Layer_1.Layer;\r\nvar ConstantNode_1 = require(\"../src/architecture/Nodes/ConstantNode\");\r\nexports.ConstantNode = ConstantNode_1.ConstantNode;\r\nvar DropoutNode_1 = require(\"../src/architecture/Nodes/DropoutNode\");\r\nexports.DropoutNode = DropoutNode_1.DropoutNode;\r\nvar NoiseNode_1 = require(\"../src/architecture/Nodes/NoiseNode\");\r\nexports.NoiseNode = NoiseNode_1.NoiseNode;\r\nvar PoolNode_1 = require(\"../src/architecture/Nodes/PoolNode\");\r\nexports.PoolNode = PoolNode_1.PoolNode;\r\nvar Architect_1 = require(\"../src/architecture/Architect\");\r\nexports.Architect = Architect_1.Architect;\r\nvar Connection_1 = require(\"../src/architecture/Connection\");\r\nexports.Connection = Connection_1.Connection;\r\nvar Network_1 = require(\"../src/architecture/Network\");\r\nexports.Network = Network_1.Network;\r\nvar ActivationType_1 = require(\"../src/enums/ActivationType\");\r\nexports.ActivationType = ActivationType_1.ActivationType;\r\nvar ConnectionType_1 = require(\"../src/enums/ConnectionType\");\r\nexports.ConnectionType = ConnectionType_1.ConnectionType;\r\nvar GatingType_1 = require(\"../src/enums/GatingType\");\r\nexports.GatingType = GatingType_1.GatingType;\r\nvar NodeType_1 = require(\"../src/enums/NodeType\");\r\nexports.NodeType = NodeType_1.NodeType;\r\nexports.NoiseNodeType = NodeType_1.NoiseNodeType;\r\nexports.PoolNodeType = NodeType_1.PoolNodeType;\r\nvar Activation_1 = require(\"../src/methods/Activation\");\r\nexports.AbsoluteActivation = Activation_1.AbsoluteActivation;\r\nexports.Activation = Activation_1.Activation;\r\nexports.ALL_ACTIVATIONS = Activation_1.ALL_ACTIVATIONS;\r\nexports.BentIdentityActivation = Activation_1.BentIdentityActivation;\r\nexports.BipolarActivation = Activation_1.BipolarActivation;\r\nexports.BipolarSigmoidActivation = Activation_1.BipolarSigmoidActivation;\r\nexports.GaussianActivation = Activation_1.GaussianActivation;\r\nexports.HardTanhActivation = Activation_1.HardTanhActivation;\r\nexports.IdentityActivation = Activation_1.IdentityActivation;\r\nexports.InverseActivation = Activation_1.InverseActivation;\r\nexports.LogisticActivation = Activation_1.LogisticActivation;\r\nexports.RELUActivation = Activation_1.RELUActivation;\r\nexports.SELUActivation = Activation_1.SELUActivation;\r\nexports.SinusoidActivation = Activation_1.SinusoidActivation;\r\nexports.SoftSignActivation = Activation_1.SoftSignActivation;\r\nexports.StepActivation = Activation_1.StepActivation;\r\nexports.TanhActivation = Activation_1.TanhActivation;\r\nvar Loss_1 = require(\"../src/methods/Loss\");\r\nexports.ALL_LOSSES = Loss_1.ALL_LOSSES;\r\nexports.BinaryLoss = Loss_1.BinaryLoss;\r\nexports.CrossEntropyLoss = Loss_1.CrossEntropyLoss;\r\nexports.HINGELoss = Loss_1.HINGELoss;\r\nexports.Loss = Loss_1.Loss;\r\nexports.MAELoss = Loss_1.MAELoss;\r\nexports.MAPELoss = Loss_1.MAPELoss;\r\nexports.MSELoss = Loss_1.MSELoss;\r\nexports.MSLELoss = Loss_1.MSLELoss;\r\nexports.WAPELoss = Loss_1.WAPELoss;\r\nvar Mutation_1 = require(\"../src/methods/Mutation\");\r\nexports.AddBackConnectionMutation = Mutation_1.AddBackConnectionMutation;\r\nexports.AddConnectionMutation = Mutation_1.AddConnectionMutation;\r\nexports.AddGateMutation = Mutation_1.AddGateMutation;\r\nexports.AddNodeMutation = Mutation_1.AddNodeMutation;\r\nexports.AddSelfConnectionMutation = Mutation_1.AddSelfConnectionMutation;\r\nexports.ALL_MUTATIONS = Mutation_1.ALL_MUTATIONS;\r\nexports.FEEDFORWARD_MUTATIONS = Mutation_1.FEEDFORWARD_MUTATIONS;\r\nexports.ModActivationMutation = Mutation_1.ModActivationMutation;\r\nexports.ModBiasMutation = Mutation_1.ModBiasMutation;\r\nexports.ModWeightMutation = Mutation_1.ModWeightMutation;\r\nexports.Mutation = Mutation_1.Mutation;\r\nexports.NO_STRUCTURE_MUTATIONS = Mutation_1.NO_STRUCTURE_MUTATIONS;\r\nexports.ONLY_STRUCTURE = Mutation_1.ONLY_STRUCTURE;\r\nexports.SubBackConnectionMutation = Mutation_1.SubBackConnectionMutation;\r\nexports.SubConnectionMutation = Mutation_1.SubConnectionMutation;\r\nexports.SubGateMutation = Mutation_1.SubGateMutation;\r\nexports.SubNodeMutation = Mutation_1.SubNodeMutation;\r\nexports.SubSelfConnectionMutation = Mutation_1.SubSelfConnectionMutation;\r\nexports.SwapNodesMutation = Mutation_1.SwapNodesMutation;\r\nvar Rate_1 = require(\"../src/methods/Rate\");\r\nexports.ExponentialRate = Rate_1.ExponentialRate;\r\nexports.FixedRate = Rate_1.FixedRate;\r\nexports.InverseRate = Rate_1.InverseRate;\r\nexports.Rate = Rate_1.Rate;\r\nexports.StepRate = Rate_1.StepRate;\r\nvar Selection_1 = require(\"../src/methods/Selection\");\r\nexports.FitnessProportionateSelection = Selection_1.FitnessProportionateSelection;\r\nexports.PowerSelection = Selection_1.PowerSelection;\r\nexports.Selection = Selection_1.Selection;\r\nexports.TournamentSelection = Selection_1.TournamentSelection;\r\nvar Utils_1 = require(\"../src/methods/Utils\");\r\nexports.avg = Utils_1.avg;\r\nexports.generateGaussian = Utils_1.generateGaussian;\r\nexports.getOrDefault = Utils_1.getOrDefault;\r\nexports.max = Utils_1.max;\r\nexports.maxValueIndex = Utils_1.maxValueIndex;\r\nexports.min = Utils_1.min;\r\nexports.minValueIndex = Utils_1.minValueIndex;\r\nexports.pickRandom = Utils_1.pickRandom;\r\nexports.randBoolean = Utils_1.randBoolean;\r\nexports.randDouble = Utils_1.randDouble;\r\nexports.randInt = Utils_1.randInt;\r\nexports.removeFromArray = Utils_1.removeFromArray;\r\nexports.shuffle = Utils_1.shuffle;\r\nexports.sum = Utils_1.sum;\r\n"]}